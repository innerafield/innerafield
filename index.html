<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="description" content="Free breathing meditation. No account. No tracking. Just peace. For all beings.">
<meta name="theme-color" content="#000000">
<meta name="google" content="notranslate">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Innera Field">

<!-- Favicons -->
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="48x48" href="icons/favicon-48.png">
<link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16.png">
<link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
<link rel="manifest" href="manifest.json">

<!-- Open Graph -->
<meta property="og:title" content="Innera Field">
<meta property="og:description" content="Free breathing meditation. No account. No tracking. Just peace.">
<meta property="og:image" content="https://innerafield.com/icons/icon-512.png">
<meta property="og:url" content="https://innerafield.com">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Innera Field">
<meta name="twitter:description" content="Free breathing meditation. No account. No tracking. Just peace.">
<meta name="twitter:image" content="https://innerafield.com/icons/icon-512.png">

<title>Innera Field</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --void:#000;
  --light:#fff;
  --dim:rgba(255,255,255,.6);
  --faint:rgba(255,255,255,.35);
  --glass:rgba(255,255,255,.05);
  --border:rgba(255,255,255,.1);
  --pink:rgba(255,20,147,.35);
  --magenta:rgba(255,0,128,.3);
  --purple:rgba(138,43,226,.35);
  --blue:rgba(0,191,255,.35);
  --cyan:rgba(0,255,255,.25);
  --gold:rgba(255,215,0,.3);
  --accent:#ff69b4;
  --accent-dim:rgba(255,105,180,.4);
  --green:#4ade80;
  --green-dim:rgba(74,222,128,.4);
}
html{height:100%;-webkit-text-size-adjust:100%}
body{
  min-height:100%;height:100%;
  font-family:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  background:var(--void);
  color:var(--light);
  display:flex;
  align-items:center;
  justify-content:center;
  -webkit-tap-highlight-color:transparent;
  overflow:hidden;
  animation:awakening 2s ease-out;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
@keyframes awakening{0%{opacity:0}100%{opacity:1}}

/* Rainbow Cosmos */
.cosmos{
  position:fixed;
  inset:0;
  z-index:0;
  background:
    radial-gradient(ellipse at 12% 15%,var(--pink),transparent 50%),
    radial-gradient(ellipse at 88% 18%,var(--magenta),transparent 45%),
    radial-gradient(ellipse at 18% 82%,var(--blue),transparent 50%),
    radial-gradient(ellipse at 82% 78%,var(--purple),transparent 55%),
    radial-gradient(ellipse at 50% 50%,var(--cyan),transparent 60%),
    radial-gradient(ellipse at 65% 25%,var(--gold),transparent 40%);
  opacity:.55;
  animation:cosmicDance 25s ease-in-out infinite;
  pointer-events:none;
  will-change:opacity,filter;
}
@keyframes cosmicDance{
  0%,100%{opacity:.5;filter:hue-rotate(0deg) saturate(1)}
  25%{opacity:.6;filter:hue-rotate(10deg) saturate(1.1)}
  50%{opacity:.55;filter:hue-rotate(0deg) saturate(1)}
  75%{opacity:.65;filter:hue-rotate(-10deg) saturate(1.15)}
}
.cosmos::before{
  content:'';
  position:absolute;
  inset:0;
  background-image:
    radial-gradient(1.5px 1.5px at 20% 30%,rgba(255,255,255,.35),transparent),
    radial-gradient(2px 2px at 40% 70%,rgba(255,255,255,.25),transparent),
    radial-gradient(1px 1px at 60% 15%,rgba(255,255,255,.4),transparent),
    radial-gradient(1.5px 1.5px at 80% 50%,rgba(255,255,255,.3),transparent),
    radial-gradient(1px 1px at 15% 65%,rgba(255,255,255,.35),transparent),
    radial-gradient(2px 2px at 75% 85%,rgba(255,255,255,.2),transparent),
    radial-gradient(1px 1px at 35% 40%,rgba(255,255,255,.3),transparent),
    radial-gradient(1.5px 1.5px at 90% 20%,rgba(255,255,255,.25),transparent),
    radial-gradient(1px 1px at 5% 90%,rgba(255,255,255,.3),transparent),
    radial-gradient(1.5px 1.5px at 55% 95%,rgba(255,255,255,.2),transparent);
  animation:starFloat 40s linear infinite;
}
@keyframes starFloat{0%{transform:translateY(0)}100%{transform:translateY(-15px)}}

.field{
  position:relative;
  z-index:1;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:1.5rem;
  text-align:center;
}

/* Gold Title */
.title{
  position:absolute;
  top:max(10vh,55px);
  font-size:clamp(1.4rem,5vw,2.8rem);
  font-weight:700;
  letter-spacing:.45em;
  padding-left:.45em;
  background:linear-gradient(135deg,#d4af37 0%,#ffd700 25%,#f5deb3 50%,#ffd700 75%,#d4af37 100%);
  background-size:400% 400%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  animation:titleShimmer 8s ease-in-out infinite;
  user-select:none;
  white-space:nowrap;
  filter:drop-shadow(0 0 30px rgba(255,215,0,.2));
}
@keyframes titleShimmer{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}

/* Streak display */
.streak{
  position:absolute;
  top:max(2.5vh,14px);
  left:50%;
  transform:translateX(-50%);
  font-size:.85rem;
  font-weight:500;
  letter-spacing:.08em;
  color:var(--faint);
  opacity:0;
  transition:opacity .6s ease;
  display:flex;
  align-items:center;
  gap:.4rem;
}
.streak.show{opacity:1}
.streak .flame{font-size:1.1rem;filter:drop-shadow(0 0 4px rgba(255,100,0,.5))}

/* Controls - BIGGER ICONS */
.controls-left{position:absolute;top:max(2vh,12px);left:max(2.5vw,12px);display:flex;gap:.5rem;z-index:100}
.controls-right{position:absolute;top:max(2vh,12px);right:max(2.5vw,12px);display:flex;gap:.5rem;z-index:100}
.ctrl{
  background:transparent;
  border:none;
  color:var(--dim);
  width:50px;height:50px;
  cursor:pointer;
  transition:all .3s cubic-bezier(.4,0,.2,1);
  opacity:.5;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  font-size:1.5rem;
}
.ctrl:hover,.ctrl:focus{opacity:1;color:var(--light);background:rgba(255,255,255,.08)}
.ctrl:active{transform:scale(.92)}
.ctrl.on{opacity:1;color:var(--accent)}
.ctrl.hidden{display:none}

/* UPDATE BUTTON - Special styling */
.ctrl.update{
  display:none;
  color:var(--green);
  opacity:0;
  background:rgba(74,222,128,.1);
  border:1px solid var(--green-dim);
  animation:updatePulse 2s ease-in-out infinite;
}
.ctrl.update.show{
  display:flex;
  opacity:1;
}
@keyframes updatePulse{
  0%,100%{
    box-shadow:0 0 0 0 rgba(74,222,128,.4),0 0 15px rgba(74,222,128,.2);
    transform:scale(1);
  }
  50%{
    box-shadow:0 0 0 8px rgba(74,222,128,0),0 0 25px rgba(74,222,128,.4);
    transform:scale(1.05);
  }
}
.ctrl.update:hover{
  background:rgba(74,222,128,.2);
  color:#fff;
}

/* Breathing Circle */
.circle{
  position:relative;
  width:min(240px,48vw);
  height:min(240px,48vw);
  border-radius:50%;
  background:radial-gradient(circle at 50% 50%,rgba(255,105,180,.04),transparent 70%);
  border:2px solid rgba(255,255,255,.1);
  box-shadow:
    0 0 50px rgba(255,20,147,.2),
    0 0 100px rgba(138,43,226,.12),
    inset 0 0 50px rgba(255,255,255,.02);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  cursor:pointer;
  transform:scale(1) translateZ(0);
  will-change:transform,box-shadow,border-color;
  transition:transform .4s cubic-bezier(.4,0,.2,1),box-shadow .4s ease,border-color .4s ease;
  -webkit-backface-visibility:hidden;
  backface-visibility:hidden;
}
.circle.idle{animation:heartbeat 5s ease-in-out infinite}
@keyframes heartbeat{
  0%,100%{transform:scale(1);box-shadow:0 0 50px rgba(255,20,147,.2),0 0 100px rgba(138,43,226,.12)}
  50%{transform:scale(1.015);box-shadow:0 0 65px rgba(255,20,147,.28),0 0 120px rgba(138,43,226,.15)}
}
.circle.starting{transform:scale(1.06) translateZ(0)}
.circle.breathing{transition-timing-function:cubic-bezier(.4,0,.2,1)}
.circle.breathing.inhale{
  transform:scale(1.32) translateZ(0);
  border-color:rgba(255,215,0,.45);
  box-shadow:0 0 80px rgba(255,215,0,.35),0 0 130px rgba(255,105,180,.2);
}
.circle.breathing.hold-in{
  transform:scale(1.32) translateZ(0);
  border-color:rgba(255,180,100,.4);
  box-shadow:0 0 70px rgba(255,180,100,.3),0 0 120px rgba(255,140,100,.15);
}
.circle.breathing.exhale{
  transform:scale(.7) translateZ(0);
  border-color:rgba(0,191,255,.45);
  box-shadow:0 0 60px rgba(0,191,255,.35),0 0 110px rgba(138,43,226,.2);
}
.circle.breathing.hold-out{
  transform:scale(.7) translateZ(0);
  border-color:rgba(138,43,226,.45);
  box-shadow:0 0 55px rgba(138,43,226,.35),0 0 100px rgba(75,0,130,.25);
}
.circle:hover:not(.breathing){border-color:rgba(255,255,255,.18)}
.circle:focus{outline:none}
.circle:focus-visible{outline:2px solid rgba(255,255,255,.3);outline-offset:12px}

.word{
  font-size:clamp(1rem,3vw,1.35rem);
  font-weight:400;
  letter-spacing:.25em;
  padding-left:.25em;
  text-transform:uppercase;
  opacity:.88;
  transition:opacity .8s ease,transform .8s ease;
  user-select:none;
}
.hint{
  font-size:clamp(.78rem,2.1vw,.95rem);
  font-weight:300;
  letter-spacing:.12em;
  margin-top:.6rem;
  opacity:.4;
  transition:opacity .8s ease;
  color:var(--dim);
}
.breathing .hint{opacity:0;pointer-events:none}
.phase{
  font-size:clamp(.72rem,1.9vw,.9rem);
  font-weight:300;
  letter-spacing:.14em;
  margin-top:.45rem;
  opacity:0;
  transition:opacity .8s ease;
  color:var(--dim);
}
.breathing .phase{opacity:1}
.timer{
  font-size:clamp(.62rem,1.6vw,.78rem);
  font-weight:400;
  letter-spacing:.08em;
  margin-top:.35rem;
  opacity:0;
  color:var(--faint);
  transition:opacity .8s ease;
}
.breathing .timer{opacity:1}

/* Wisdom area */
.wisdom-area{
  position:absolute;
  bottom:max(10vh,65px);
  text-align:center;
  max-width:min(88%,400px);
  padding:0 1rem;
}
.wisdom{
  font-size:clamp(.82rem,2.2vw,1rem);
  font-weight:300;
  letter-spacing:.04em;
  line-height:1.75;
  opacity:0;
  transition:opacity 2.5s ease;
  font-style:italic;
  color:rgba(255,255,255,.5);
}
.active .wisdom{opacity:1}
.session-msg{
  margin-top:.9rem;
  font-size:clamp(.78rem,1.9vw,.9rem);
  font-weight:400;
  letter-spacing:.1em;
  opacity:0;
  color:var(--dim);
  transition:opacity 1.8s ease;
  line-height:1.75;
}
.session-msg.show{opacity:1}
.session-msg .count{color:var(--accent);font-weight:500}
.session-msg .lifetime{font-size:.82em;opacity:.65;margin-top:.4rem;display:block}

/* Energy/Donate section */
.energy{
  position:absolute;
  bottom:max(2.5vh,12px);
  font-size:clamp(.72rem,1.7vw,.85rem);
  font-weight:300;
  letter-spacing:.08em;
  opacity:.28;
  transition:opacity .4s ease;
  color:var(--dim);
  display:flex;
  align-items:center;
  gap:.5rem;
}
.energy:hover{opacity:.55}
.energy-btn{
  background:none;
  border:none;
  color:inherit;
  font-size:1.15rem;
  cursor:pointer;
  padding:.4rem;
  opacity:.7;
  transition:all .3s cubic-bezier(.4,0,.2,1);
  min-width:42px;min-height:42px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-decoration:none;
  border-radius:50%;
}
.energy-btn:hover{opacity:1;color:var(--light);transform:scale(1.1);background:rgba(255,255,255,.06)}

/* Toast */
.toast{
  position:fixed;
  bottom:16%;
  left:50%;
  transform:translateX(-50%) translateY(15px);
  background:rgba(5,5,5,.95);
  border:1px solid var(--border);
  padding:.9rem 1.6rem;
  border-radius:14px;
  font-size:.85rem;
  font-weight:400;
  letter-spacing:.06em;
  opacity:0;
  pointer-events:none;
  transition:all .4s cubic-bezier(.4,0,.2,1);
  z-index:300;
  text-align:center;
  max-width:88%;
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast .icon{font-size:1.2rem;margin-bottom:.4rem;display:block}

/* Update banner (backup) */
.update-banner{
  position:fixed;
  top:0;
  left:0;
  right:0;
  background:linear-gradient(135deg,rgba(74,222,128,.12),rgba(34,197,94,.08));
  border-bottom:1px solid rgba(74,222,128,.25);
  padding:.65rem 1rem;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:.8rem;
  z-index:400;
  transform:translateY(-100%);
  transition:transform .4s cubic-bezier(.4,0,.2,1);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
}
.update-banner.show{transform:translateY(0)}
.update-banner span{font-size:.8rem;letter-spacing:.05em;color:rgba(255,255,255,.8)}
.update-banner button{
  background:rgba(74,222,128,.15);
  border:1px solid rgba(74,222,128,.35);
  color:var(--green);
  padding:.35rem .9rem;
  font-size:.75rem;
  font-weight:500;
  letter-spacing:.08em;
  cursor:pointer;
  border-radius:8px;
  transition:all .3s;
}
.update-banner button:hover{background:rgba(74,222,128,.25);color:#fff}

/* Modals */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.92);
  z-index:250;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:opacity .35s ease;
  backdrop-filter:blur(5px);
  -webkit-backdrop-filter:blur(5px);
}
.modal.show{opacity:1;pointer-events:auto}
.modal-content{
  background:rgba(8,8,8,.98);
  border:1px solid var(--border);
  border-radius:18px;
  padding:1.8rem;
  text-align:center;
  max-width:min(90%,320px);
  max-height:80vh;
  overflow-y:auto;
  transform:scale(.96);
  transition:transform .35s cubic-bezier(.4,0,.2,1);
}
.modal.show .modal-content{transform:scale(1)}
.modal-content h3{font-size:.95rem;font-weight:500;letter-spacing:.12em;margin-bottom:1.1rem;color:var(--dim)}
.modal-close{
  background:none;
  border:1px solid var(--border);
  color:var(--dim);
  padding:.7rem 1.6rem;
  font-size:.8rem;
  font-weight:400;
  letter-spacing:.1em;
  cursor:pointer;
  border-radius:10px;
  transition:all .3s;
  margin-top:.9rem;
}
.modal-close:hover{border-color:rgba(255,255,255,.25);color:var(--light)}
.donate-qr{width:150px;height:150px;margin:0 auto 1rem;background:#fff;border-radius:12px;padding:8px}
.donate-qr img{width:100%;height:100%;border-radius:4px}
.donate-address{
  font-size:.65rem;
  font-family:'SF Mono',Monaco,monospace;
  letter-spacing:.02em;
  color:var(--faint);
  word-break:break-all;
  margin-bottom:1rem;
  padding:.9rem;
  background:var(--glass);
  border-radius:10px;
  cursor:pointer;
  transition:all .3s;
}
.donate-address:hover{background:rgba(255,255,255,.08);color:var(--light)}
.ios-steps{text-align:left;font-size:.85rem;line-height:2;color:var(--dim);margin-bottom:.9rem}
.ios-steps span{font-size:1rem;margin-right:.4rem}
.lang-grid{display:grid;grid-template-columns:1fr 1fr;gap:.4rem;margin-bottom:.9rem}
.lang-btn{
  padding:.7rem .4rem;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:10px;
  color:var(--dim);
  font-size:.8rem;
  font-weight:400;
  cursor:pointer;
  transition:all .25s;
}
.lang-btn:hover{background:rgba(255,255,255,.08);color:var(--light)}
.lang-btn.selected{border-color:var(--accent-dim);background:rgba(255,105,180,.08);color:var(--light)}

/* Menu - BIGGER ICONS */
.menu{
  position:fixed;
  top:0;
  right:-320px;
  width:min(285px,85vw);
  height:100%;
  background:rgba(5,5,5,.98);
  border-left:1px solid var(--border);
  z-index:200;
  transition:right .35s cubic-bezier(.4,0,.2,1);
  overflow-y:auto;
  overflow-x:hidden;
  padding:1.4rem;
  display:flex;
  flex-direction:column;
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
}
.menu.open{right:0}
.menu-close{
  position:absolute;
  top:.9rem;right:.9rem;
  background:none;
  border:none;
  color:var(--dim);
  font-size:1.8rem;
  cursor:pointer;
  transition:all .3s;
  width:44px;height:44px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
}
.menu-close:hover{color:var(--light);background:rgba(255,255,255,.05)}
.menu h3{
  font-size:.68rem;
  font-weight:500;
  letter-spacing:.18em;
  color:var(--faint);
  margin:1.1rem 0 .5rem;
  text-transform:uppercase;
}
.menu h3:first-of-type{margin-top:.6rem}
.menu-item{
  display:flex;
  align-items:center;
  padding:.65rem .85rem;
  margin:.12rem 0;
  background:transparent;
  border:1px solid transparent;
  border-radius:10px;
  cursor:pointer;
  transition:all .25s;
  font-size:.88rem;
  font-weight:400;
  color:var(--dim);
}
.menu-item:hover{background:var(--glass);color:var(--light)}
.menu-item.selected{border-color:var(--accent-dim);background:rgba(255,105,180,.06);color:var(--light)}
.menu-item .journey-icon{
  width:22px;height:22px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-right:.6rem;
  font-size:1rem;
  opacity:.65;
  flex-shrink:0;
}
.menu-item.selected .journey-icon{opacity:1;color:var(--accent)}
.menu-divider{height:1px;background:var(--border);margin:.7rem 0}
.breath-row,.time-row{display:flex;gap:.35rem}
.breath-btn,.time-btn{
  flex:1;
  padding:.58rem .15rem;
  background:transparent;
  border:1px solid transparent;
  border-radius:8px;
  color:var(--dim);
  font-size:.72rem;
  font-weight:400;
  cursor:pointer;
  transition:all .25s;
}
.breath-btn:hover,.time-btn:hover{background:var(--glass);color:var(--light)}
.breath-btn.selected,.time-btn.selected{border-color:var(--accent-dim);background:rgba(255,105,180,.06);color:var(--light)}
.menu-icons{
  margin-top:auto;
  padding-top:.7rem;
  border-top:1px solid var(--border);
  display:flex;
  justify-content:center;
  gap:.3rem;
}
.menu-icon-btn{
  width:46px;height:46px;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:10px;
  color:var(--dim);
  font-size:1.15rem;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all .3s;
}
.menu-icon-btn:hover{background:rgba(255,255,255,.08);color:var(--light);border-color:rgba(255,255,255,.15)}
.menu-icon-btn.on{background:rgba(255,105,180,.12);border-color:var(--accent-dim);color:var(--accent)}
.menu-icon-btn.hidden{display:none}
.menu-version{
  text-align:center;
  font-size:.68rem;
  letter-spacing:.08em;
  color:var(--faint);
  opacity:.5;
  margin-top:.6rem;
}
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  z-index:150;
  opacity:0;
  pointer-events:none;
  transition:opacity .35s;
}
.overlay.show{opacity:1;pointer-events:auto}
.sr{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}

/* High contrast mode */
body.contrast .circle{border:2px solid #fff;box-shadow:0 0 40px rgba(255,255,255,.25)}
body.contrast .word,body.contrast .phase,body.contrast .wisdom,body.contrast .title{-webkit-text-fill-color:#fff;color:#fff;opacity:1}
body.contrast .cosmos{opacity:.3}

/* Reduced motion */
@media(prefers-reduced-motion:reduce){*{animation:none!important;transition-duration:.1s!important}}

/* Responsive */
@media(max-width:600px){
  .title{top:max(8vh,50px);font-size:clamp(1.25rem,4.5vw,1.7rem);letter-spacing:.35em;padding-left:.35em}
  .controls-left,.controls-right{top:10px}
  .controls-left{left:10px}
  .controls-right{right:10px;gap:.35rem}
  .ctrl{width:46px;height:46px;font-size:1.35rem}
  .circle{width:min(195px,50vw);height:min(195px,50vw)}
  .wisdom-area{bottom:max(8vh,55px)}
  .energy{gap:.35rem}
  .energy-btn{min-width:40px;min-height:40px;font-size:1.1rem}
  .menu{padding:1.1rem}
  .menu-icons{gap:.25rem}
  .menu-icon-btn{width:44px;height:44px;font-size:1.05rem}
  .breath-btn,.time-btn{font-size:.68rem;padding:.52rem .1rem}
}
@media(max-width:380px){
  .title{top:max(6vh,42px);font-size:1.15rem;letter-spacing:.28em;padding-left:.28em}
  .controls-left{left:8px}
  .controls-right{right:8px;gap:.3rem}
  .ctrl{width:42px;height:42px;font-size:1.25rem}
  .circle{width:min(175px,48vw);height:min(175px,48vw)}
  .menu{width:90vw;padding:1rem}
  .wisdom-area{bottom:max(7vh,48px)}
  .menu-icon-btn{width:40px;height:40px;font-size:1rem}
}
@media(min-width:1200px){
  .title{font-size:3rem}
  .ctrl{width:54px;height:54px;font-size:1.6rem}
  .circle{width:min(280px,30vw);height:min(280px,30vw)}
  .menu-icon-btn{width:50px;height:50px;font-size:1.25rem}
}
@media(min-height:900px){
  .wisdom-area{bottom:max(12vh,90px)}
}
</style>
</head>
<body>
<div class="cosmos"></div>

<!-- Update Banner (backup/alternative) -->
<div class="update-banner" id="updateBanner">
  <span>‚ú® New version available</span>
  <button id="bannerUpdateBtn">Update</button>
</div>

<div class="field">
  <h1 class="title notranslate" translate="no">INNERA FIELD</h1>
  <div class="streak" id="streak"><span class="flame">üî•</span><span id="streakCount">0</span></div>
  
  <div class="controls-left">
    <!-- UPDATE BUTTON - Hidden by default, shows when update available -->
    <button class="ctrl update" id="updateBtn" aria-label="Update available" title="Update available">‚Üë</button>
    <button class="ctrl" id="shareBtn" aria-label="Share" title="Share">‚Üó</button>
    <button class="ctrl hidden" id="installBtnTop" aria-label="Install" title="Install">‚¨á</button>
  </div>
  
  <div class="controls-right">
    <button class="ctrl" id="soundBtn" aria-label="Sound" aria-pressed="false" title="Sound">‚ô™</button>
    <button class="ctrl" id="contrastBtn" aria-label="High contrast" aria-pressed="false" title="Contrast">‚óê</button>
    <button class="ctrl" id="menuBtn" aria-label="Open menu" title="Menu">‚ò∞</button>
  </div>
  
  <div class="circle idle" id="circle" role="button" tabindex="0" aria-label="Breathing circle. Tap to begin.">
    <span class="word" id="word">breathe</span>
    <span class="hint" id="hint">tap to begin</span>
    <span class="phase" id="phase"></span>
    <span class="timer" id="timerDisplay"></span>
  </div>
  
  <div class="wisdom-area">
    <p class="wisdom notranslate" translate="no" id="wisdom"></p>
    <p class="session-msg" id="sessionMsg"></p>
  </div>
  
  <div class="energy">
    <span id="energyText">if this serves you</span>
    <a class="energy-btn" href="https://ko-fi.com/innerafield" target="_blank" rel="noopener" title="Ko-fi">‚ô°</a>
    <a class="energy-btn" href="https://www.paypal.com/ncp/payment/3MLTXSEW9L3RL" target="_blank" rel="noopener" title="PayPal">$</a>
    <button class="energy-btn" id="btcBtn" title="Bitcoin">‚Çø</button>
    <button class="energy-btn" id="ethBtn" title="Ethereum">Œû</button>
  </div>
  
  <div class="sr" id="sr" role="status" aria-live="assertive"></div>
</div>

<div class="toast" id="toast"></div>

<div class="modal" id="donateModal"><div class="modal-content"><h3 id="donateTitle">BITCOIN</h3><div class="donate-qr"><img id="donateQR" src="" alt="QR Code"></div><div class="donate-address" id="donateAddress" title="Click to copy"></div><button class="modal-close" id="donateClose">close</button></div></div>

<div class="modal" id="iosModal"><div class="modal-content"><h3 id="iosTitle">Add to Home Screen</h3><div class="ios-steps"><div><span>1.</span> Tap Share <b>‚éô</b></div><div><span>2.</span> Tap <b>Add to Home Screen</b></div><div><span>3.</span> Tap <b>Add</b></div></div><button class="modal-close" id="iosClose">got it</button></div></div>

<div class="modal" id="langModal"><div class="modal-content"><h3 id="langTitle">Language</h3><div class="lang-grid"><button class="lang-btn selected" data-lang="en">English</button><button class="lang-btn" data-lang="es">Espa√±ol</button><button class="lang-btn" data-lang="zh">‰∏≠Êñá</button><button class="lang-btn" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button><button class="lang-btn" data-lang="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button><button class="lang-btn" data-lang="pt">Portugu√™s</button><button class="lang-btn" data-lang="ru">–†—É—Å—Å–∫–∏–π</button><button class="lang-btn" data-lang="ja">Êó•Êú¨Ë™û</button><button class="lang-btn" data-lang="ko">ÌïúÍµ≠Ïñ¥</button><button class="lang-btn" data-lang="fr">Fran√ßais</button></div><button class="modal-close" id="langClose">close</button></div></div>

<div class="overlay" id="overlay"></div>

<nav class="menu" id="menu" aria-label="Settings">
  <button class="menu-close" id="menuClose" aria-label="Close menu">√ó</button>
  <h3 id="journeyLabel">Journey</h3>
  <div class="menu-item selected" data-journey="heart"><span class="journey-icon">‚ô°</span><span data-i18n="heart">Heart Opening</span></div>
  <div class="menu-item" data-journey="awakening"><span class="journey-icon">‚úß</span><span data-i18n="awakening">Awakening</span></div>
  <div class="menu-item" data-journey="grounding"><span class="journey-icon">‚¨°</span><span data-i18n="grounding">Grounding</span></div>
  <div class="menu-item" data-journey="unity"><span class="journey-icon">‚àû</span><span data-i18n="unity">Unity</span></div>
  <div class="menu-item" data-journey="peace"><span class="journey-icon">‚óØ</span><span data-i18n="peace">Deep Peace</span></div>
  <div class="menu-divider"></div>
  <h3 id="breathworkLabel">Breathwork</h3>
  <div class="breath-row">
    <button class="breath-btn selected" data-breath="balance" data-i18n="balance">Balance</button>
    <button class="breath-btn" data-breath="calm" data-i18n="calm">Calm</button>
    <button class="breath-btn" data-breath="energy" data-i18n="energy">Energy</button>
    <button class="breath-btn" data-breath="deep" data-i18n="deep">Deep</button>
  </div>
  <div class="menu-divider"></div>
  <h3 id="durationLabel">Duration</h3>
  <div class="time-row">
    <button class="time-btn" data-time="300" data-i18n="min5">5 min</button>
    <button class="time-btn selected" data-time="600" data-i18n="min10">10 min</button>
    <button class="time-btn" data-time="1200" data-i18n="min20">20 min</button>
    <button class="time-btn" data-time="0">‚àû</button>
  </div>
  <div class="menu-divider"></div>
  <div class="menu-icons">
    <button class="menu-icon-btn" id="voiceBtn" title="Voice" aria-label="Voice">üîà</button>
    <button class="menu-icon-btn" id="langBtn" title="Language" aria-label="Language">üåê</button>
    <button class="menu-icon-btn" id="menuShareBtn" title="Share" aria-label="Share">‚Üó</button>
    <button class="menu-icon-btn hidden" id="installBtn" title="Install" aria-label="Install">‚¨á</button>
  </div>
  <div class="menu-version" id="versionDisplay">v3.3.1</div>
</nav>

<script>
(function(){'use strict';

const VERSION='3.3.1';

/* Translations */
const LANG={
  en:{breathe:'breathe',breatheIn:'breathe in',hold:'hold',release:'release',releaseSlow:'release slowly',rest:'rest',tapToBegin:'tap to begin',heart:'Heart Opening',awakening:'Awakening',grounding:'Grounding',unity:'Unity',peace:'Deep Peace',journey:'Journey',breathwork:'Breathwork',duration:'Duration',language:'Language',ifServes:'if this serves you',breathsWith:'breaths with Source',returnWhen:'return when you forget.',voiceOn:'voice on',voiceOff:'voice off',linkCopied:'link copied ‚úì',shareThePeace:'share the peace',installing:'installing...',addToHome:'Add to Home Screen',headphones:'headphones enhance the experience',close:'close',gotIt:'got it',balance:'Balance',calm:'Calm',energy:'Energy',deep:'Deep',min5:'5 min',min10:'10 min',min20:'20 min',lifetimeBreaths:'lifetime breaths',welcomeBack:'welcome back',dayStreak:'day streak',updateAvailable:'update available',update:'Update',updating:'updating...'},
  es:{breathe:'respira',breatheIn:'inhala',hold:'sost√©n',release:'exhala',releaseSlow:'exhala lento',rest:'descansa',tapToBegin:'toca para comenzar',heart:'Apertura del Coraz√≥n',awakening:'Despertar',grounding:'Arraigo',unity:'Unidad',peace:'Paz Profunda',journey:'Viaje',breathwork:'Respiraci√≥n',duration:'Duraci√≥n',language:'Idioma',ifServes:'si te sirve',breathsWith:'respiraciones con la Fuente',returnWhen:'regresa cuando olvides.',voiceOn:'voz activada',voiceOff:'voz desactivada',linkCopied:'enlace copiado ‚úì',shareThePeace:'comparte la paz',installing:'instalando...',addToHome:'A√±adir a Inicio',headphones:'auriculares mejoran la experiencia',close:'cerrar',gotIt:'entendido',balance:'Equilibrio',calm:'Calma',energy:'Energ√≠a',deep:'Profundo',min5:'5 min',min10:'10 min',min20:'20 min',lifetimeBreaths:'respiraciones totales',welcomeBack:'bienvenido',dayStreak:'d√≠as seguidos',updateAvailable:'actualizaci√≥n disponible',update:'Actualizar',updating:'actualizando...'},
  zh:{breathe:'ÂëºÂê∏',breatheIn:'Âê∏Ê∞î',hold:'Â±èÊÅØ',release:'ÂëºÊ∞î',releaseSlow:'ÊÖ¢ÊÖ¢ÂëºÊ∞î',rest:'‰ºëÊÅØ',tapToBegin:'ÁÇπÂáªÂºÄÂßã',heart:'ÂøÉËΩÆÂºÄÂêØ',awakening:'ËßâÈÜí',grounding:'ÊâéÊ†π',unity:'Âêà‰∏Ä',peace:'Ê∑±Â∫¶Âπ≥Èùô',journey:'ÊóÖÁ®ã',breathwork:'ÂëºÂê∏Ê≥ï',duration:'Êó∂Èïø',language:'ËØ≠Ë®Ä',ifServes:'Â¶ÇÊûúÊúâÂ∏ÆÂä©',breathsWith:'Ê¨°ÂëºÂê∏',returnWhen:'ÂøòËÆ∞Êó∂ËØ∑ÂõûÊù•',voiceOn:'ËØ≠Èü≥ÂºÄÂêØ',voiceOff:'ËØ≠Èü≥ÂÖ≥Èó≠',linkCopied:'Â∑≤Â§çÂà∂ ‚úì',shareThePeace:'ÂàÜ‰∫´Âπ≥Èùô',installing:'ÂÆâË£Ö‰∏≠...',addToHome:'Ê∑ªÂä†Âà∞‰∏ªÂ±èÂπï',headphones:'ËÄ≥Êú∫Â¢ûÂº∫‰ΩìÈ™å',close:'ÂÖ≥Èó≠',gotIt:'Áü•ÈÅì‰∫Ü',balance:'Âπ≥Ë°°',calm:'Âπ≥Èùô',energy:'ËÉΩÈáè',deep:'Ê∑±Â∫¶',min5:'5ÂàÜÈíü',min10:'10ÂàÜÈíü',min20:'20ÂàÜÈíü',lifetimeBreaths:'ÊÄªÂëºÂê∏Ê¨°Êï∞',welcomeBack:'Ê¨¢ËøéÂõûÊù•',dayStreak:'Â§©ËøûÁª≠',updateAvailable:'ÊúâÊñ∞ÁâàÊú¨',update:'Êõ¥Êñ∞',updating:'Êõ¥Êñ∞‰∏≠...'},
  hi:{breathe:'‡§∏‡§æ‡§Å‡§∏',breatheIn:'‡§∏‡§æ‡§Å‡§∏ ‡§≤‡•ã',hold:'‡§∞‡•ã‡§ï‡•ã',release:'‡§õ‡•ã‡§°‡§º‡•ã',releaseSlow:'‡§ß‡•Ä‡§∞‡•á ‡§õ‡•ã‡§°‡§º‡•ã',rest:'‡§µ‡§ø‡§∂‡•ç‡§∞‡§æ‡§Æ',tapToBegin:'‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç',heart:'‡§π‡•É‡§¶‡§Ø ‡§ñ‡•ã‡§≤‡§®‡§æ',awakening:'‡§ú‡§æ‡§ó‡•É‡§§‡§ø',grounding:'‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§°‡§ø‡§Ç‡§ó',unity:'‡§è‡§ï‡§§‡§æ',peace:'‡§ó‡§π‡§∞‡•Ä ‡§∂‡§æ‡§Ç‡§§‡§ø',journey:'‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ',breathwork:'‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ',duration:'‡§Ö‡§µ‡§ß‡§ø',language:'‡§≠‡§æ‡§∑‡§æ',ifServes:'‡§Ö‡§ó‡§∞ ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•á',breathsWith:'‡§∏‡§æ‡§Å‡§∏‡•á‡§Ç',returnWhen:'‡§ú‡§¨ ‡§≠‡•Ç‡§≤ ‡§ú‡§æ‡§ì ‡§≤‡•å‡§ü ‡§Ü‡§ì',voiceOn:'‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ö‡§æ‡§≤‡•Ç',voiceOff:'‡§Ü‡§µ‡§æ‡§ú‡§º ‡§¨‡§Ç‡§¶',linkCopied:'‡§ï‡•â‡§™‡•Ä ‚úì',shareThePeace:'‡§∂‡§æ‡§Ç‡§§‡§ø ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç',installing:'‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§π‡•ã ‡§∞‡§π‡§æ...',addToHome:'‡§π‡•ã‡§Æ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',headphones:'‡§π‡•á‡§°‡§´‡•ã‡§® ‡§∏‡•á ‡§¨‡•á‡§π‡§§‡§∞ ‡§Ö‡§®‡•Å‡§≠‡§µ',close:'‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',gotIt:'‡§∏‡§Æ‡§ù ‡§ó‡§Ø‡§æ',balance:'‡§∏‡§Ç‡§§‡•Å‡§≤‡§®',calm:'‡§∂‡§æ‡§Ç‡§§',energy:'‡§ä‡§∞‡•ç‡§ú‡§æ',deep:'‡§ó‡§π‡§∞‡§æ',min5:'5 ‡§Æ‡§ø‡§®‡§ü',min10:'10 ‡§Æ‡§ø‡§®‡§ü',min20:'20 ‡§Æ‡§ø‡§®‡§ü',lifetimeBreaths:'‡§ï‡•Å‡§≤ ‡§∏‡§æ‡§Å‡§∏‡•á‡§Ç',welcomeBack:'‡§µ‡§æ‡§™‡§∏‡•Ä ‡§™‡§∞ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§',dayStreak:'‡§¶‡§ø‡§® ‡§≤‡§ó‡§æ‡§§‡§æ‡§∞',updateAvailable:'‡§Ö‡§™‡§°‡•á‡§ü ‡§â‡§™‡§≤‡§¨‡•ç‡§ß',update:'‡§Ö‡§™‡§°‡•á‡§ü',updating:'‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ...'},
  ar:{breathe:'ÿ™ŸÜŸÅÿ≥',breatheIn:'ÿ¥ŸáŸäŸÇ',hold:'ÿßÿ≠ÿ®ÿ≥',release:'ÿ≤ŸÅŸäÿ±',releaseSlow:'ÿ≤ŸÅŸäÿ± ÿ®ÿ®ÿ∑ÿ°',rest:'ÿßÿ≥ÿ™ÿ±ÿ≠',tapToBegin:'ÿßŸÜŸÇÿ± ŸÑŸÑÿ®ÿØÿ°',heart:'ŸÅÿ™ÿ≠ ÿßŸÑŸÇŸÑÿ®',awakening:'ÿßŸÑÿµÿ≠Ÿàÿ©',grounding:'ÿßŸÑÿ™ÿ£ÿ±Ÿäÿ∂',unity:'ÿßŸÑŸàÿ≠ÿØÿ©',peace:'ÿßŸÑÿ≥ŸÑÿßŸÖ ÿßŸÑÿπŸÖŸäŸÇ',journey:'ÿßŸÑÿ±ÿ≠ŸÑÿ©',breathwork:'ÿ™ŸÖÿßÿ±ŸäŸÜ ÿßŸÑÿ™ŸÜŸÅÿ≥',duration:'ÿßŸÑŸÖÿØÿ©',language:'ÿßŸÑŸÑÿ∫ÿ©',ifServes:'ÿ•ÿ∞ÿß ÿ£ŸÅÿßÿØŸÉ',breathsWith:'ÿ£ŸÜŸÅÿßÿ≥',returnWhen:'ÿπÿØ ÿπŸÜÿØŸÖÿß ÿ™ŸÜÿ≥Ÿâ',voiceOn:'ÿßŸÑÿµŸàÿ™ ŸÖŸÅÿπŸÑ',voiceOff:'ÿßŸÑÿµŸàÿ™ ŸÖÿπÿ∑ŸÑ',linkCopied:'ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ ‚úì',shareThePeace:'ÿ¥ÿßÿ±ŸÉ ÿßŸÑÿ≥ŸÑÿßŸÖ',installing:'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™...',addToHome:'ÿ£ÿ∂ŸÅ ŸÑŸÑÿ¥ÿßÿ¥ÿ©',headphones:'ÿßŸÑÿ≥ŸÖÿßÿπÿßÿ™ ÿ™ÿπÿ≤ÿ≤ ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ©',close:'ÿ•ÿ∫ŸÑÿßŸÇ',gotIt:'ŸÅŸáŸÖÿ™',balance:'ÿ™Ÿàÿßÿ≤ŸÜ',calm:'ŸáÿØŸàÿ°',energy:'ÿ∑ÿßŸÇÿ©',deep:'ÿπŸÖŸäŸÇ',min5:'5 ÿØŸÇÿßÿ¶ŸÇ',min10:'10 ÿØŸÇÿßÿ¶ŸÇ',min20:'20 ÿØŸÇŸäŸÇÿ©',lifetimeBreaths:'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ŸÜŸÅÿßÿ≥',welcomeBack:'ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ÿπŸàÿØÿ™ŸÉ',dayStreak:'ÿ£ŸäÿßŸÖ ŸÖÿ™ÿ™ÿßŸÑŸäÿ©',updateAvailable:'ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ™ÿßÿ≠',update:'ÿ™ÿ≠ÿØŸäÿ´',updating:'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ÿØŸäÿ´...'},
  pt:{breathe:'respire',breatheIn:'inspire',hold:'segure',release:'expire',releaseSlow:'expire devagar',rest:'descanse',tapToBegin:'toque para come√ßar',heart:'Abertura do Cora√ß√£o',awakening:'Despertar',grounding:'Aterramento',unity:'Unidade',peace:'Paz Profunda',journey:'Jornada',breathwork:'Respira√ß√£o',duration:'Dura√ß√£o',language:'Idioma',ifServes:'se te servir',breathsWith:'respira√ß√µes',returnWhen:'volte quando esquecer',voiceOn:'voz ativada',voiceOff:'voz desativada',linkCopied:'copiado ‚úì',shareThePeace:'compartilhe a paz',installing:'instalando...',addToHome:'Adicionar √† Tela',headphones:'fones melhoram a experi√™ncia',close:'fechar',gotIt:'entendi',balance:'Equil√≠brio',calm:'Calma',energy:'Energia',deep:'Profundo',min5:'5 min',min10:'10 min',min20:'20 min',lifetimeBreaths:'respira√ß√µes totais',welcomeBack:'bem-vindo',dayStreak:'dias seguidos',updateAvailable:'atualiza√ß√£o dispon√≠vel',update:'Atualizar',updating:'atualizando...'},
  ru:{breathe:'–¥—ã—à–∏',breatheIn:'–≤–¥–æ—Ö',hold:'–∑–∞–¥–µ—Ä–∂–∫–∞',release:'–≤—ã–¥–æ—Ö',releaseSlow:'–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤—ã–¥–æ—Ö',rest:'–æ—Ç–¥—ã—Ö',tapToBegin:'–Ω–∞–∂–º–∏—Ç–µ',heart:'–û—Ç–∫—Ä—ã—Ç–∏–µ –°–µ—Ä–¥—Ü–∞',awakening:'–ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ',grounding:'–ó–∞–∑–µ–º–ª–µ–Ω–∏–µ',unity:'–ï–¥–∏–Ω—Å—Ç–≤–æ',peace:'–ì–ª—É–±–æ–∫–∏–π –ü–æ–∫–æ–π',journey:'–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ',breathwork:'–î—ã—Ö–∞–Ω–∏–µ',duration:'–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å',language:'–Ø–∑—ã–∫',ifServes:'–µ—Å–ª–∏ –ø–æ–º–æ–∂–µ—Ç',breathsWith:'–≤–¥–æ—Ö–æ–≤',returnWhen:'–≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å',voiceOn:'–≥–æ–ª–æ—Å –≤–∫–ª',voiceOff:'–≥–æ–ª–æ—Å –≤—ã–∫–ª',linkCopied:'—Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úì',shareThePeace:'–ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–æ–∫–æ–µ–º',installing:'—É—Å—Ç–∞–Ω–æ–≤–∫–∞...',addToHome:'–ù–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω',headphones:'–Ω–∞—É—à–Ω–∏–∫–∏ —É—Å–∏–ª—è—Ç —ç—Ñ—Ñ–µ–∫—Ç',close:'–∑–∞–∫—Ä—ã—Ç—å',gotIt:'–ø–æ–Ω—è—Ç–Ω–æ',balance:'–ë–∞–ª–∞–Ω—Å',calm:'–ü–æ–∫–æ–π',energy:'–≠–Ω–µ—Ä–≥–∏—è',deep:'–ì–ª—É–±–∏–Ω–∞',min5:'5 –º–∏–Ω',min10:'10 –º–∏–Ω',min20:'20 –º–∏–Ω',lifetimeBreaths:'–≤—Å–µ–≥–æ –≤–¥–æ—Ö–æ–≤',welcomeBack:'—Å –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º',dayStreak:'–¥–Ω–µ–π –ø–æ–¥—Ä—è–¥',updateAvailable:'–¥–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ',update:'–û–±–Ω–æ–≤–∏—Ç—å',updating:'–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...'},
  ja:{breathe:'ÂëºÂê∏',breatheIn:'Âê∏„ÅÜ',hold:'Ê≠¢„ÇÅ„Çã',release:'Âêê„Åè',releaseSlow:'„ÇÜ„Å£„Åè„ÇäÂêê„Åè',rest:'‰ºë„ÇÄ',tapToBegin:'„Çø„ÉÉ„Éó„Åó„Å¶ÈñãÂßã',heart:'„Éè„Éº„Éà„ÇíÈñã„Åè',awakening:'ÁõÆË¶ö„ÇÅ',grounding:'„Ç∞„É©„Ç¶„É≥„Éá„Ç£„É≥„Ç∞',unity:'Áµ±‰∏Ä',peace:'Ê∑±„ÅÑÂπ≥Âíå',journey:'„Ç∏„É£„Éº„Éã„Éº',breathwork:'ÂëºÂê∏Ê≥ï',duration:'ÊôÇÈñì',language:'Ë®ÄË™û',ifServes:'„ÅäÂΩπ„Å´Á´ã„Å¶„Çå„Å∞',breathsWith:'Âõû„ÅÆÂëºÂê∏',returnWhen:'Âøò„Çå„ÅüÊôÇ„Å´',voiceOn:'Èü≥Â£∞„Ç™„É≥',voiceOff:'Èü≥Â£∞„Ç™„Éï',linkCopied:'„Ç≥„Éî„Éº ‚úì',shareThePeace:'Âπ≥Âíå„ÇíÂÖ±Êúâ',installing:'„Ç§„É≥„Çπ„Éà„Éº„É´‰∏≠...',addToHome:'„Éõ„Éº„É†„Å´ËøΩÂä†',headphones:'„Éò„ÉÉ„Éâ„Éõ„É≥Êé®Â•®',close:'Èñâ„Åò„Çã',gotIt:'‰∫ÜËß£',balance:'„Éê„É©„É≥„Çπ',calm:'Á©è„ÇÑ„Åã',energy:'„Ç®„Éç„É´„ÇÆ„Éº',deep:'Ê∑±„ÅÑ',min5:'5ÂàÜ',min10:'10ÂàÜ',min20:'20ÂàÜ',lifetimeBreaths:'Á∑èÂëºÂê∏Êï∞',welcomeBack:'„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑ',dayStreak:'Êó•ÈÄ£Á∂ö',updateAvailable:'Êõ¥Êñ∞„Åå„ÅÇ„Çä„Åæ„Åô',update:'Êõ¥Êñ∞',updating:'Êõ¥Êñ∞‰∏≠...'},
  ko:{breathe:'Ïà®Ïâ¨Í∏∞',breatheIn:'Îì§Ïù¥Ïâ¨Í∏∞',hold:'Î©àÏ∂îÍ∏∞',release:'ÎÇ¥Ïâ¨Í∏∞',releaseSlow:'Ï≤úÏ≤úÌûà ÎÇ¥Ïâ¨Í∏∞',rest:'Ïâ¨Í∏∞',tapToBegin:'ÌÉ≠ÌïòÏó¨ ÏãúÏûë',heart:'Ïã¨Ïû• Ïó¥Í∏∞',awakening:'Í∞ÅÏÑ±',grounding:'Í∑∏ÎùºÏö¥Îî©',unity:'ÌïòÎÇòÎê®',peace:'ÍπäÏùÄ ÌèâÌôî',journey:'Ïó¨Ï†ï',breathwork:'Ìò∏Ìù°Î≤ï',duration:'ÏãúÍ∞Ñ',language:'Ïñ∏Ïñ¥',ifServes:'ÎèÑÏõÄÏù¥ ÎêúÎã§Î©¥',breathsWith:'Î≤à Ìò∏Ìù°',returnWhen:'ÏûäÏùÑ Îïå ÎèåÏïÑÏò§ÏÑ∏Ïöî',voiceOn:'ÏùåÏÑ± ÏºúÍ∏∞',voiceOff:'ÏùåÏÑ± ÎÅÑÍ∏∞',linkCopied:'Î≥µÏÇ¨Îê® ‚úì',shareThePeace:'ÌèâÌôîÎ•º ÎÇòÎàÑÏÑ∏Ïöî',installing:'ÏÑ§Ïπò Ï§ë...',addToHome:'ÌôàÏóê Ï∂îÍ∞Ä',headphones:'Ìó§ÎìúÌè∞ Í∂åÏû•',close:'Îã´Í∏∞',gotIt:'ÏïåÍ≤†ÏäµÎãàÎã§',balance:'Í∑†Ìòï',calm:'ÌèâÏò®',energy:'ÏóêÎÑàÏßÄ',deep:'ÍπäÏùÄ',min5:'5Î∂Ñ',min10:'10Î∂Ñ',min20:'20Î∂Ñ',lifetimeBreaths:'Ï¥ù Ìò∏Ìù°',welcomeBack:'ÌôòÏòÅÌï©ÎãàÎã§',dayStreak:'Ïùº Ïó∞ÏÜç',updateAvailable:'ÏóÖÎç∞Ïù¥Ìä∏ Í∞ÄÎä•',update:'ÏóÖÎç∞Ïù¥Ìä∏',updating:'ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë...'},
  fr:{breathe:'respire',breatheIn:'inspire',hold:'retiens',release:'expire',releaseSlow:'expire lentement',rest:'repose',tapToBegin:'touche pour commencer',heart:'Ouverture du C≈ìur',awakening:'√âveil',grounding:'Ancrage',unity:'Unit√©',peace:'Paix Profonde',journey:'Voyage',breathwork:'Respiration',duration:'Dur√©e',language:'Langue',ifServes:'si cela vous aide',breathsWith:'respirations',returnWhen:'revenez',voiceOn:'voix on',voiceOff:'voix off',linkCopied:'copi√© ‚úì',shareThePeace:'partagez la paix',installing:'installation...',addToHome:'Ajouter √† l\'√©cran',headphones:'√©couteurs recommand√©s',close:'fermer',gotIt:'compris',balance:'√âquilibre',calm:'Calme',energy:'√ânergie',deep:'Profond',min5:'5 min',min10:'10 min',min20:'20 min',lifetimeBreaths:'respirations totales',welcomeBack:'bon retour',dayStreak:'jours cons√©cutifs',updateAvailable:'mise √† jour disponible',update:'Mettre √† jour',updating:'mise √† jour...'}
};

const BREATHWORK={balance:{pattern:[4,4,4,4],getWords:L=>[L.breatheIn,L.hold,L.release,L.rest]},calm:{pattern:[4,7,8,0],getWords:L=>[L.breatheIn,L.hold,L.releaseSlow,'']},energy:{pattern:[4,0,4,0],getWords:L=>[L.breatheIn,'',L.release,'']},deep:{pattern:[4,0,8,0],getWords:L=>[L.breatheIn,'',L.releaseSlow,'']}};
const CRYPTO={btc:'bc1qwjsvjg0ckfw2aa9c5zdhc4ewxn7yse8lvstuaz',eth:'0x12e10C6aA1557A9B13c570c0070E223aec8dE498'};
const JOURNEYS={heart:{base:6,shifts:[2,1,-1,-2],freqs:[528,432,396,417],volumes:[.06,.05,.04,.025]},awakening:{base:40,shifts:[3,1,-1,-3],freqs:[741,852,963,639],volumes:[.06,.05,.04,.025]},grounding:{base:2,shifts:[1,.5,-.5,-1],freqs:[285,432,174,128],volumes:[.06,.05,.04,.025]},unity:{base:10,shifts:[2,1,-1,-2],freqs:[528,639,111,432],volumes:[.06,.05,.04,.025]},peace:{base:4,shifts:[1.5,.5,-.5,-1.5],freqs:[432,396,417,528],volumes:[.05,.04,.03,.02]}};
const WISDOMS=["you are worthy of love. you always have been.","your heart knows the way. trust it.","love is not earned. it is remembered.","consciousness is not found. it is unveiled.","the truth you seek is seeking you.","you have always been the light you're looking for.","stillness speaks louder than thought.","you are held by the earth. always.","your body is your first home. return to it.","presence is the anchor. breath is the chain.","you belong here. you have always belonged.","separation is the illusion. oneness is the truth.","there is no other. there is only one.","peace begins when we remember we are one.","every breath connects you to all beings.","peace is not found. it is remembered.","stillness is your nature. return to it.","in the quiet, God speaks.","surrender is not giving up. it is opening up.","the deepest peace is already within you."];

const S={on:false,phase:0,breaths:0,sound:false,voice:false,journey:'heart',breathwork:'balance',duration:600,elapsed:0,timer:null,tickTimer:null,audio:null,osc:null,oscL:null,oscR:null,subOsc:null,gain:null,gainL:null,gainR:null,subGain:null,hasStarted:false,headphonesShown:false,deferredPrompt:null,lang:'en',lifetimeBreaths:0,streak:0,lastVisit:null,introPlayed:false,swRegistration:null,updateAvailable:false,haptics:true};

try{const saved=localStorage.getItem('innerafield');if(saved){const p=JSON.parse(saved);S.journey=p.journey||'heart';S.breathwork=p.breathwork||'balance';S.duration=p.duration??600;S.sound=p.sound||false;S.voice=p.voice||false;S.lang=p.lang||'en';S.lifetimeBreaths=p.lifetimeBreaths||0;S.streak=p.streak||0;S.lastVisit=p.lastVisit||null;S.haptics=p.haptics!==false;}}catch(e){}

function updateStreak(){const today=new Date().toDateString();if(S.lastVisit){const last=new Date(S.lastVisit);const lastDate=last.toDateString();const yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);if(lastDate!==today){S.streak=lastDate===yesterday.toDateString()?S.streak+1:1;}}else{S.streak=1;}S.lastVisit=today;savePrefs();}

const $=id=>document.getElementById(id);
const circle=$('circle'),word=$('word'),hint=$('hint'),phaseEl=$('phase'),timerDisplay=$('timerDisplay'),wisdom=$('wisdom'),sessionMsg=$('sessionMsg'),sr=$('sr'),menu=$('menu'),overlay=$('overlay'),toast=$('toast'),donateModal=$('donateModal'),iosModal=$('iosModal'),langModal=$('langModal'),installBtn=$('installBtn'),installBtnTop=$('installBtnTop'),streakEl=$('streak'),streakCount=$('streakCount'),updateBanner=$('updateBanner'),updateBtn=$('updateBtn'),versionDisplay=$('versionDisplay');
const phases=['inhale','hold-in','exhale','hold-out'];

function t(key){return LANG[S.lang]?.[key]||LANG.en[key]||key;}
function getPattern(){return BREATHWORK[S.breathwork].pattern;}
function getWords(){return BREATHWORK[S.breathwork].getWords(LANG[S.lang]||LANG.en);}
function findNextActivePhase(from){const pattern=getPattern();let next=(from+1)%4;for(let i=0;i<4;i++){if(pattern[next]>0)return next;next=(next+1)%4;}return 0;}

/* Haptic feedback */
function haptic(pattern){
  if(!S.haptics||!('vibrate'in navigator))return;
  try{navigator.vibrate(pattern);}catch(e){}
}

function updateUI(){
  const L=LANG[S.lang]||LANG.en;
  if(!S.on){word.textContent=L.breathe;hint.textContent=L.tapToBegin;}
  $('energyText').textContent=L.ifServes;
  $('journeyLabel').textContent=L.journey;
  $('breathworkLabel').textContent=L.breathwork;
  $('durationLabel').textContent=L.duration;
  $('langTitle').textContent=L.language;
  $('donateClose').textContent=L.close;
  $('iosTitle').textContent=L.addToHome;
  $('iosClose').textContent=L.gotIt;
  $('langClose').textContent=L.close;
  document.querySelectorAll('[data-i18n]').forEach(el=>{const key=el.dataset.i18n;if(L[key])el.textContent=L[key];});
  document.querySelectorAll('[data-lang]').forEach(el=>el.classList.toggle('selected',el.dataset.lang===S.lang));
  if(S.streak>1){streakCount.textContent=S.streak;streakEl.classList.add('show');}
  versionDisplay.textContent='v'+VERSION;
  // Update button title
  updateBtn.title=L.updateAvailable;
}

function savePrefs(){try{localStorage.setItem('innerafield',JSON.stringify({journey:S.journey,breathwork:S.breathwork,duration:S.duration,sound:S.sound,voice:S.voice,lang:S.lang,lifetimeBreaths:S.lifetimeBreaths,streak:S.streak,lastVisit:S.lastVisit,haptics:S.haptics}));}catch(e){}}

/* Audio */
function initAudio(){if(S.audio)return;S.audio=new(window.AudioContext||window.webkitAudioContext)();S.gain=S.audio.createGain();S.gain.gain.value=0;S.gain.connect(S.audio.destination);S.gainL=S.audio.createGain();S.gainR=S.audio.createGain();S.gainL.gain.value=0;S.gainR.gain.value=0;const merger=S.audio.createChannelMerger(2);S.gainL.connect(merger,0,0);S.gainR.connect(merger,0,1);merger.connect(S.audio.destination);S.subGain=S.audio.createGain();S.subGain.gain.value=0;S.subGain.connect(S.audio.destination);}

function playWelcomeTone(){
  if(S.introPlayed)return;S.introPlayed=true;
  try{
    const ctx=new(window.AudioContext||window.webkitAudioContext)();
    const now=ctx.currentTime;
    const osc1=ctx.createOscillator();osc1.type='sine';osc1.frequency.value=528;
    const osc2=ctx.createOscillator();osc2.type='sine';osc2.frequency.value=396;
    const osc3=ctx.createOscillator();osc3.type='triangle';osc3.frequency.value=1056;
    const g1=ctx.createGain(),g2=ctx.createGain(),g3=ctx.createGain();
    g1.gain.setValueAtTime(0,now);g1.gain.linearRampToValueAtTime(.07,now+.6);g1.gain.linearRampToValueAtTime(.05,now+2);g1.gain.linearRampToValueAtTime(0,now+3.5);
    g2.gain.setValueAtTime(0,now);g2.gain.linearRampToValueAtTime(.035,now+.9);g2.gain.linearRampToValueAtTime(.025,now+2);g2.gain.linearRampToValueAtTime(0,now+3.5);
    g3.gain.setValueAtTime(0,now);g3.gain.linearRampToValueAtTime(.015,now+.3);g3.gain.linearRampToValueAtTime(0,now+1.5);
    osc1.connect(g1);g1.connect(ctx.destination);osc2.connect(g2);g2.connect(ctx.destination);osc3.connect(g3);g3.connect(ctx.destination);
    osc1.start(now);osc2.start(now+.3);osc3.start(now);osc1.stop(now+4);osc2.stop(now+4);osc3.stop(now+2);
    setTimeout(()=>ctx.close(),5000);
  }catch(e){}
}

function fadeOutSolfeggio(){if(S.audio&&S.gain)S.gain.gain.setTargetAtTime(0,S.audio.currentTime,.1);}
function playFreq(hz,vol){if(!S.audio)return;if(S.osc)S.osc.frequency.setTargetAtTime(hz,S.audio.currentTime,.3);else{S.osc=S.audio.createOscillator();S.osc.type='sine';S.osc.frequency.value=hz;S.osc.connect(S.gain);S.osc.start();}S.gain.gain.setTargetAtTime(vol,S.audio.currentTime,.3);}
function playBinaural(beatHz){if(!S.audio)return;const base=200;if(!S.oscL){S.oscL=S.audio.createOscillator();S.oscL.type='sine';S.oscL.connect(S.gainL);S.oscL.start();}S.oscL.frequency.setTargetAtTime(base,S.audio.currentTime,.2);if(!S.oscR){S.oscR=S.audio.createOscillator();S.oscR.type='sine';S.oscR.connect(S.gainR);S.oscR.start();}S.oscR.frequency.setTargetAtTime(base+beatHz,S.audio.currentTime,.2);S.gainL.gain.setTargetAtTime(.04,S.audio.currentTime,.3);S.gainR.gain.setTargetAtTime(.04,S.audio.currentTime,.3);}
function playSubBass(){if(!S.audio)return;if(!S.subOsc){S.subOsc=S.audio.createOscillator();S.subOsc.type='sine';S.subOsc.frequency.value=50;S.subOsc.connect(S.subGain);S.subOsc.start();}S.subGain.gain.setTargetAtTime(.1,S.audio.currentTime,.5);}
function stopAudio(){if(S.audio){if(S.gain)S.gain.gain.setTargetAtTime(0,S.audio.currentTime,.4);if(S.gainL)S.gainL.gain.setTargetAtTime(0,S.audio.currentTime,.4);if(S.gainR)S.gainR.gain.setTargetAtTime(0,S.audio.currentTime,.4);if(S.subGain)S.subGain.gain.setTargetAtTime(0,S.audio.currentTime,.4);}}
function speak(text){if(!S.voice||!text||!window.speechSynthesis)return;speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(text);u.rate=.75;u.pitch=.85;u.volume=.6;u.lang=S.lang;speechSynthesis.speak(u);}
function showToast(msg,icon=''){toast.innerHTML=icon?'<span class="icon">'+icon+'</span>'+msg:msg;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),3000);}

/* Breathing */
function setPhase(i){
  const pattern=getPattern(),words=getWords(),journey=JOURNEYS[S.journey],dur=pattern[i];
  S.phase=i;
  circle.style.transitionDuration=(dur*.9)+'s';
  circle.className='circle breathing '+phases[i];
  const w=words[i];
  word.textContent=w||'';
  phaseEl.textContent=w?phases[i].replace('-in',' in').replace('-out',' out'):'';
  sr.textContent=w||'';
  if(w)speak(w);
  
  // Haptic feedback on each phase
  if(i===0)haptic(80);      // inhale - medium pulse
  else if(i===1)haptic(40); // hold - soft pulse
  else if(i===2)haptic(60); // exhale - gentle pulse
  else if(i===3)haptic(30); // rest - softest pulse
  
  if(S.sound&&S.audio){
    fadeOutSolfeggio();
    setTimeout(()=>{if(!S.on)return;playFreq(journey.freqs[i],journey.volumes[i]);playBinaural(journey.base+journey.shifts[i]);},150);
  }
  if(i===2){S.breaths++;S.lifetimeBreaths++;}
}

function scheduleNext(){if(!S.on)return;S.timer=setTimeout(()=>{if(!S.on)return;setPhase(findNextActivePhase(S.phase));scheduleNext();},getPattern()[S.phase]*1000);}
function updateTimer(){if(!S.on)return;S.elapsed++;if(S.duration>0){const rem=S.duration-S.elapsed;if(rem<=0){stop();return;}timerDisplay.textContent=Math.floor(rem/60)+':'+(rem%60<10?'0':'')+(rem%60);}else timerDisplay.textContent=t('breathe')+' '+S.breaths;S.tickTimer=setTimeout(updateTimer,1000);}

function start(){
  if(S.on)return;
  S.on=true;S.breaths=0;S.elapsed=0;S.hasStarted=true;
  document.body.classList.add('active');
  sessionMsg.classList.remove('show');sessionMsg.innerHTML='';
  hint.style.display='none';
  wisdom.textContent=WISDOMS[Math.floor(Math.random()*WISDOMS.length)];
  circle.classList.remove('idle');circle.classList.add('starting');
  haptic(100); // Start feedback
  if(S.sound){initAudio();if(S.audio.state==='suspended')S.audio.resume();playSubBass();}
  setTimeout(()=>{
    circle.classList.remove('starting');
    const pattern=getPattern();
    let first=0;for(let i=0;i<4;i++)if(pattern[i]>0){first=i;break;}
    setPhase(first);scheduleNext();updateTimer();
  },400);
  sr.textContent='Breathing started.';
}

function stop(){
  if(!S.on)return;
  S.on=false;
  document.body.classList.remove('active');
  clearTimeout(S.timer);clearTimeout(S.tickTimer);
  S.timer=S.tickTimer=null;
  circle.style.transitionDuration='';
  circle.className='circle idle';
  word.textContent=t('breathe');
  phaseEl.textContent='';timerDisplay.textContent='';
  stopAudio();savePrefs();
  haptic([50,50,50]); // End feedback
  sessionMsg.innerHTML='<span class="count">‚úß '+S.breaths+' '+t('breathsWith')+' ‚úß</span><br>'+t('returnWhen')+'<span class="lifetime">'+S.lifetimeBreaths.toLocaleString()+' '+t('lifetimeBreaths')+'</span>';
  sessionMsg.classList.add('show');
  setTimeout(()=>{sessionMsg.classList.remove('show');wisdom.textContent='';},8000);
  sr.textContent=S.breaths+' breaths complete.';
}

function toggle(){S.on?stop():start();}
function openMenu(){menu.classList.add('open');overlay.classList.add('show');}
function closeMenu(){menu.classList.remove('open');overlay.classList.remove('show');}
function closeAllModals(){donateModal.classList.remove('show');iosModal.classList.remove('show');langModal.classList.remove('show');}

function initMenuState(){document.querySelectorAll('[data-journey]').forEach(el=>el.classList.toggle('selected',el.dataset.journey===S.journey));document.querySelectorAll('[data-breath]').forEach(el=>el.classList.toggle('selected',el.dataset.breath===S.breathwork));document.querySelectorAll('[data-time]').forEach(el=>el.classList.toggle('selected',parseInt(el.dataset.time)===S.duration));document.querySelectorAll('[data-lang]').forEach(el=>el.classList.toggle('selected',el.dataset.lang===S.lang));$('soundBtn').classList.toggle('on',S.sound);$('voiceBtn').classList.toggle('on',S.voice);updateUI();}

/* Event listeners */
document.querySelectorAll('[data-journey]').forEach(el=>el.addEventListener('click',()=>{document.querySelectorAll('[data-journey]').forEach(e=>e.classList.remove('selected'));el.classList.add('selected');S.journey=el.dataset.journey;savePrefs();haptic(30);}));
document.querySelectorAll('[data-breath]').forEach(el=>el.addEventListener('click',()=>{document.querySelectorAll('[data-breath]').forEach(e=>e.classList.remove('selected'));el.classList.add('selected');S.breathwork=el.dataset.breath;savePrefs();haptic(30);}));
document.querySelectorAll('[data-time]').forEach(el=>el.addEventListener('click',()=>{document.querySelectorAll('[data-time]').forEach(e=>e.classList.remove('selected'));el.classList.add('selected');S.duration=parseInt(el.dataset.time);savePrefs();haptic(30);}));
document.querySelectorAll('[data-lang]').forEach(el=>el.addEventListener('click',()=>{document.querySelectorAll('[data-lang]').forEach(e=>e.classList.remove('selected'));el.classList.add('selected');S.lang=el.dataset.lang;savePrefs();updateUI();langModal.classList.remove('show');haptic(30);}));

$('voiceBtn').addEventListener('click',()=>{S.voice=!S.voice;$('voiceBtn').classList.toggle('on',S.voice);savePrefs();showToast(S.voice?t('voiceOn'):t('voiceOff'));haptic(40);});
$('langBtn').addEventListener('click',()=>{langModal.classList.add('show');haptic(30);});
$('langClose').addEventListener('click',()=>langModal.classList.remove('show'));
$('menuBtn').addEventListener('click',()=>{openMenu();haptic(30);});
$('menuClose').addEventListener('click',closeMenu);
overlay.addEventListener('click',()=>{closeMenu();closeAllModals();});
$('soundBtn').addEventListener('click',()=>{S.sound=!S.sound;$('soundBtn').classList.toggle('on',S.sound);savePrefs();haptic(40);if(S.sound){if(!S.headphonesShown){showToast(t('headphones'),'üéß');S.headphonesShown=true;}if(S.on){initAudio();if(S.audio.state==='suspended')S.audio.resume();const j=JOURNEYS[S.journey];playFreq(j.freqs[S.phase],j.volumes[S.phase]);playBinaural(j.base+j.shifts[S.phase]);playSubBass();}}else stopAudio();});
$('contrastBtn').addEventListener('click',()=>{document.body.classList.toggle('contrast');$('contrastBtn').classList.toggle('on',document.body.classList.contains('contrast'));haptic(30);});

async function shareApp(){const d={title:'Innera Field',text:'Free breathing meditation. No account. No tracking. Just peace.',url:'https://innerafield.com'};if(navigator.share)try{await navigator.share(d);}catch(e){if(e.name!=='AbortError')copyLink();}else copyLink();}
function copyLink(){navigator.clipboard.writeText('https://innerafield.com').then(()=>showToast(t('linkCopied')+'<br>'+t('shareThePeace'))).catch(()=>showToast('innerafield.com'));}
$('shareBtn').addEventListener('click',shareApp);
$('menuShareBtn').addEventListener('click',shareApp);

function showDonateModal(type){const addr=type==='btc'?CRYPTO.btc:CRYPTO.eth;$('donateTitle').textContent=type==='btc'?'BITCOIN':'ETHEREUM';$('donateAddress').textContent=addr;$('donateQR').src='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data='+encodeURIComponent(addr);donateModal.classList.add('show');}
$('btcBtn').addEventListener('click',()=>showDonateModal('btc'));
$('ethBtn').addEventListener('click',()=>showDonateModal('eth'));
$('donateClose').addEventListener('click',()=>donateModal.classList.remove('show'));
$('donateAddress').addEventListener('click',function(){navigator.clipboard.writeText(this.textContent).then(()=>showToast('address copied ‚úì'));});
$('iosClose').addEventListener('click',()=>iosModal.classList.remove('show'));

function isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||(navigator.platform==='MacIntel'&&navigator.maxTouchPoints>1);}
function isStandalone(){return window.matchMedia('(display-mode:standalone)').matches||window.navigator.standalone===true;}
async function handleInstall(){if(S.deferredPrompt){S.deferredPrompt.prompt();const r=await S.deferredPrompt.userChoice;S.deferredPrompt=null;if(r.outcome==='accepted'){showToast(t('installing'),'‚úì');installBtn.classList.add('hidden');installBtnTop.classList.add('hidden');}}else if(isIOS())iosModal.classList.add('show');else showToast(t('addToHome'));}
window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();S.deferredPrompt=e;installBtn.classList.remove('hidden');installBtnTop.classList.remove('hidden');});
installBtn.addEventListener('click',handleInstall);
installBtnTop.addEventListener('click',handleInstall);
if(isStandalone()){installBtn.classList.add('hidden');installBtnTop.classList.add('hidden');}
if(isIOS()&&!isStandalone()){installBtn.classList.remove('hidden');installBtnTop.classList.remove('hidden');}

circle.addEventListener('click',toggle);
circle.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();toggle();}});
document.addEventListener('keydown',e=>{if(e.key===' '&&document.activeElement===document.body){e.preventDefault();toggle();}if(e.key==='Escape'){if(donateModal.classList.contains('show'))donateModal.classList.remove('show');else if(iosModal.classList.contains('show'))iosModal.classList.remove('show');else if(langModal.classList.contains('show'))langModal.classList.remove('show');else if(menu.classList.contains('open'))closeMenu();else if(S.on)stop();}});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SERVICE WORKER & UPDATE SYSTEM
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showUpdateAvailable(){
  S.updateAvailable=true;
  updateBtn.classList.add('show');
  // Also show banner after a short delay
  setTimeout(()=>{
    if(S.updateAvailable)updateBanner.classList.add('show');
  },3000);
}

function doUpdate(){
  showToast(t('updating'),'‚Üë');
  haptic([50,100,50]);
  if(S.swRegistration&&S.swRegistration.waiting){
    S.swRegistration.waiting.postMessage('SKIP_WAITING');
  }
  setTimeout(()=>window.location.reload(),500);
}

updateBtn.addEventListener('click',doUpdate);
$('bannerUpdateBtn').addEventListener('click',doUpdate);

if('serviceWorker'in navigator){
  navigator.serviceWorker.register('sw.js').then(reg=>{
    S.swRegistration=reg;
    
    // Check if there's already a waiting worker
    if(reg.waiting){
      showUpdateAvailable();
    }
    
    // Listen for new service worker installing
    reg.addEventListener('updatefound',()=>{
      const newWorker=reg.installing;
      newWorker.addEventListener('statechange',()=>{
        if(newWorker.state==='installed'&&navigator.serviceWorker.controller){
          showUpdateAvailable();
        }
      });
    });
    
    // Periodic check for updates (every 30 minutes)
    setInterval(()=>reg.update(),30*60*1000);
    
  }).catch(()=>{});
  
  // Reload when new service worker takes over
  let refreshing=false;
  navigator.serviceWorker.addEventListener('controllerchange',()=>{
    if(refreshing)return;
    refreshing=true;
    window.location.reload();
  });
}

/* Initialize */
updateStreak();
initMenuState();
setTimeout(()=>{if(!S.hasStarted&&hint)hint.style.opacity='0';},8000);
if(window.matchMedia('(prefers-contrast:more)').matches){document.body.classList.add('contrast');$('contrastBtn').classList.add('on');}

document.addEventListener('click',function welcome(){playWelcomeTone();document.removeEventListener('click',welcome);},{once:true});
setTimeout(()=>{if(!S.introPlayed)try{playWelcomeTone();}catch(e){}},1500);

})();
</script>
</body>
</html>
