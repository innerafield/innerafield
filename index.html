<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="description" content="Free breathing meditation. No account. No tracking. Just peace. For all beings.">
<meta name="theme-color" content="#000000">
<meta name="google" content="notranslate">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Innera Field">

<!-- Favicons -->
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="48x48" href="icons/favicon-48.png">
<link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16.png">
<link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
<link rel="manifest" href="manifest.json">

<!-- Open Graph -->
<meta property="og:title" content="Innera Field">
<meta property="og:description" content="Free breathing meditation. No account. No tracking. Just peace.">
<meta property="og:image" content="https://innerafield.com/icons/icon-512.png">
<meta property="og:url" content="https://innerafield.com">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Innera Field">
<meta name="twitter:description" content="Free breathing meditation. No account. No tracking. Just peace.">
<meta name="twitter:image" content="https://innerafield.com/icons/icon-512.png">

<title>Innera Field</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --void:#000;
  --light:#fff;
  --dim:rgba(255,255,255,.6);
  --faint:rgba(255,255,255,.35);
  --glass:rgba(255,255,255,.05);
  --border:rgba(255,255,255,.1);
  --pink:rgba(255,20,147,.35);
  --magenta:rgba(255,0,128,.3);
  --purple:rgba(138,43,226,.35);
  --blue:rgba(0,191,255,.35);
  --cyan:rgba(0,255,255,.25);
  --gold:rgba(255,215,0,.3);
  --accent:#ff69b4;
  --accent-dim:rgba(255,105,180,.4);
}
html{height:100%;-webkit-text-size-adjust:100%}
body{
  min-height:100%;height:100%;
  font-family:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  background:var(--void);
  color:var(--light);
  display:flex;
  align-items:center;
  justify-content:center;
  -webkit-tap-highlight-color:transparent;
  overflow:hidden;
  animation:awakening 2s ease-out;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
@keyframes awakening{0%{opacity:0}100%{opacity:1}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RAINBOW COSMOS - Living, Breathing Background
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cosmos{
  position:fixed;
  inset:0;
  z-index:0;
  background:
    radial-gradient(ellipse at 12% 15%,var(--pink),transparent 50%),
    radial-gradient(ellipse at 88% 18%,var(--magenta),transparent 45%),
    radial-gradient(ellipse at 18% 82%,var(--blue),transparent 50%),
    radial-gradient(ellipse at 82% 78%,var(--purple),transparent 55%),
    radial-gradient(ellipse at 50% 50%,var(--cyan),transparent 60%),
    radial-gradient(ellipse at 65% 25%,var(--gold),transparent 40%);
  opacity:.55;
  animation:cosmicDance 25s ease-in-out infinite;
  pointer-events:none;
  will-change:opacity,filter;
}
@keyframes cosmicDance{
  0%,100%{opacity:.5;filter:hue-rotate(0deg) saturate(1)}
  25%{opacity:.6;filter:hue-rotate(10deg) saturate(1.1)}
  50%{opacity:.55;filter:hue-rotate(0deg) saturate(1)}
  75%{opacity:.65;filter:hue-rotate(-10deg) saturate(1.15)}
}
.cosmos::before{
  content:'';
  position:absolute;
  inset:0;
  background-image:
    radial-gradient(1.5px 1.5px at 20% 30%,rgba(255,255,255,.35),transparent),
    radial-gradient(2px 2px at 40% 70%,rgba(255,255,255,.25),transparent),
    radial-gradient(1px 1px at 60% 15%,rgba(255,255,255,.4),transparent),
    radial-gradient(1.5px 1.5px at 80% 50%,rgba(255,255,255,.3),transparent),
    radial-gradient(1px 1px at 15% 65%,rgba(255,255,255,.35),transparent),
    radial-gradient(2px 2px at 75% 85%,rgba(255,255,255,.2),transparent),
    radial-gradient(1px 1px at 35% 40%,rgba(255,255,255,.3),transparent),
    radial-gradient(1.5px 1.5px at 90% 20%,rgba(255,255,255,.25),transparent),
    radial-gradient(1px 1px at 5% 90%,rgba(255,255,255,.3),transparent),
    radial-gradient(1.5px 1.5px at 55% 95%,rgba(255,255,255,.2),transparent);
  animation:starFloat 40s linear infinite;
}
@keyframes starFloat{0%{transform:translateY(0)}100%{transform:translateY(-15px)}}

.field{
  position:relative;
  z-index:1;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:1.5rem;
  text-align:center;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GOLD TITLE - Shimmering like Sunlight
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.title{
  position:absolute;
  top:max(10vh,55px);
  font-size:clamp(1.4rem,5vw,2.8rem);
  font-weight:700;
  letter-spacing:.45em;
  padding-left:.45em;
  background:linear-gradient(135deg,#d4af37 0%,#ffd700 25%,#f5deb3 50%,#ffd700 75%,#d4af37 100%);
  background-size:400% 400%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  animation:titleShimmer 8s ease-in-out infinite;
  user-select:none;
  white-space:nowrap;
  filter:drop-shadow(0 0 30px rgba(255,215,0,.2));
}
@keyframes titleShimmer{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}

/* Streak display */
.streak{
  position:absolute;
  top:max(2.5vh,14px);
  left:50%;
  transform:translateX(-50%);
  font-size:.8rem;
  font-weight:500;
  letter-spacing:.08em;
  color:var(--faint);
  opacity:0;
  transition:opacity .6s ease;
  display:flex;
  align-items:center;
  gap:.35rem;
}
.streak.show{opacity:1}
.streak .flame{font-size:1rem;filter:drop-shadow(0 0 4px rgba(255,100,0,.5))}

/* Controls */
.controls-left{position:absolute;top:max(2vh,12px);left:max(2.5vw,12px);display:flex;gap:.4rem;z-index:100}
.controls-right{position:absolute;top:max(2vh,12px);right:max(2.5vw,12px);display:flex;gap:.4rem;z-index:100}
.ctrl{
  background:transparent;
  border:none;
  color:var(--dim);
  width:44px;height:44px;
  cursor:pointer;
  transition:all .3s cubic-bezier(.4,0,.2,1);
  opacity:.5;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  font-size:1.3rem;
}
.ctrl:hover,.ctrl:focus{opacity:1;color:var(--light);background:rgba(255,255,255,.06)}
.ctrl:active{transform:scale(.95)}
.ctrl.on{opacity:1;color:var(--accent)}
.ctrl.hidden{display:none}
.ctrl.update{color:#4ade80;animation:gentlePulse 2s ease-in-out infinite}
@keyframes gentlePulse{0%,100%{opacity:.7}50%{opacity:1}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BREATHING CIRCLE - The Heart of Everything
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.circle{
  position:relative;
  width:min(240px,48vw);
  height:min(240px,48vw);
  border-radius:50%;
  background:radial-gradient(circle at 50% 50%,rgba(255,105,180,.04),transparent 70%);
  border:2px solid rgba(255,255,255,.1);
  box-shadow:
    0 0 50px rgba(255,20,147,.2),
    0 0 100px rgba(138,43,226,.12),
    inset 0 0 50px rgba(255,255,255,.02);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  cursor:pointer;
  transform:scale(1) translateZ(0);
  will-change:transform,box-shadow,border-color;
  transition:transform .4s cubic-bezier(.4,0,.2,1),box-shadow .4s ease,border-color .4s ease;
  -webkit-backface-visibility:hidden;
  backface-visibility:hidden;
}
.circle.idle{animation:heartbeat 5s ease-in-out infinite}
@keyframes heartbeat{
  0%,100%{transform:scale(1);box-shadow:0 0 50px rgba(255,20,147,.2),0 0 100px rgba(138,43,226,.12)}
  50%{transform:scale(1.015);box-shadow:0 0 65px rgba(255,20,147,.28),0 0 120px rgba(138,43,226,.15)}
}
.circle.starting{transform:scale(1.06) translateZ(0)}
.circle.breathing{transition-timing-function:cubic-bezier(.4,0,.2,1)}
.circle.breathing.inhale{
  transform:scale(1.32) translateZ(0);
  border-color:rgba(255,215,0,.45);
  box-shadow:0 0 80px rgba(255,215,0,.35),0 0 130px rgba(255,105,180,.2);
}
.circle.breathing.hold-in{
  transform:scale(1.32) translateZ(0);
  border-color:rgba(255,180,100,.4);
  box-shadow:0 0 70px rgba(255,180,100,.3),0 0 120px rgba(255,140,100,.15);
}
.circle.breathing.exhale{
  transform:scale(.7) translateZ(0);
  border-color:rgba(0,191,255,.45);
  box-shadow:0 0 60px rgba(0,191,255,.35),0 0 110px rgba(138,43,226,.2);
}
.circle.breathing.hold-out{
  transform:scale(.7) translateZ(0);
  border-color:rgba(138,43,226,.45);
  box-shadow:0 0 55px rgba(138,43,226,.35),0 0 100px rgba(75,0,130,.25);
}
.circle:hover:not(.breathing){border-color:rgba(255,255,255,.18)}
.circle:focus{outline:none}
.circle:focus-visible{outline:2px solid rgba(255,255,255,.3);outline-offset:12px}

.word{
  font-size:clamp(1rem,3vw,1.35rem);
  font-weight:400;
  letter-spacing:.25em;
  padding-left:.25em;
  text-transform:uppercase;
  opacity:.88;
  transition:opacity .8s ease,transform .8s ease;
  user-select:none;
}
.hint{
  font-size:clamp(.75rem,2vw,.92rem);
  font-weight:300;
  letter-spacing:.12em;
  margin-top:.6rem;
  opacity:.4;
  transition:opacity .8s ease;
  color:var(--dim);
}
.breathing .hint{opacity:0;pointer-events:none}
.phase{
  font-size:clamp(.7rem,1.8vw,.88rem);
  font-weight:300;
  letter-spacing:.14em;
  margin-top:.45rem;
  opacity:0;
  transition:opacity .8s ease;
  color:var(--dim);
}
.breathing .phase{opacity:1}
.timer{
  font-size:clamp(.6rem,1.5vw,.75rem);
  font-weight:400;
  letter-spacing:.08em;
  margin-top:.35rem;
  opacity:0;
  color:var(--faint);
  transition:opacity .8s ease;
}
.breathing .timer{opacity:1}

/* Wisdom area */
.wisdom-area{
  position:absolute;
  bottom:max(10vh,65px);
  text-align:center;
  max-width:min(88%,400px);
  padding:0 1rem;
}
.wisdom{
  font-size:clamp(.82rem,2.2vw,1rem);
  font-weight:300;
  letter-spacing:.04em;
  line-height:1.75;
  opacity:0;
  transition:opacity 2.5s ease;
  font-style:italic;
  color:rgba(255,255,255,.5);
}
.active .wisdom{opacity:1}
.session-msg{
  margin-top:.9rem;
  font-size:clamp(.78rem,1.9vw,.9rem);
  font-weight:400;
  letter-spacing:.1em;
  opacity:0;
  color:var(--dim);
  transition:opacity 1.8s ease;
  line-height:1.75;
}
.session-msg.show{opacity:1}
.session-msg .count{color:var(--accent);font-weight:500}
.session-msg .lifetime{font-size:.82em;opacity:.65;margin-top:.4rem;display:block}

/* Energy/Donate section */
.energy{
  position:absolute;
  bottom:max(2.5vh,12px);
  font-size:clamp(.72rem,1.7vw,.85rem);
  font-weight:300;
  letter-spacing:.08em;
  opacity:.28;
  transition:opacity .4s ease;
  color:var(--dim);
  display:flex;
  align-items:center;
  gap:.4rem;
}
.energy:hover{opacity:.55}
.energy-btn{
  background:none;
  border:none;
  color:inherit;
  font-size:1.05rem;
  cursor:pointer;
  padding:.35rem;
  opacity:.7;
  transition:all .3s cubic-bezier(.4,0,.2,1);
  min-width:38px;min-height:38px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-decoration:none;
  border-radius:50%;
}
.energy-btn:hover{opacity:1;color:var(--light);transform:scale(1.08);background:rgba(255,255,255,.05)}

/* Toast */
.toast{
  position:fixed;
  bottom:16%;
  left:50%;
  transform:translateX(-50%) translateY(15px);
  background:rgba(5,5,5,.95);
  border:1px solid var(--border);
  padding:.9rem 1.6rem;
  border-radius:14px;
  font-size:.85rem;
  font-weight:400;
  letter-spacing:.06em;
  opacity:0;
  pointer-events:none;
  transition:all .4s cubic-bezier(.4,0,.2,1);
  z-index:300;
  text-align:center;
  max-width:88%;
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast .icon{font-size:1.2rem;margin-bottom:.4rem;display:block}

/* Update banner */
.update-banner{
  position:fixed;
  top:0;
  left:0;
  right:0;
  background:linear-gradient(135deg,rgba(74,222,128,.15),rgba(34,197,94,.1));
  border-bottom:1px solid rgba(74,222,128,.3);
  padding:.7rem 1rem;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:.8rem;
  z-index:400;
  transform:translateY(-100%);
  transition:transform .4s cubic-bezier(.4,0,.2,1);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
}
.update-banner.show{transform:translateY(0)}
.update-banner span{font-size:.82rem;letter-spacing:.05em;color:rgba(255,255,255,.8)}
.update-banner button{
  background:rgba(74,222,128,.2);
  border:1px solid rgba(74,222,128,.4);
  color:#4ade80;
  padding:.4rem 1rem;
  font-size:.78rem;
  font-weight:500;
  letter-spacing:.08em;
  cursor:pointer;
  border-radius:8px;
  transition:all .3s;
}
.update-banner button:hover{background:rgba(74,222,128,.3);color:#fff}

/* Modals */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.92);
  z-index:250;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:opacity .35s ease;
  backdrop-filter:blur(5px);
  -webkit-backdrop-filter:blur(5px);
}
.modal.show{opacity:1;pointer-events:auto}
.modal-content{
  background:rgba(8,8,8,.98);
  border:1px solid var(--border);
  border-radius:18px;
  padding:1.8rem;
  text-align:center;
  max-width:min(90%,320px);
  max-height:80vh;
  overflow-y:auto;
  transform:scale(.96);
  transition:transform .35s cubic-bezier(.4,0,.2,1);
}
.modal.show .modal-content{transform:scale(1)}
.modal-content h3{font-size:.95rem;font-weight:500;letter-spacing:.12em;margin-bottom:1.1rem;color:var(--dim)}
.modal-close{
  background:none;
  border:1px solid var(--border);
  color:var(--dim);
  padding:.7rem 1.6rem;
  font-size:.8rem;
  font-weight:400;
  letter-spacing:.1em;
  cursor:pointer;
  border-radius:10px;
  transition:all .3s;
  margin-top:.9rem;
}
.modal-close:hover{border-color:rgba(255,255,255,.25);color:var(--light)}
.donate-qr{width:150px;height:150px;margin:0 auto 1rem;background:#fff;border-radius:12px;padding:8px}
.donate-qr img{width:100%;height:100%;border-radius:4px}
.donate-address{
  font-size:.65rem;
  font-family:'SF Mono',Monaco,monospace;
  letter-spacing:.02em;
  color:var(--faint);
  word-break:break-all;
  margin-bottom:1rem;
  padding:.9rem;
  background:var(--glass);
  border-radius:10px;
  cursor:pointer;
  transition:all .3s;
}
.donate-address:hover{background:rgba(255,255,255,.08);color:var(--light)}
.ios-steps{text-align:left;font-size:.85rem;line-height:2;color:var(--dim);margin-bottom:.9rem}
.ios-steps span{font-size:1rem;margin-right:.4rem}
.lang-grid{display:grid;grid-template-columns:1fr 1fr;gap:.4rem;margin-bottom:.9rem}
.lang-btn{
  padding:.7rem .4rem;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:10px;
  color:var(--dim);
  font-size:.8rem;
  font-weight:400;
  cursor:pointer;
  transition:all .25s;
}
.lang-btn:hover{background:rgba(255,255,255,.08);color:var(--light)}
.lang-btn.selected{border-color:var(--accent-dim);background:rgba(255,105,180,.08);color:var(--light)}

/* Menu */
.menu{
  position:fixed;
  top:0;
  right:-320px;
  width:min(280px,85vw);
  height:100%;
  background:rgba(5,5,5,.98);
  border-left:1px solid var(--border);
  z-index:200;
  transition:right .35s cubic-bezier(.4,0,.2,1);
  overflow-y:auto;
  overflow-x:hidden;
  padding:1.4rem;
  display:flex;
  flex-direction:column;
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
}
.menu.open{right:0}
.menu-close{
  position:absolute;
  top:.9rem;right:.9rem;
  background:none;
  border:none;
  color:var(--dim);
  font-size:1.6rem;
  cursor:pointer;
  transition:all .3s;
  width:40px;height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
}
.menu-close:hover{color:var(--light);background:rgba(255,255,255,.05)}
.menu h3{
  font-size:.65rem;
  font-weight:500;
  letter-spacing:.18em;
  color:var(--faint);
  margin:1.1rem 0 .5rem;
  text-transform:uppercase;
}
.menu h3:first-of-type{margin-top:.6rem}
.menu-item{
  display:flex;
  align-items:center;
  padding:.6rem .8rem;
  margin:.12rem 0;
  background:transparent;
  border:1px solid transparent;
  border-radius:10px;
  cursor:pointer;
  transition:all .25s;
  font-size:.85rem;
  font-weight:400;
  color:var(--dim);
}
.menu-item:hover{background:var(--glass);color:var(--light)}
.menu-item.selected{border-color:var(--accent-dim);background:rgba(255,105,180,.06);color:var(--light)}
.menu-item .journey-icon{
  width:20px;height:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-right:.55rem;
  font-size:.9rem;
  opacity:.65;
  flex-shrink:0;
}
.menu-item.selected .journey-icon{opacity:1;color:var(--accent)}
.menu-divider{height:1px;background:var(--border);margin:.7rem 0}
.breath-row,.time-row{display:flex;gap:.3rem}
.breath-btn,.time-btn{
  flex:1;
  padding:.55rem .15rem;
  background:transparent;
  border:1px solid transparent;
  border-radius:8px;
  color:var(--dim);
  font-size:.7rem;
  font-weight:400;
  cursor:pointer;
  transition:all .25s;
}
.breath-btn:hover,.time-btn:hover{background:var(--glass);color:var(--light)}
.breath-btn.selected,.time-btn.selected{border-color:var(--accent-dim);background:rgba(255,105,180,.06);color:var(--light)}
.menu-icons{
  margin-top:auto;
  padding-top:.7rem;
  border-top:1px solid var(--border);
  display:flex;
  justify-content:center;
  gap:.25rem;
}
.menu-icon-btn{
  width:40px;height:40px;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:10px;
  color:var(--dim);
  font-size:1rem;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all .3s;
}
.menu-icon-btn:hover{background:rgba(255,255,255,.08);color:var(--light);border-color:rgba(255,255,255,.15)}
.menu-icon-btn.on{background:rgba(255,105,180,.12);border-color:var(--accent-dim);color:var(--accent)}
.menu-icon-btn.hidden{display:none}
.menu-version{
  text-align:center;
  font-size:.65rem;
  letter-spacing:.08em;
  color:var(--faint);
  opacity:.5;
  margin-top:.6rem;
}
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  z-index:150;
  opacity:0;
  pointer-events:none;
  transition:opacity .35s;
}
.overlay.show{opacity:1;pointer-events:auto}
.sr{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}

/* High contrast mode */
body.contrast .circle{border:2px solid #fff;box-shadow:0 0 40px rgba(255,255,255,.25)}
body.contrast .word,body.contrast .phase,body.contrast .wisdom,body.contrast .title{-webkit-text-fill-color:#fff;color:#fff;opacity:1}
body.contrast .cosmos{opacity:.3}

/* Reduced motion */
@media(prefers-reduced-motion:reduce){*{animation:none!important;transition-duration:.1s!important}}

/* Responsive */
@media(max-width:600px){
  .title{top:max(8vh,48px);font-size:clamp(1.25rem,4.5vw,1.7rem);letter-spacing:.35em;padding-left:.35em}
  .controls-left,.controls-right{top:10px}
  .controls-left{left:10px}
  .controls-right{right:10px;gap:.3rem}
  .ctrl{width:40px;height:40px;font-size:1.2rem}
  .circle{width:min(190px,50vw);height:min(190px,50vw)}
  .wisdom-area{bottom:max(8vh,55px)}
  .energy{gap:.3rem}
  .menu{padding:1.1rem}
  .menu-icons{gap:.2rem}
  .menu-icon-btn{width:38px;height:38px;font-size:.95rem}
  .breath-btn,.time-btn{font-size:.65rem;padding:.5rem .1rem}
}
@media(max-width:380px){
  .title{top:max(6vh,40px);font-size:1.15rem;letter-spacing:.28em;padding-left:.28em}
  .controls-left{left:8px}
  .controls-right{right:8px;gap:.25rem}
  .ctrl{width:38px;height:38px;font-size:1.1rem}
  .circle{width:min(170px,48vw);height:min(170px,48vw)}
  .menu{width:90vw;padding:1rem}
  .wisdom-area{bottom:max(7vh,48px)}
  .menu-icon-btn{width:36px;height:36px;font-size:.9rem}
}
@media(min-width:1200px){
  .title{font-size:3rem}
  .ctrl{width:48px;height:48px;font-size:1.5rem}
  .circle{width:min(280px,30vw);height:min(280px,30vw)}
}
@media(min-height:900px){
  .wisdom-area{bottom:max(12vh,90px)}
}
</style>
</head>
<body>
<div class="cosmos"></div>

<!-- Update Banner -->
<div class="update-banner" id="updateBanner">
  <span>âœ¨ New version available</span>
  <button id="updateBtn">Update</button>
</div>

<div class="field">
  <h1 class="title notranslate" translate="no">INNERA FIELD</h1>
  <div class="streak" id="streak"><span class="flame">ğŸ”¥</span><span id="streakCount">0</span></div>
  
  <div class="controls-left">
    <button class="ctrl" id="shareBtn" aria-label="Share" title="Share">â†—</button>
    <button class="ctrl hidden" id="installBtnTop" aria-label="Install" title="Install">â¬‡</button>
  </div>
  
  <div class="controls-right">
    <button class="ctrl" id="soundBtn" aria-label="Sound" aria-pressed="false" title="Sound">â™ª</button>
    <button class="ctrl" id="contrastBtn" aria-label="High contrast" aria-pressed="false" title="Contrast">â—</button>
    <button class="ctrl" id="menuBtn" aria-label="Open menu" title="Menu">â˜°</button>
  </div>
  
  <div class="circle idle" id="circle" role="button" tabindex="0" aria-label="Breathing circle. Tap to begin.">
    <span class="word" id="word">breathe</span>
    <span class="hint" id="hint">tap to begin</span>
    <span class="phase" id="phase"></span>
    <span class="timer" id="timerDisplay"></span>
  </div>
  
  <div class="wisdom-area">
    <p class="wisdom notranslate" translate="no" id="wisdom"></p>
    <p class="session-msg" id="sessionMsg"></p>
  </div>
  
  <div class="energy">
    <span id="energyText">if this serves you</span>
    <a class="energy-btn" href="https://ko-fi.com/innerafield" target="_blank" rel="noopener" title="Ko-fi">â™¡</a>
    <a class="energy-btn" href="https://www.paypal.com/ncp/payment/3MLTXSEW9L3RL" target="_blank" rel="noopener" title="PayPal">$</a>
    <button class="energy-btn" id="btcBtn" title="Bitcoin">â‚¿</button>
    <button class="energy-btn" id="ethBtn" title="Ethereum">Î</button>
  </div>
  
  <div class="sr" id="sr" role="status" aria-live="assertive"></div>
</div>

<div class="toast" id="toast"></div>

<div class="modal" id="donateModal"><div class="modal-content"><h3 id="donateTitle">BITCOIN</h3><div class="donate-qr"><img id="donateQR" src="" alt="QR Code"></div><div class="donate-address" id="donateAddress" title="Click to copy"></div><button class="modal-close" id="donateClose">close</button></div></div>

<div class="modal" id="iosModal"><div class="modal-content"><h3 id="iosTitle">Add to Home Screen</h3><div class="ios-steps"><div><span>1.</span> Tap Share <b>â™</b></div><div><span>2.</span> Tap <b>Add to Home Screen</b></div><div><span>3.</span> Tap <b>Add</b></div></div><button class="modal-close" id="iosClose">got it</button></div></div>

<div class="modal" id="langModal"><div class="modal-content"><h3 id="langTitle">Language</h3><div class="lang-grid"><button class="lang-btn selected" data-lang="en">English</button><button class="lang-btn" data-lang="es">EspaÃ±ol</button><button class="lang-btn" data-lang="zh">ä¸­æ–‡</button><button class="lang-btn" data-lang="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</button><button class="lang-btn" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button><button class="lang-btn" data-lang="pt">PortuguÃªs</button><button class="lang-btn" data-lang="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button><button class="lang-btn" data-lang="ja">æ—¥æœ¬èª</button><button class="lang-btn" data-lang="ko">í•œêµ­ì–´</button><button class="lang-btn" data-lang="fr">FranÃ§ais</button></div><button class="modal-close" id="langClose">close</button></div></div>

<div class="overlay" id="overlay"></div>

<nav class="menu" id="menu" aria-label="Settings">
  <button class="menu-close" id="menuClose" aria-label="Close menu">Ã—</button>
  <h3 id="journeyLabel">Journey</h3>
  <div class="menu-item selected" data-journey="heart"><span class="journey-icon">â™¡</span><span data-i18n="heart">Heart Opening</span></div>
  <div class="menu-item" data-journey="awakening"><span class="journey-icon">âœ§</span><span data-i18n="awakening">Awakening</span></div>
  <div class="menu-item" data-journey="grounding"><span class="journey-icon">â¬¡</span><span data-i18n="grounding">Grounding</span></div>
  <div class="menu-item" data-journey="unity"><span class="journey-icon">âˆ</span><span data-i18n="unity">Unity</span></div>
  <div class="menu-item" data-journey="peace"><span class="journey-icon">â—¯</span><span data-i18n="peace">Deep Peace</span></div>
  <div class="menu-divider"></div>
  <h3 id="breathworkLabel">Breathwork</h3>
  <div class="breath-row">
    <button class="breath-btn selected" data-breath="balance" data-i18n="balance">Balance</button>
    <button class="breath-btn" data-breath="calm" data-i18n="calm">Calm</button>
    <button class="breath-btn" data-breath="energy" data-i18n="energy">Energy</button>
    <button class="breath-btn" data-breath="deep" data-i18n="deep">Deep</button>
  </div>
  <div class="menu-divider"></div>
  <h3 id="durationLabel">Duration</h3>
  <div class="time-row">
    <button class="time-btn" data-time="300" data-i18n="min5">5 min</button>
    <button class="time-btn selected" data-time="600" data-i18n="min10">10 min</button>
    <button class="time-btn" data-time="1200" data-i18n="min20">20 min</button>
    <button class="time-btn" data-time="0">âˆ</button>
  </div>
  <div class="menu-divider"></div>
  <div class="menu-icons">
    <button class="menu-icon-btn" id="voiceBtn" title="Voice" aria-label="Voice">ğŸ”ˆ</button>
    <button class="menu-icon-btn" id="langBtn" title="Language" aria-label="Language">ğŸŒ</button>
    <button class="menu-icon-btn" id="menuShareBtn" title="Share" aria-label="Share">â†—</button>
    <button class="menu-icon-btn hidden" id="installBtn" title="Install" aria-label="Install">â¬‡</button>
  </div>
  <div class="menu-version" id="versionDisplay">v3.3</div>
</nav>

<script>
(function(){'use strict';

const VERSION='3.3.0';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRANSLATIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LANG={
  en:{breathe:'breathe',breatheIn:'breathe in',hold:'hold',release:'release',releaseSlow:'release slowly',rest:'rest',tapToBegin:'tap to begin',heart:'Heart Opening',awakening:'Awakening',grounding:'Grounding',unity:'Unity',peace:'Deep Peace',journey:'Journey',breathwork:'Breathwork',duration:'Duration',language:'Language',ifServes:'if this serves you',breathsWith:'breaths with Source',returnWhen:'return when you forget.',voiceOn:'voice on',voiceOff:'voice off',linkCopied:'link copied âœ“',shareThePeace:'share the peace',installing:'installing...',addToHome:'Add to Home Screen',headphones:'headphones enhance the experience',close:'close',gotIt:'got it',balance:'Balance',calm:'Calm',energy:'Energy',deep:'Deep',min5:'5 min',min10:'10 min',min20:'20 min',lifetimeBreaths:'lifetime breaths',welcomeBack:'welcome back',dayStreak:'day streak',updateAvailable:'Update available',update:'Update'},
  es:{breathe:'respira',breatheIn:'inhala',hold:'sostÃ©n',release:'exhala',releaseSlow:'exhala lento',rest:'descansa',tapToBegin:'toca para comenzar',heart:'Apertura del CorazÃ³n',awakening:'Despertar',grounding:'Arraigo',unity:'Unidad',peace:'Paz Profunda',journey:'Viaje',breathwork:'RespiraciÃ³n',duration:'DuraciÃ³n',language:'Idioma',ifServes:'si te sirve',breathsWith:'respiraciones con la Fuente',returnWhen:'regresa cuando olvides.',voiceOn:'voz activada',voiceOff:'voz desactivada',linkCopied:'enlace copiado âœ“',shareThePeace:'comparte la paz',installing:'instalando...',addToHome:'AÃ±adir a Inicio',headphones:'auriculares mejoran la experiencia',close:'cerrar',gotIt:'entendido',balance:'Equilibrio',calm:'Calma',energy:'EnergÃ­a',deep:'Profundo',min5:'5 min',min10:'10 min',min20:'20 min',lifetimeBreaths:'respiraciones totales',welcomeBack:'bienvenido',dayStreak:'dÃ­as seguidos',updateAvailable:'ActualizaciÃ³n disponible',update:'Actualizar'},
  zh:{breathe:'å‘¼å¸',breatheIn:'å¸æ°”',hold:'å±æ¯',release:'å‘¼æ°”',releaseSlow:'æ…¢æ…¢å‘¼æ°”',rest:'ä¼‘æ¯',tapToBegin:'ç‚¹å‡»å¼€å§‹',heart:'å¿ƒè½®å¼€å¯',awakening:'è§‰é†’',grounding:'æ‰æ ¹',unity:'åˆä¸€',peace:'æ·±åº¦å¹³é™',journey:'æ—…ç¨‹',breathwork:'å‘¼å¸æ³•',duration:'æ—¶é•¿',language:'è¯­è¨€',ifServes:'å¦‚æœæœ‰å¸®åŠ©',breathsWith:'æ¬¡å‘¼å¸',returnWhen:'å¿˜è®°æ—¶è¯·å›æ¥',voiceOn:'è¯­éŸ³å¼€å¯',voiceOff:'è¯­éŸ³å…³é—­',linkCopied:'å·²å¤åˆ¶ âœ“',shareThePeace:'åˆ†äº«å¹³é™',installing:'å®‰è£…ä¸­...',addToHome:'æ·»åŠ åˆ°ä¸»å±å¹•',headphones:'è€³æœºå¢å¼ºä½“éªŒ',close:'å…³é—­',gotIt:'çŸ¥é“äº†',balance:'å¹³è¡¡',calm:'å¹³é™',energy:'èƒ½é‡',deep:'æ·±åº¦',min5:'5åˆ†é’Ÿ',min10:'10åˆ†é’Ÿ',min20:'20åˆ†é’Ÿ',lifetimeBreaths:'æ€»å‘¼å¸æ¬¡æ•°',welcomeBack:'æ¬¢è¿å›æ¥',dayStreak:'å¤©è¿ç»­',updateAvailable:'æœ‰æ–°ç‰ˆæœ¬',update:'æ›´æ–°'},
  hi:{breathe:'à¤¸à¤¾à¤à¤¸',breatheIn:'à¤¸à¤¾à¤à¤¸ à¤²à¥‹',hold:'à¤°à¥‹à¤•à¥‹',release:'à¤›à¥‹à¤¡à¤¼à¥‹',releaseSlow:'à¤§à¥€à¤°à¥‡ à¤›à¥‹à¤¡à¤¼à¥‹',rest:'à¤µà¤¿à¤¶à¥à¤°à¤¾à¤®',tapToBegin:'à¤Ÿà¥ˆà¤ª à¤•à¤°à¥‡à¤‚',heart:'à¤¹à¥ƒà¤¦à¤¯ à¤–à¥‹à¤²à¤¨à¤¾',awakening:'à¤œà¤¾à¤—à¥ƒà¤¤à¤¿',grounding:'à¤—à¥à¤°à¤¾à¤‰à¤‚à¤¡à¤¿à¤‚à¤—',unity:'à¤à¤•à¤¤à¤¾',peace:'à¤—à¤¹à¤°à¥€ à¤¶à¤¾à¤‚à¤¤à¤¿',journey:'à¤¯à¤¾à¤¤à¥à¤°à¤¾',breathwork:'à¤¶à¥à¤µà¤¾à¤¸ à¤•à¥à¤°à¤¿à¤¯à¤¾',duration:'à¤…à¤µà¤§à¤¿',language:'à¤­à¤¾à¤·à¤¾',ifServes:'à¤…à¤—à¤° à¤®à¤¦à¤¦ à¤•à¤°à¥‡',breathsWith:'à¤¸à¤¾à¤à¤¸à¥‡à¤‚',returnWhen:'à¤œà¤¬ à¤­à¥‚à¤² à¤œà¤¾à¤“ à¤²à¥Œà¤Ÿ à¤†à¤“',voiceOn:'à¤†à¤µà¤¾à¤œà¤¼ à¤šà¤¾à¤²à¥‚',voiceOff:'à¤†à¤µà¤¾à¤œà¤¼ à¤¬à¤‚à¤¦',linkCopied:'à¤•à¥‰à¤ªà¥€ âœ“',shareThePeace:'à¤¶à¤¾à¤‚à¤¤à¤¿ à¤¸à¤¾à¤à¤¾ à¤•à¤°à¥‡à¤‚',installing:'à¤‡à¤‚à¤¸à¥à¤Ÿà¥‰à¤² à¤¹à¥‹ à¤°à¤¹à¤¾...',addToHome:'à¤¹à¥‹à¤® à¤®à¥‡à¤‚ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚',headphones:'à¤¹à¥‡à¤¡à¤«à¥‹à¤¨ à¤¸à¥‡ à¤¬à¥‡à¤¹à¤¤à¤° à¤…à¤¨à¥à¤­à¤µ',close:'à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚',gotIt:'à¤¸à¤®à¤ à¤—à¤¯à¤¾',balance:'à¤¸à¤‚à¤¤à¥à¤²à¤¨',calm:'à¤¶à¤¾à¤‚à¤¤',energy:'à¤Šà¤°à¥à¤œà¤¾',deep:'à¤—à¤¹à¤°à¤¾',min5:'5 à¤®à¤¿à¤¨à¤Ÿ',min10:'10 à¤®à¤¿à¤¨à¤Ÿ',min20:'20 à¤®à¤¿à¤¨à¤Ÿ',lifetimeBreaths:'à¤•à¥à¤² à¤¸à¤¾à¤à¤¸à¥‡à¤‚',welcomeBack:'à¤µà¤¾à¤ªà¤¸à¥€ à¤ªà¤° à¤¸à¥à¤µà¤¾à¤—à¤¤',dayStreak:'à¤¦à¤¿à¤¨ à¤²à¤—à¤¾à¤¤à¤¾à¤°',updateAvailable:'à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤‰à¤ªà¤²à¤¬à¥à¤§',update:'à¤…à¤ªà¤¡à¥‡à¤Ÿ'},
  ar:{breathe:'ØªÙ†ÙØ³',breatheIn:'Ø´Ù‡ÙŠÙ‚',hold:'Ø§Ø­Ø¨Ø³',release:'Ø²ÙÙŠØ±',releaseSlow:'Ø²ÙÙŠØ± Ø¨Ø¨Ø·Ø¡',rest:'Ø§Ø³ØªØ±Ø­',tapToBegin:'Ø§Ù†Ù‚Ø± Ù„Ù„Ø¨Ø¯Ø¡',heart:'ÙØªØ­ Ø§Ù„Ù‚Ù„Ø¨',awakening:'Ø§Ù„ØµØ­ÙˆØ©',grounding:'Ø§Ù„ØªØ£Ø±ÙŠØ¶',unity:'Ø§Ù„ÙˆØ­Ø¯Ø©',peace:'Ø§Ù„Ø³Ù„Ø§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚',journey:'Ø§Ù„Ø±Ø­Ù„Ø©',breathwork:'ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ØªÙ†ÙØ³',duration:'Ø§Ù„Ù…Ø¯Ø©',language:'Ø§Ù„Ù„ØºØ©',ifServes:'Ø¥Ø°Ø§ Ø£ÙØ§Ø¯Ùƒ',breathsWith:'Ø£Ù†ÙØ§Ø³',returnWhen:'Ø¹Ø¯ Ø¹Ù†Ø¯Ù…Ø§ ØªÙ†Ø³Ù‰',voiceOn:'Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù„',voiceOff:'Ø§Ù„ØµÙˆØª Ù…Ø¹Ø·Ù„',linkCopied:'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“',shareThePeace:'Ø´Ø§Ø±Ùƒ Ø§Ù„Ø³Ù„Ø§Ù…',installing:'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ«Ø¨ÙŠØª...',addToHome:'Ø£Ø¶Ù Ù„Ù„Ø´Ø§Ø´Ø©',headphones:'Ø§Ù„Ø³Ù…Ø§Ø¹Ø§Øª ØªØ¹Ø²Ø² Ø§Ù„ØªØ¬Ø±Ø¨Ø©',close:'Ø¥ØºÙ„Ø§Ù‚',gotIt:'ÙÙ‡Ù…Øª',balance:'ØªÙˆØ§Ø²Ù†',calm:'Ù‡Ø¯ÙˆØ¡',energy:'Ø·Ø§Ù‚Ø©',deep:'Ø¹Ù…ÙŠÙ‚',min5:'5 Ø¯Ù‚Ø§Ø¦Ù‚',min10:'10 Ø¯Ù‚Ø§Ø¦Ù‚',min20:'20 Ø¯Ù‚ÙŠÙ‚Ø©',lifetimeBreaths:'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù†ÙØ§Ø³',welcomeBack:'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ',dayStreak:'Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©',updateAvailable:'ØªØ­Ø¯ÙŠØ« Ù…ØªØ§Ø­',update:'ØªØ­Ø¯ÙŠØ«'},
  pt:{breathe:'respire',breatheIn:'inspire',hold:'segure',release:'expire',releaseSlow:'expire devagar',rest:'descanse',tapToBegin:'toque para comeÃ§ar',heart:'Abertura do CoraÃ§Ã£o',awakening:'Despertar',grounding:'Aterramento',unity:'Unidade',peace:'Paz Profunda',journey:'Jornada',breathwork:'RespiraÃ§Ã£o',duration:'DuraÃ§Ã£o',language:'Idioma',ifServes:'se te servir',breathsWith:'respiraÃ§Ãµes',returnWhen:'volte quando esquecer',voiceOn:'voz ativada',voiceOff:'voz desativada',linkCopied:'copiado âœ“',shareThePeace:'compartilhe a paz',installing:'instalando...',addToHome:'Adicionar Ã  Tela',headphones:'fones melhoram a experiÃªncia',close:'fechar',gotIt:'entendi',balance:'EquilÃ­brio',calm:'Calma',energy:'Energia',deep:'Profundo',min5:'5 min',min10:'10 min',min20:'20 min',lifetimeBreaths:'respiraÃ§Ãµes totais',welcomeBack:'bem-vindo',dayStreak:'dias seguidos',updateAvailable:'AtualizaÃ§Ã£o disponÃ­vel',update:'Atualizar'},
  ru:{breathe:'Ğ´Ñ‹ÑˆĞ¸',breatheIn:'Ğ²Ğ´Ğ¾Ñ…',hold:'Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ°',release:'Ğ²Ñ‹Ğ´Ğ¾Ñ…',releaseSlow:'Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ´Ğ¾Ñ…',rest:'Ğ¾Ñ‚Ğ´Ñ‹Ñ…',tapToBegin:'Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ',heart:'ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¡ĞµÑ€Ğ´Ñ†Ğ°',awakening:'ĞŸÑ€Ğ¾Ğ±ÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ğµ',grounding:'Ğ—Ğ°Ğ·ĞµĞ¼Ğ»ĞµĞ½Ğ¸Ğµ',unity:'Ğ•Ğ´Ğ¸Ğ½ÑÑ‚Ğ²Ğ¾',peace:'Ğ“Ğ»ÑƒĞ±Ğ¾ĞºĞ¸Ğ¹ ĞŸĞ¾ĞºĞ¾Ğ¹',journey:'ĞŸÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ',breathwork:'Ğ”Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ',duration:'Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ',language:'Ğ¯Ğ·Ñ‹Ğº',ifServes:'ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ğ¶ĞµÑ‚',breathsWith:'Ğ²Ğ´Ğ¾Ñ…Ğ¾Ğ²',returnWhen:'Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°Ğ¹Ñ‚ĞµÑÑŒ',voiceOn:'Ğ³Ğ¾Ğ»Ğ¾Ñ Ğ²ĞºĞ»',voiceOff:'Ğ³Ğ¾Ğ»Ğ¾Ñ Ğ²Ñ‹ĞºĞ»',linkCopied:'ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ âœ“',shareThePeace:'Ğ¿Ğ¾Ğ´ĞµĞ»Ğ¸Ñ‚ĞµÑÑŒ Ğ¿Ğ¾ĞºĞ¾ĞµĞ¼',installing:'ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°...',addToHome:'ĞĞ° Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ÑĞºÑ€Ğ°Ğ½',headphones:'Ğ½Ğ°ÑƒÑˆĞ½Ğ¸ĞºĞ¸ ÑƒÑĞ¸Ğ»ÑÑ‚ ÑÑ„Ñ„ĞµĞºÑ‚',close:'Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ',gotIt:'Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾',balance:'Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ',calm:'ĞŸĞ¾ĞºĞ¾Ğ¹',energy:'Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ',deep:'Ğ“Ğ»ÑƒĞ±Ğ¸Ğ½Ğ°',min5:'5 Ğ¼Ğ¸Ğ½',min10:'10 Ğ¼Ğ¸Ğ½',min20:'20 Ğ¼Ğ¸Ğ½',lifetimeBreaths:'Ğ²ÑĞµĞ³Ğ¾ Ğ²Ğ´Ğ¾Ñ…Ğ¾Ğ²',welcomeBack:'Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸ĞµĞ¼',dayStreak:'Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´',updateAvailable:'Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ',update:'ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ'},
  ja:{breathe:'å‘¼å¸',breatheIn:'å¸ã†',hold:'æ­¢ã‚ã‚‹',release:'åã',releaseSlow:'ã‚†ã£ãã‚Šåã',rest:'ä¼‘ã‚€',tapToBegin:'ã‚¿ãƒƒãƒ—ã—ã¦é–‹å§‹',heart:'ãƒãƒ¼ãƒˆã‚’é–‹ã',awakening:'ç›®è¦šã‚',grounding:'ã‚°ãƒ©ã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°',unity:'çµ±ä¸€',peace:'æ·±ã„å¹³å’Œ',journey:'ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼',breathwork:'å‘¼å¸æ³•',duration:'æ™‚é–“',language:'è¨€èª',ifServes:'ãŠå½¹ã«ç«‹ã¦ã‚Œã°',breathsWith:'å›ã®å‘¼å¸',returnWhen:'å¿˜ã‚ŒãŸæ™‚ã«',voiceOn:'éŸ³å£°ã‚ªãƒ³',voiceOff:'éŸ³å£°ã‚ªãƒ•',linkCopied:'ã‚³ãƒ”ãƒ¼ âœ“',shareThePeace:'å¹³å’Œã‚’å…±æœ‰',installing:'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­...',addToHome:'ãƒ›ãƒ¼ãƒ ã«è¿½åŠ ',headphones:'ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³æ¨å¥¨',close:'é–‰ã˜ã‚‹',gotIt:'äº†è§£',balance:'ãƒãƒ©ãƒ³ã‚¹',calm:'ç©ã‚„ã‹',energy:'ã‚¨ãƒãƒ«ã‚®ãƒ¼',deep:'æ·±ã„',min5:'5åˆ†',min10:'10åˆ†',min20:'20åˆ†',lifetimeBreaths:'ç·å‘¼å¸æ•°',welcomeBack:'ãŠã‹ãˆã‚Šãªã•ã„',dayStreak:'æ—¥é€£ç¶š',updateAvailable:'æ›´æ–°ãŒã‚ã‚Šã¾ã™',update:'æ›´æ–°'},
  ko:{breathe:'ìˆ¨ì‰¬ê¸°',breatheIn:'ë“¤ì´ì‰¬ê¸°',hold:'ë©ˆì¶”ê¸°',release:'ë‚´ì‰¬ê¸°',releaseSlow:'ì²œì²œíˆ ë‚´ì‰¬ê¸°',rest:'ì‰¬ê¸°',tapToBegin:'íƒ­í•˜ì—¬ ì‹œì‘',heart:'ì‹¬ì¥ ì—´ê¸°',awakening:'ê°ì„±',grounding:'ê·¸ë¼ìš´ë”©',unity:'í•˜ë‚˜ë¨',peace:'ê¹Šì€ í‰í™”',journey:'ì—¬ì •',breathwork:'í˜¸í¡ë²•',duration:'ì‹œê°„',language:'ì–¸ì–´',ifServes:'ë„ì›€ì´ ëœë‹¤ë©´',breathsWith:'ë²ˆ í˜¸í¡',returnWhen:'ìŠì„ ë•Œ ëŒì•„ì˜¤ì„¸ìš”',voiceOn:'ìŒì„± ì¼œê¸°',voiceOff:'ìŒì„± ë„ê¸°',linkCopied:'ë³µì‚¬ë¨ âœ“',shareThePeace:'í‰í™”ë¥¼ ë‚˜ëˆ„ì„¸ìš”',installing:'ì„¤ì¹˜ ì¤‘...',addToHome:'í™ˆì— ì¶”ê°€',headphones:'í—¤ë“œí° ê¶Œì¥',close:'ë‹«ê¸°',gotIt:'ì•Œê² ìŠµë‹ˆë‹¤',balance:'ê· í˜•',calm:'í‰ì˜¨',energy:'ì—ë„ˆì§€',deep:'ê¹Šì€',min5:'5ë¶„',min10:'10ë¶„',min20:'20ë¶„',lifetimeBreaths:'ì´ í˜¸í¡',welcomeBack:'í™˜ì˜í•©ë‹ˆë‹¤',dayStreak:'ì¼ ì—°ì†',updateAvailable:'ì—…ë°ì´íŠ¸ ê°€ëŠ¥',update:'ì—…ë°ì´íŠ¸'},
  fr:{breathe:'respire',breatheIn:'inspire',hold:'retiens',release:'expire',releaseSlow:'expire lentement',rest:'repose',tapToBegin:'touche pour commencer',heart:'Ouverture du CÅ“ur',awakening:'Ã‰veil',grounding:'Ancrage',unity:'UnitÃ©',peace:'Paix Profonde',journey:'Voyage',breathwork:'Respiration',duration:'DurÃ©e',language:'Langue',ifServes:'si cela vous aide',breathsWith:'respirations',returnWhen:'revenez',voiceOn:'voix on',voiceOff:'voix off',linkCopied:'copiÃ© âœ“',shareThePeace:'partagez la paix',installing:'installation...',addToHome:'Ajouter Ã  l\'Ã©cran',headphones:'Ã©couteurs recommandÃ©s',close:'fermer',gotIt:'compris',balance:'Ã‰quilibre',calm:'Calme',energy:'Ã‰nergie',deep:'Profond',min5:'5 min',min10:'10 min',min20:'20 min',lifetimeBreaths:'respirations totales',welcomeBack:'bon retour',dayStreak:'jours consÃ©cutifs',updateAvailable:'Mise Ã  jour disponible',update:'Mettre Ã  jour'}
};

const BREATHWORK={balance:{pattern:[4,4,4,4],getWords:L=>[L.breatheIn,L.hold,L.release,L.rest]},calm:{pattern:[4,7,8,0],getWords:L=>[L.breatheIn,L.hold,L.releaseSlow,'']},energy:{pattern:[4,0,4,0],getWords:L=>[L.breatheIn,'',L.release,'']},deep:{pattern:[4,0,8,0],getWords:L=>[L.breatheIn,'',L.releaseSlow,'']}};
const CRYPTO={btc:'bc1qwjsvjg0ckfw2aa9c5zdhc4ewxn7yse8lvstuaz',eth:'0x12e10C6aA1557A9B13c570c0070E223aec8dE498'};
const JOURNEYS={heart:{base:6,shifts:[2,1,-1,-2],freqs:[528,432,396,417],volumes:[.06,.05,.04,.025]},awakening:{base:40,shifts:[3,1,-1,-3],freqs:[741,852,963,639],volumes:[.06,.05,.04,.025]},grounding:{base:2,shifts:[1,.5,-.5,-1],freqs:[285,432,174,128],volumes:[.06,.05,.04,.025]},unity:{base:10,shifts:[2,1,-1,-2],freqs:[528,639,111,432],volumes:[.06,.05,.04,.025]},peace:{base:4,shifts:[1.5,.5,-.5,-1.5],freqs:[432,396,417,528],volumes:[.05,.04,.03,.02]}};
const WISDOMS=["you are worthy of love. you always have been.","your heart knows the way. trust it.","love is not earned. it is remembered.","consciousness is not found. it is unveiled.","the truth you seek is seeking you.","you have always been the light you're looking for.","stillness speaks louder than thought.","you are held by the earth. always.","your body is your first home. return to it.","presence is the anchor. breath is the chain.","you belong here. you have always belonged.","separation is the illusion. oneness is the truth.","there is no other. there is only one.","peace begins when we remember we are one.","every breath connects you to all beings.","peace is not found. it is remembered.","stillness is your nature. return to it.","in the quiet, God speaks.","surrender is not giving up. it is opening up.","the deepest peace is already within you."];

const S={on:false,phase:0,breaths:0,sound:false,voice:false,journey:'heart',breathwork:'balance',duration:600,elapsed:0,timer:null,tickTimer:null,audio:null,osc:null,oscL:null,oscR:null,subOsc:null,gain:null,gainL:null,gainR:null,subGain:null,hasStarted:false,headphonesShown:false,deferredPrompt:null,lang:'en',lifetimeBreaths:0,streak:0,lastVisit:null,introPlayed:false,swRegistration:null,updateAvailable:false};

try{const saved=localStorage.getItem('innerafield');if(saved){const p=JSON.parse(saved);S.journey=p.journey||'heart';S.breathwork=p.breathwork||'balance';S.duration=p.duration??600;S.sound=p.sound||false;S.voice=p.voice||false;S.lang=p.lang||'en';S.lifetimeBreaths=p.lifetimeBreaths||0;S.streak=p.streak||0;S.lastVisit=p.lastVisit||null;}}catch(e){}

function updateStreak(){const today=new Date().toDateString();if(S.lastVisit){const last=new Date(S.lastVisit);const lastDate=last.toDateString();const yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);if(lastDate!==today){S.streak=lastDate===yesterday.toDateString()?S.streak+1:1;}}else{S.streak=1;}S.lastVisit=today;savePrefs();}

const $=id=>document.getElementById(id);
const circle=$('circle'),word=$('word'),hint=$('hint'),phaseEl=$('phase'),timerDisplay=$('timerDisplay'),wisdom=$('wisdom'),sessionMsg=$('sessionMsg'),sr=$('sr'),menu=$('menu'),overlay=$('overlay'),toast=$('toast'),donateModal=$('donateModal'),iosModal=$('iosModal'),langModal=$('langModal'),installBtn=$('installBtn'),installBtnTop=$('installBtnTop'),streakEl=$('streak'),streakCount=$('streakCount'),updateBanner=$('updateBanner'),versionDisplay=$('versionDisplay');
const phases=['inhale','hold-in','exhale','hold-out'];

function t(key){return LANG[S.lang]?.[key]||LANG.en[key]||key;}
function getPattern(){return BREATHWORK[S.breathwork].pattern;}
function getWords(){return BREATHWORK[S.breathwork].getWords(LANG[S.lang]||LANG.en);}
function findNextActivePhase(from){const pattern=getPattern();let next=(from+1)%4;for(let i=0;i<4;i++){if(pattern[next]>0)return next;next=(next+1)%4;}return 0;}

function updateUI(){
  const L=LANG[S.lang]||LANG.en;
  if(!S.on){word.textContent=L.breathe;hint.textContent=L.tapToBegin;}
  $('energyText').textContent=L.ifServes;
  $('journeyLabel').textContent=L.journey;
  $('breathworkLabel').textContent=L.breathwork;
  $('durationLabel').textContent=L.duration;
  $('langTitle').textContent=L.language;
  $('donateClose').textContent=L.close;
  $('iosTitle').textContent=L.addToHome;
  $('iosClose').textContent=L.gotIt;
  $('langClose').textContent=L.close;
  document.querySelectorAll('[data-i18n]').forEach(el=>{const key=el.dataset.i18n;if(L[key])el.textContent=L[key];});
  document.querySelectorAll('[data-lang]').forEach(el=>el.classList.toggle('selected',el.dataset.lang===S.lang));
  if(S.streak>1){streakCount.textContent=S.streak;streakEl.classList.add('show');}
  versionDisplay.textContent='v'+VERSION;
}

function savePrefs(){try{localStorage.setItem('innerafield',JSON.stringify({journey:S.journey,breathwork:S.breathwork,duration:S.duration,sound:S.sound,voice:S.voice,lang:S.lang,lifetimeBreaths:S.lifetimeBreaths,streak:S.streak,lastVisit:S.lastVisit}));}catch(e){}}

/* Audio */
function initAudio(){if(S.audio)return;S.audio=new(window.AudioContext||window.webkitAudioContext)();S.gain=S.audio.createGain();S.gain.gain.value=0;S.gain.connect(S.audio.destination);S.gainL=S.audio.createGain();S.gainR=S.audio.createGain();S.gainL.gain.value=0;S.gainR.gain.value=0;const merger=S.audio.createChannelMerger(2);S.gainL.connect(merger,0,0);S.gainR.connect(merger,0,1);merger.connect(S.audio.destination);S.subGain=S.audio.createGain();S.subGain.gain.value=0;S.subGain.connect(S.audio.destination);}

function playWelcomeTone(){
  if(S.introPlayed)return;S.introPlayed=true;
  try{
    const ctx=new(window.AudioContext||window.webkitAudioContext)();
    const now=ctx.currentTime;
    const osc1=ctx.createOscillator();osc1.type='sine';osc1.frequency.value=528;
    const osc2=ctx.createOscillator();osc2.type='sine';osc2.frequency.value=396;
    const osc3=ctx.createOscillator();osc3.type='triangle';osc3.frequency.value=1056;
    const g1=ctx.createGain(),g2=ctx.createGain(),g3=ctx.createGain();
    g1.gain.setValueAtTime(0,now);g1.gain.linearRampToValueAtTime(.07,now+.6);g1.gain.linearRampToValueAtTime(.05,now+2);g1.gain.linearRampToValueAtTime(0,now+3.5);
    g2.gain.setValueAtTime(0,now);g2.gain.linearRampToValueAtTime(.035,now+.9);g2.gain.linearRampToValueAtTime(.025,now+2);g2.gain.linearRampToValueAtTime(0,now+3.5);
    g3.gain.setValueAtTime(0,now);g3.gain.linearRampToValueAtTime(.015,now+.3);g3.gain.linearRampToValueAtTime(0,now+1.5);
    osc1.connect(g1);g1.connect(ctx.destination);osc2.connect(g2);g2.connect(ctx.destination);osc3.connect(g3);g3.connect(ctx.destination);
    osc1.start(now);osc2.start(now+.3);osc3.start(now);osc1.stop(now+4);osc2.stop(now+4);osc3.stop(now+2);
    setTimeout(()=>ctx.close(),5000);
  }catch(e){}
}

function fadeOutSolfeggio(){if(S.audio&&S.gain)S.gain.gain.setTargetAtTime(0,S.audio.currentTime,.1);}
function playFreq(hz,vol){if(!S.audio)return;if(S.osc)S.osc.frequency.setTargetAtTime(hz,S.audio.currentTime,.3);else{S.osc=S.audio.createOscillator();S.osc.type='sine';S.osc.frequency.value=hz;S.osc.connect(S.gain);S.osc.start();}S.gain.gain.setTargetAtTime(vol,S.audio.currentTime,.3);}
function playBinaural(beatHz){if(!S.audio)return;const base=200;if(!S.oscL){S.oscL=S.audio.createOscillator();S.oscL.type='sine';S.oscL.connect(S.gainL);S.oscL.start();}S.oscL.frequency.setTargetAtTime(base,S.audio.currentTime,.2);if(!S.oscR){S.oscR=S.audio.createOscillator();S.oscR.type='sine';S.oscR.connect(S.gainR);S.oscR.start();}S.oscR.frequency.setTargetAtTime(base+beatHz,S.audio.currentTime,.2);S.gainL.gain.setTargetAtTime(.04,S.audio.currentTime,.3);S.gainR.gain.setTargetAtTime(.04,S.audio.currentTime,.3);}
function playSubBass(){if(!S.audio)return;if(!S.subOsc){S.subOsc=S.audio.createOscillator();S.subOsc.type='sine';S.subOsc.frequency.value=50;S.subOsc.connect(S.subGain);S.subOsc.start();}S.subGain.gain.setTargetAtTime(.1,S.audio.currentTime,.5);}
function stopAudio(){if(S.audio){if(S.gain)S.gain.gain.setTargetAtTime(0,S.audio.currentTime,.4);if(S.gainL)S.gainL.gain.setTargetAtTime(0,S.audio.currentTime,.4);if(S.gainR)S.gainR.gain.setTargetAtTime(0,S.audio.currentTime,.4);if(S.subGain)S.subGain.gain.setTargetAtTime(0,S.audio.currentTime,.4);}}
function speak(text){if(!S.voice||!text||!window.speechSynthesis)return;speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(text);u.rate=.75;u.pitch=.85;u.volume=.6;u.lang=S.lang;speechSynthesis.speak(u);}
function showToast(msg,icon=''){toast.innerHTML=icon?'<span class="icon">'+icon+'</span>'+msg:msg;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),3000);}

/* Breathing */
function setPhase(i){const pattern=getPattern(),words=getWords(),journey=JOURNEYS[S.journey],dur=pattern[i];S.phase=i;circle.style.transitionDuration=(dur*.9)+'s';circle.className='circle breathing '+phases[i];const w=words[i];word.textContent=w||'';phaseEl.textContent=w?phases[i].replace('-in',' in').replace('-out',' out'):'';sr.textContent=w||'';if(w)speak(w);if(S.sound&&S.audio){fadeOutSolfeggio();setTimeout(()=>{if(!S.on)return;playFreq(journey.freqs[i],journey.volumes[i]);playBinaural(journey.base+journey.shifts[i]);},150);}if(i===2){S.breaths++;S.lifetimeBreaths++;}}
function scheduleNext(){if(!S.on)return;S.timer=setTimeout(()=>{if(!S.on)return;setPhase(findNextActivePhase(S.phase));scheduleNext();},getPattern()[S.phase]*1000);}
function updateTimer(){if(!S.on)return;S.elapsed++;if(S.duration>0){const rem=S.duration-S.elapsed;if(rem<=0){stop();return;}timerDisplay.textContent=Math.floor(rem/60)+':'+(rem%60<10?'0':'')+(rem%60);}else timerDisplay.textContent=t('breathe')+' '+S.breaths;S.tickTimer=setTimeout(updateTimer,1000);}

function start(){if(S.on)return;S.on=true;S.breaths=0;S.elapsed=0;S.hasStarted=true;document.body.classList.add('active');sessionMsg.classList.remove('show');sessionMsg.innerHTML='';hint.style.display='none';wisdom.textContent=WISDOMS[Math.floor(Math.random()*WISDOMS.length)];circle.classList.remove('idle');circle.classList.add('starting');if(S.sound){initAudio();if(S.audio.state==='suspended')S.audio.resume();playSubBass();}setTimeout(()=>{circle.classList.remove('starting');const pattern=getPattern();let first=0;for(let i=0;i<4;i++)if(pattern[i]>0){first=i;break;}setPhase(first);scheduleNext();updateTimer();},400);sr.textContent='Breathing started.';}

function stop(){if(!S.on)return;S.on=false;document.body.classList.remove('active');clearTimeout(S.timer);clearTimeout(S.tickTimer);S.timer=S.tickTimer=null;circle.style.transitionDuration='';circle.className='circle idle';word.textContent=t('breathe');phaseEl.textContent='';timerDisplay.textContent='';stopAudio();savePrefs();sessionMsg.innerHTML='<span class="count">âœ§ '+S.breaths+' '+t('breathsWith')+' âœ§</span><br>'+t('returnWhen')+'<span class="lifetime">'+S.lifetimeBreaths.toLocaleString()+' '+t('lifetimeBreaths')+'</span>';sessionMsg.classList.add('show');setTimeout(()=>{sessionMsg.classList.remove('show');wisdom.textContent='';},8000);sr.textContent=S.breaths+' breaths complete.';}

function toggle(){S.on?stop():start();}
function openMenu(){menu.classList.add('open');overlay.classList.add('show');}
function closeMenu(){menu.classList.remove('open');overlay.classList.remove('show');}
function closeAllModals(){donateModal.classList.remove('show');iosModal.classList.remove('show');langModal.classList.remove('show');}

function initMenuState(){document.querySelectorAll('[data-journey]').forEach(el=>el.classList.toggle('selected',el.dataset.journey===S.journey));document.querySelectorAll('[data-breath]').forEach(el=>el.classList.toggle('selected',el.dataset.breath===S.breathwork));document.querySelectorAll('[data-time]').forEach(el=>el.classList.toggle('selected',parseInt(el.dataset.time)===S.duration));document.querySelectorAll('[data-lang]').forEach(el=>el.classList.toggle('selected',el.dataset.lang===S.lang));$('soundBtn').classList.toggle('on',S.sound);$('voiceBtn').classList.toggle('on',S.voice);updateUI();}

/* Event listeners */
document.querySelectorAll('[data-journey]').forEach(el=>el.addEventListener('click',()=>{document.querySelectorAll('[data-journey]').forEach(e=>e.classList.remove('selected'));el.classList.add('selected');S.journey=el.dataset.journey;savePrefs();}));
document.querySelectorAll('[data-breath]').forEach(el=>el.addEventListener('click',()=>{document.querySelectorAll('[data-breath]').forEach(e=>e.classList.remove('selected'));el.classList.add('selected');S.breathwork=el.dataset.breath;savePrefs();}));
document.querySelectorAll('[data-time]').forEach(el=>el.addEventListener('click',()=>{document.querySelectorAll('[data-time]').forEach(e=>e.classList.remove('selected'));el.classList.add('selected');S.duration=parseInt(el.dataset.time);savePrefs();}));
document.querySelectorAll('[data-lang]').forEach(el=>el.addEventListener('click',()=>{document.querySelectorAll('[data-lang]').forEach(e=>e.classList.remove('selected'));el.classList.add('selected');S.lang=el.dataset.lang;savePrefs();updateUI();langModal.classList.remove('show');}));

$('voiceBtn').addEventListener('click',()=>{S.voice=!S.voice;$('voiceBtn').classList.toggle('on',S.voice);savePrefs();showToast(S.voice?t('voiceOn'):t('voiceOff'));});
$('langBtn').addEventListener('click',()=>langModal.classList.add('show'));
$('langClose').addEventListener('click',()=>langModal.classList.remove('show'));
$('menuBtn').addEventListener('click',openMenu);
$('menuClose').addEventListener('click',closeMenu);
overlay.addEventListener('click',()=>{closeMenu();closeAllModals();});
$('soundBtn').addEventListener('click',()=>{S.sound=!S.sound;$('soundBtn').classList.toggle('on',S.sound);savePrefs();if(S.sound){if(!S.headphonesShown){showToast(t('headphones'),'ğŸ§');S.headphonesShown=true;}if(S.on){initAudio();if(S.audio.state==='suspended')S.audio.resume();const j=JOURNEYS[S.journey];playFreq(j.freqs[S.phase],j.volumes[S.phase]);playBinaural(j.base+j.shifts[S.phase]);playSubBass();}}else stopAudio();});
$('contrastBtn').addEventListener('click',()=>{document.body.classList.toggle('contrast');$('contrastBtn').classList.toggle('on',document.body.classList.contains('contrast'));});

async function shareApp(){const d={title:'Innera Field',text:'Free breathing meditation. No account. No tracking. Just peace.',url:'https://innerafield.com'};if(navigator.share)try{await navigator.share(d);}catch(e){if(e.name!=='AbortError')copyLink();}else copyLink();}
function copyLink(){navigator.clipboard.writeText('https://innerafield.com').then(()=>showToast(t('linkCopied')+'<br>'+t('shareThePeace'))).catch(()=>showToast('innerafield.com'));}
$('shareBtn').addEventListener('click',shareApp);
$('menuShareBtn').addEventListener('click',shareApp);

function showDonateModal(type){const addr=type==='btc'?CRYPTO.btc:CRYPTO.eth;$('donateTitle').textContent=type==='btc'?'BITCOIN':'ETHEREUM';$('donateAddress').textContent=addr;$('donateQR').src='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data='+encodeURIComponent(addr);donateModal.classList.add('show');}
$('btcBtn').addEventListener('click',()=>showDonateModal('btc'));
$('ethBtn').addEventListener('click',()=>showDonateModal('eth'));
$('donateClose').addEventListener('click',()=>donateModal.classList.remove('show'));
$('donateAddress').addEventListener('click',function(){navigator.clipboard.writeText(this.textContent).then(()=>showToast('address copied âœ“'));});
$('iosClose').addEventListener('click',()=>iosModal.classList.remove('show'));

function isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||(navigator.platform==='MacIntel'&&navigator.maxTouchPoints>1);}
function isStandalone(){return window.matchMedia('(display-mode:standalone)').matches||window.navigator.standalone===true;}
async function handleInstall(){if(S.deferredPrompt){S.deferredPrompt.prompt();const r=await S.deferredPrompt.userChoice;S.deferredPrompt=null;if(r.outcome==='accepted'){showToast(t('installing'),'âœ“');installBtn.classList.add('hidden');installBtnTop.classList.add('hidden');}}else if(isIOS())iosModal.classList.add('show');else showToast(t('addToHome'));}
window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();S.deferredPrompt=e;installBtn.classList.remove('hidden');installBtnTop.classList.remove('hidden');});
installBtn.addEventListener('click',handleInstall);
installBtnTop.addEventListener('click',handleInstall);
if(isStandalone()){installBtn.classList.add('hidden');installBtnTop.classList.add('hidden');}
if(isIOS()&&!isStandalone()){installBtn.classList.remove('hidden');installBtnTop.classList.remove('hidden');}

circle.addEventListener('click',toggle);
circle.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();toggle();}});
document.addEventListener('keydown',e=>{if(e.key===' '&&document.activeElement===document.body){e.preventDefault();toggle();}if(e.key==='Escape'){if(donateModal.classList.contains('show'))donateModal.classList.remove('show');else if(iosModal.classList.contains('show'))iosModal.classList.remove('show');else if(langModal.classList.contains('show'))langModal.classList.remove('show');else if(menu.classList.contains('open'))closeMenu();else if(S.on)stop();}});

/* Service Worker & Updates */
function showUpdateBanner(){updateBanner.classList.add('show');}
$('updateBtn').addEventListener('click',()=>{if(S.swRegistration&&S.swRegistration.waiting){S.swRegistration.waiting.postMessage('SKIP_WAITING');}window.location.reload();});

if('serviceWorker'in navigator){
  navigator.serviceWorker.register('sw.js').then(reg=>{
    S.swRegistration=reg;
    reg.addEventListener('updatefound',()=>{
      const newWorker=reg.installing;
      newWorker.addEventListener('statechange',()=>{
        if(newWorker.state==='installed'&&navigator.serviceWorker.controller){
          S.updateAvailable=true;
          showUpdateBanner();
        }
      });
    });
  }).catch(()=>{});
  
  navigator.serviceWorker.addEventListener('message',e=>{
    if(e.data&&e.data.type==='SW_UPDATED'){
      console.log('Updated to version:',e.data.version);
    }
  });
  
  navigator.serviceWorker.addEventListener('controllerchange',()=>{
    if(S.updateAvailable)window.location.reload();
  });
}

/* Initialize */
updateStreak();
initMenuState();
setTimeout(()=>{if(!S.hasStarted&&hint)hint.style.opacity='0';},8000);
if(window.matchMedia('(prefers-contrast:more)').matches){document.body.classList.add('contrast');$('contrastBtn').classList.add('on');}

document.addEventListener('click',function welcome(){playWelcomeTone();document.removeEventListener('click',welcome);},{once:true});
setTimeout(()=>{if(!S.introPlayed)try{playWelcomeTone();}catch(e){}},1500);

})();
</script>
</body>
</html>
