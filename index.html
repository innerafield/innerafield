<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="description" content="Find your purpose. Connect to Source. For all beings. For peace.">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Innera Field</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}

:root{
  --void:#000;
  --light:#fff;
  --dim:rgba(255,255,255,.6);
  --faint:rgba(255,255,255,.35);
  --glass:rgba(255,255,255,.05);
  --border:rgba(255,255,255,.12);
  --pink:rgba(255,20,147,.45);
  --blue:rgba(0,191,255,.45);
  --purple:rgba(138,43,226,.4);
  --gold:rgba(255,215,0,.5);
}

html,body{
  width:100%;
  height:100%;
  overflow:hidden;
}

body{
  font-family:Inter,-apple-system,sans-serif;
  background:var(--void);
  color:var(--light);
  display:flex;
  align-items:center;
  justify-content:center;
  -webkit-tap-highlight-color:transparent;
  animation:awakening 1.5s ease-out;
}

@keyframes awakening{
  0%{opacity:0}
  100%{opacity:1}
}

/* Cosmic background */
.cosmos{
  position:fixed;
  inset:0;
  z-index:0;
  background:
    radial-gradient(ellipse at 30% 20%,var(--pink),transparent 50%),
    radial-gradient(ellipse at 70% 80%,var(--blue),transparent 50%),
    radial-gradient(circle at 50% 50%,var(--purple),transparent 60%);
  opacity:.45;
  animation:cosmicPulse 12s ease-in-out infinite;
  pointer-events:none;
}

@keyframes cosmicPulse{
  0%,100%{opacity:.4}
  50%{opacity:.6}
}

/* Main container */
.field{
  position:relative;
  z-index:1;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:1.5rem;
  text-align:center;
}

/* Title - ONE LINE, BOLD, LARGE */
.title{
  position:absolute;
  top:max(9vh,50px);
  font-size:clamp(1.4rem,5vw,3.2rem);
  font-weight:700;
  letter-spacing:.5em;
  padding-left:.5em;
  background:linear-gradient(135deg,#ff1493,#00bfff,#9b59b6,#ff1493);
  background-size:300% 300%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  animation:titleShimmer 8s ease-in-out infinite;
  user-select:none;
  white-space:nowrap;
}

@keyframes titleShimmer{
  0%,100%{background-position:0% 50%}
  50%{background-position:100% 50%}
}

/* Controls - LARGER for all devices */
.controls{
  position:absolute;
  top:max(2.5vh,12px);
  right:max(3vw,12px);
  display:flex;
  gap:1rem;
  z-index:100;
}

.ctrl{
  background:transparent;
  border:none;
  color:var(--dim);
  font-size:1.8rem;
  cursor:pointer;
  transition:all .25s ease;
  padding:.6rem;
  opacity:.55;
  min-width:48px;
  min-height:48px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.ctrl:hover,.ctrl:focus{
  opacity:1;
  color:var(--light);
}

.ctrl.on{
  opacity:1;
  color:#ff1493;
}

/* The Circle */
.circle{
  position:relative;
  width:min(280px,52vw);
  height:min(280px,52vw);
  border-radius:50%;
  background:radial-gradient(circle at 40% 35%,rgba(255,20,147,.06),transparent 60%);
  border:2px solid var(--border);
  box-shadow:0 0 80px var(--pink);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  cursor:pointer;
  transform:scale(1) translateZ(0);
  will-change:transform,box-shadow;
  transition:transform .4s ease-out,box-shadow .4s ease-out,border-color .4s ease;
}

/* Idle heartbeat */
.circle.idle{
  animation:heartbeat 5s ease-in-out infinite;
}

@keyframes heartbeat{
  0%,100%{transform:scale(1);box-shadow:0 0 80px var(--pink)}
  50%{transform:scale(1.02);box-shadow:0 0 100px var(--pink)}
}

/* Starting state - smooth entry */
.circle.starting{
  transform:scale(1.08) translateZ(0);
  transition:transform .4s ease-out;
}

/* Breathing states - SMOOTH transitions */
.circle.breathing{
  transition:transform 4s ease-in-out,box-shadow 4s ease-in-out,border-color 1s ease;
}

.circle.breathing.inhale{
  transform:scale(1.35) translateZ(0);
  border-color:rgba(255,215,0,.45);
  box-shadow:0 0 120px var(--gold);
}

.circle.breathing.hold-in{
  transform:scale(1.35) translateZ(0);
  border-color:rgba(255,180,150,.4);
  box-shadow:0 0 100px rgba(255,180,150,.45);
}

.circle.breathing.exhale{
  transform:scale(0.72) translateZ(0);
  border-color:rgba(0,191,255,.4);
  box-shadow:0 0 60px var(--blue);
}

.circle.breathing.hold-out{
  transform:scale(0.72) translateZ(0);
  border-color:rgba(138,43,226,.4);
  box-shadow:0 0 55px var(--purple);
}

.circle:hover:not(.breathing){border-color:rgba(255,255,255,.2)}
.circle:focus{outline:none}
.circle:focus-visible{outline:2px solid rgba(255,255,255,.35);outline-offset:14px}

/* Circle text */
.word{
  font-size:clamp(1.1rem,3.5vw,1.5rem);
  font-weight:400;
  letter-spacing:.28em;
  padding-left:.28em;
  text-transform:uppercase;
  opacity:.9;
  transition:all .8s ease;
  user-select:none;
}

.hint{
  font-size:clamp(.85rem,2.5vw,1.05rem);
  font-weight:300;
  letter-spacing:.15em;
  margin-top:.8rem;
  opacity:.45;
  transition:opacity .8s ease;
  color:var(--dim);
}

.breathing .hint{opacity:0;display:none}

.phase{
  font-size:clamp(.8rem,2.2vw,1rem);
  font-weight:300;
  letter-spacing:.16em;
  margin-top:.6rem;
  opacity:0;
  transition:opacity .8s ease;
  color:var(--dim);
}

.breathing .phase{opacity:1}

.timer{
  font-size:clamp(.7rem,1.8vw,.85rem);
  letter-spacing:.1em;
  margin-top:.5rem;
  opacity:0;
  color:var(--faint);
  transition:opacity .8s ease;
}

.breathing .timer{opacity:1}

/* Wisdom area */
.wisdom-area{
  position:absolute;
  bottom:max(11vh,70px);
  text-align:center;
  max-width:min(90%,450px);
}

.wisdom{
  font-size:clamp(.9rem,2.5vw,1.1rem);
  font-weight:300;
  letter-spacing:.06em;
  line-height:1.8;
  opacity:0;
  transition:opacity 2s ease;
  font-style:italic;
  color:rgba(255,255,255,.55);
}

.active .wisdom{opacity:1}

.session-msg{
  margin-top:1rem;
  font-size:clamp(.85rem,2.2vw,1rem);
  letter-spacing:.14em;
  opacity:0;
  color:var(--dim);
  transition:opacity 1.5s ease;
  line-height:1.8;
}

.session-msg.show{opacity:1}

.session-msg .count{
  color:rgba(255,20,147,.8);
}

/* Energy exchange */
.energy{
  position:absolute;
  bottom:max(3vh,14px);
  font-size:clamp(.8rem,2vw,.95rem);
  letter-spacing:.1em;
  opacity:.3;
  transition:opacity .4s ease;
  color:var(--dim);
  display:flex;
  align-items:center;
  gap:.8rem;
}

.energy:hover{opacity:.6}

.energy span{opacity:.7}

.energy-btn{
  background:none;
  border:none;
  color:inherit;
  font-size:clamp(1rem,2.5vw,1.2rem);
  cursor:pointer;
  padding:.5rem;
  opacity:.75;
  transition:all .3s;
  min-width:44px;
  min-height:44px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.energy-btn:hover{
  opacity:1;
  color:var(--light);
  transform:scale(1.1);
}

/* Toast */
.toast{
  position:fixed;
  bottom:18%;
  left:50%;
  transform:translateX(-50%) translateY(20px);
  background:rgba(0,0,0,.94);
  border:1px solid var(--border);
  padding:1.1rem 2rem;
  border-radius:12px;
  font-size:clamp(.85rem,2vw,.95rem);
  letter-spacing:.08em;
  opacity:0;
  pointer-events:none;
  transition:all .4s ease;
  z-index:300;
  text-align:center;
  max-width:90%;
}

.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}

.toast .icon{
  font-size:1.4rem;
  margin-bottom:.6rem;
}

/* Donation modal */
.donate-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  z-index:250;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:opacity .4s ease;
}

.donate-modal.show{
  opacity:1;
  pointer-events:auto;
}

.donate-content{
  background:rgba(12,12,12,.98);
  border:1px solid var(--border);
  border-radius:16px;
  padding:2.5rem;
  text-align:center;
  max-width:min(92%,360px);
}

.donate-content h3{
  font-size:1rem;
  font-weight:500;
  letter-spacing:.22em;
  margin-bottom:1.8rem;
  color:var(--dim);
}

.donate-qr{
  width:170px;
  height:170px;
  margin:0 auto 1.4rem;
  background:#fff;
  border-radius:12px;
  padding:12px;
}

.donate-qr img{
  width:100%;
  height:100%;
}

.donate-address{
  font-size:.72rem;
  letter-spacing:.04em;
  color:var(--faint);
  word-break:break-all;
  margin-bottom:1.4rem;
  padding:1.1rem;
  background:var(--glass);
  border-radius:10px;
  cursor:pointer;
  transition:all .3s;
}

.donate-address:hover{
  background:rgba(255,255,255,.1);
  color:var(--light);
}

.donate-close{
  background:none;
  border:1px solid var(--border);
  color:var(--dim);
  padding:.8rem 2rem;
  font-size:.85rem;
  letter-spacing:.15em;
  cursor:pointer;
  border-radius:10px;
  transition:all .3s;
}

.donate-close:hover{
  border-color:rgba(255,255,255,.3);
  color:var(--light);
}

/* Menu panel */
.menu{
  position:fixed;
  top:0;
  right:-340px;
  width:min(320px,90vw);
  height:100%;
  background:rgba(5,5,5,.97);
  border-left:1px solid var(--border);
  z-index:200;
  transition:right .35s ease-out;
  overflow-y:auto;
  padding:2rem;
}

.menu.open{right:0}

.menu-close{
  position:absolute;
  top:1.2rem;
  right:1.2rem;
  background:none;
  border:none;
  color:var(--dim);
  font-size:2rem;
  cursor:pointer;
  transition:color .3s;
  padding:.5rem;
  min-width:48px;
  min-height:48px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.menu-close:hover{color:var(--light)}

.menu h3{
  font-size:.8rem;
  font-weight:500;
  letter-spacing:.22em;
  color:var(--faint);
  margin:2.2rem 0 1rem;
  text-transform:uppercase;
}

.menu h3:first-of-type{margin-top:1.2rem}

.menu-item{
  display:flex;
  align-items:center;
  padding:1rem 1.2rem;
  margin:.35rem 0;
  background:transparent;
  border:1px solid transparent;
  border-radius:10px;
  cursor:pointer;
  transition:all .25s ease;
  font-size:1.05rem;
  color:var(--dim);
}

.menu-item:hover{
  background:var(--glass);
  color:var(--light);
}

.menu-item.selected{
  border-color:rgba(255,20,147,.3);
  background:rgba(255,20,147,.08);
  color:var(--light);
}

.menu-item .dot{
  width:8px;
  height:8px;
  border-radius:50%;
  margin-right:1rem;
  background:var(--border);
  transition:all .25s;
  flex-shrink:0;
}

.menu-item.selected .dot{
  background:#ff1493;
  box-shadow:0 0 12px rgba(255,20,147,.65);
}

.menu-divider{
  height:1px;
  background:var(--border);
  margin:1.6rem 0;
}

.time-row{
  display:flex;
  gap:.6rem;
}

.time-btn{
  flex:1;
  padding:.85rem .5rem;
  background:transparent;
  border:1px solid transparent;
  border-radius:10px;
  color:var(--dim);
  font-size:.95rem;
  cursor:pointer;
  transition:all .25s;
}

.time-btn:hover{background:var(--glass);color:var(--light)}
.time-btn.selected{border-color:rgba(255,20,147,.3);background:rgba(255,20,147,.08);color:var(--light)}

.toggle-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:1rem 0;
  font-size:1.05rem;
  color:var(--dim);
}

.toggle{
  width:52px;
  height:28px;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:14px;
  cursor:pointer;
  position:relative;
  transition:all .3s;
}

.toggle::after{
  content:'';
  position:absolute;
  top:4px;
  left:4px;
  width:18px;
  height:18px;
  background:var(--dim);
  border-radius:50%;
  transition:all .3s;
}

.toggle.on{
  background:rgba(255,20,147,.2);
  border-color:rgba(255,20,147,.45);
}

.toggle.on::after{
  left:28px;
  background:#ff1493;
}

.headphones-note{
  font-size:.85rem;
  color:var(--faint);
  margin-top:1.8rem;
  padding:1rem;
  background:var(--glass);
  border-radius:10px;
  text-align:center;
  line-height:1.7;
}

.headphones-note span{
  font-size:1.2rem;
  display:block;
  margin-bottom:.5rem;
}

/* Overlay */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  z-index:150;
  opacity:0;
  pointer-events:none;
  transition:opacity .35s;
}

.overlay.show{opacity:1;pointer-events:auto}

/* Screen reader */
.sr{
  position:absolute;
  width:1px;height:1px;
  padding:0;margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  border:0;
}

/* High contrast */
body.contrast .circle{border:2px solid #fff;box-shadow:0 0 50px rgba(255,255,255,.3)}
body.contrast .word,body.contrast .phase,body.contrast .wisdom,body.contrast .title{
  -webkit-text-fill-color:#fff;color:#fff;opacity:1;
}

/* Reduced motion */
@media(prefers-reduced-motion:reduce){
  *{animation:none!important;transition-duration:.15s!important}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RESPONSIVE BREAKPOINTS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* Very small phones */
@media(max-width:400px){
  .title{
    font-size:1.3rem;
    top:max(6vh,35px);
    letter-spacing:.35em;
    padding-left:.35em;
  }
  .controls{
    gap:.6rem;
    top:8px;
    right:8px;
  }
  .ctrl{
    font-size:1.5rem;
    padding:.4rem;
    min-width:44px;
    min-height:44px;
  }
  .circle{
    width:min(190px,50vw);
    height:min(190px,50vw);
  }
  .wisdom-area{bottom:max(9vh,55px)}
  .menu{width:92vw;padding:1.5rem}
}

/* Phones */
@media(min-width:401px) and (max-width:600px){
  .title{
    font-size:1.6rem;
    top:max(7vh,40px);
    letter-spacing:.4em;
    padding-left:.4em;
  }
  .controls{
    gap:.8rem;
    top:10px;
    right:10px;
  }
  .ctrl{
    font-size:1.6rem;
    min-width:48px;
    min-height:48px;
  }
  .circle{
    width:min(210px,52vw);
    height:min(210px,52vw);
  }
  .wisdom-area{bottom:max(10vh,60px)}
}

/* Tablets */
@media(min-width:601px) and (max-width:900px){
  .title{
    font-size:2.2rem;
    letter-spacing:.48em;
    padding-left:.48em;
  }
  .ctrl{font-size:1.9rem}
  .circle{
    width:min(260px,42vw);
    height:min(260px,42vw);
  }
}

/* Large screens / TV */
@media(min-width:1400px){
  .title{
    font-size:3.8rem;
    letter-spacing:.6em;
    padding-left:.6em;
  }
  .controls{
    gap:1.5rem;
    top:20px;
    right:25px;
  }
  .ctrl{
    font-size:2.8rem;
    padding:.8rem;
    min-width:64px;
    min-height:64px;
  }
  .circle{
    width:min(380px,28vw);
    height:min(380px,28vw);
  }
  .word{font-size:1.9rem}
  .hint{font-size:1.2rem}
  .phase{font-size:1.15rem}
  .timer{font-size:1rem}
  .wisdom{font-size:1.35rem}
  .energy{font-size:1.1rem}
  .energy-btn{font-size:1.5rem}
  .menu{width:420px;padding:2.5rem}
  .menu-item{font-size:1.2rem;padding:1.2rem 1.4rem}
  .menu h3{font-size:.9rem}
  .time-btn{font-size:1.1rem;padding:1rem}
  .toggle-row{font-size:1.2rem}
  .toggle{width:60px;height:32px}
  .toggle::after{width:22px;height:22px;top:4px;left:5px}
  .toggle.on::after{left:32px}
  .headphones-note{font-size:1rem}
}
</style>
</head>
<body>

<div class="cosmos"></div>

<div class="field">
  <h1 class="title">INNERA FIELD</h1>

  <div class="controls">
    <button class="ctrl" id="soundBtn" aria-label="Sound" aria-pressed="false" title="Sound">‚óâ</button>
    <button class="ctrl" id="contrastBtn" aria-label="High contrast" aria-pressed="false" title="Contrast">‚óê</button>
    <button class="ctrl" id="menuBtn" aria-label="Open menu" title="Menu">‚â°</button>
  </div>

  <div class="circle idle" id="circle" role="button" tabindex="0" aria-label="Breathing circle. Tap to begin.">
    <span class="word" id="word">breathe</span>
    <span class="hint" id="hint">tap to begin</span>
    <span class="phase" id="phase"></span>
    <span class="timer" id="timerDisplay"></span>
  </div>

  <div class="wisdom-area">
    <p class="wisdom" id="wisdom"></p>
    <p class="session-msg" id="sessionMsg"></p>
  </div>

  <div class="energy">
    <span>if this serves you</span>
    <a class="energy-btn" href="https://ko-fi.com/innerafield" target="_blank" rel="noopener" title="Ko-fi">‚ô°</a>
    <button class="energy-btn" id="btcBtn" title="Bitcoin">‚Çø</button>
    <button class="energy-btn" id="ethBtn" title="Ethereum">Œû</button>
  </div>

  <div class="sr" id="sr" role="status" aria-live="assertive"></div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Donation Modal -->
<div class="donate-modal" id="donateModal">
  <div class="donate-content">
    <h3 id="donateTitle">BITCOIN</h3>
    <div class="donate-qr">
      <img id="donateQR" src="" alt="QR Code">
    </div>
    <div class="donate-address" id="donateAddress" title="Click to copy"></div>
    <button class="donate-close" id="donateClose">close</button>
  </div>
</div>

<!-- Overlay -->
<div class="overlay" id="overlay"></div>

<!-- Menu - NO GREEK SYMBOLS -->
<nav class="menu" id="menu" aria-label="Settings">
  <button class="menu-close" id="menuClose" aria-label="Close menu">√ó</button>

  <h3>Journey</h3>
  <div class="menu-item selected" data-journey="heart">
    <span class="dot"></span>Heart Opening
  </div>
  <div class="menu-item" data-journey="awakening">
    <span class="dot"></span>Awakening
  </div>
  <div class="menu-item" data-journey="grounding">
    <span class="dot"></span>Grounding
  </div>
  <div class="menu-item" data-journey="unity">
    <span class="dot"></span>Unity
  </div>
  <div class="menu-item" data-journey="peace">
    <span class="dot"></span>Deep Peace
  </div>

  <div class="menu-divider"></div>

  <h3>Duration</h3>
  <div class="time-row">
    <button class="time-btn" data-time="300">5 min</button>
    <button class="time-btn selected" data-time="600">10 min</button>
    <button class="time-btn" data-time="1200">20 min</button>
    <button class="time-btn" data-time="0">‚àû</button>
  </div>

  <div class="menu-divider"></div>

  <h3>Options</h3>
  <div class="toggle-row">
    <span>Voice guidance</span>
    <div class="toggle" id="voiceToggle" role="switch" aria-checked="false"></div>
  </div>

  <div class="headphones-note">
    <span>üéß</span>
    headphones enhance the binaural experience
  </div>
</nav>

<script>
(function(){
'use strict';

const CRYPTO = {
  btc: 'bc1qwjsvjg0ckfw2aa9c5zdhc4ewxn7yse8lvstuaz',
  eth: '0x12e10C6aA1557A9B13c570c0070E223aec8dE498'
};

const JOURNEYS = {
  heart: {
    binaural: 6,
    freqs: [528, 432, 396, 417],
    wisdoms: [
      "you are worthy of love. you always have been.",
      "your heart knows the way. trust it.",
      "love is not earned. it is remembered.",
      "you are not broken. you are returning.",
      "the heart that seeks connection is already connected.",
      "every heartbeat is a prayer answered."
    ]
  },
  awakening: {
    binaural: 40,
    freqs: [741, 852, 963, 639],
    wisdoms: [
      "consciousness is not found. it is unveiled.",
      "you are not becoming aware. you are awareness itself.",
      "the truth you seek is seeking you.",
      "awakening is not an event. it is a recognition.",
      "you have always been the light you're looking for.",
      "stillness speaks louder than thought."
    ]
  },
  grounding: {
    binaural: 2,
    freqs: [285, 432, 174, 128],
    wisdoms: [
      "you are held by the earth. always.",
      "your body is your first home. return to it.",
      "presence is the anchor. breath is the chain.",
      "the ground beneath you is sacred ground.",
      "you belong here. you have always belonged.",
      "root down to rise up."
    ]
  },
  unity: {
    binaural: 10,
    freqs: [528, 639, 111, 432],
    wisdoms: [
      "separation is the illusion. oneness is the truth.",
      "you are the field. the field is you.",
      "there is no other. there is only one.",
      "peace begins when we remember we are one.",
      "every breath connects you to all beings.",
      "in unity, there is no war. only love."
    ]
  },
  peace: {
    binaural: 4,
    freqs: [432, 396, 417, 432],
    wisdoms: [
      "peace is not found. it is remembered.",
      "stillness is your nature. return to it.",
      "in the quiet, God speaks.",
      "surrender is not giving up. it is opening up.",
      "rest is not weakness. it is wisdom.",
      "the deepest peace is already within you."
    ]
  }
};

const S = {
  on: false,
  phase: 0,
  breaths: 0,
  sound: false,
  voice: false,
  journey: 'heart',
  duration: 600,
  elapsed: 0,
  timer: null,
  tickTimer: null,
  audio: null,
  osc: null,
  oscL: null,
  oscR: null,
  subOsc: null,
  gain: null,
  gainL: null,
  gainR: null,
  subGain: null,
  hasStarted: false,
  headphonesShown: false
};

try {
  const saved = localStorage.getItem('innerafield');
  if(saved){
    const p = JSON.parse(saved);
    S.journey = p.journey || 'heart';
    S.duration = p.duration ?? 600;
    S.sound = p.sound || false;
    S.voice = p.voice || false;
  }
} catch(e){}

const circle = document.getElementById('circle');
const word = document.getElementById('word');
const hint = document.getElementById('hint');
const phase = document.getElementById('phase');
const timerDisplay = document.getElementById('timerDisplay');
const wisdom = document.getElementById('wisdom');
const sessionMsg = document.getElementById('sessionMsg');
const sr = document.getElementById('sr');
const menu = document.getElementById('menu');
const overlay = document.getElementById('overlay');
const toast = document.getElementById('toast');
const donateModal = document.getElementById('donateModal');
const donateTitle = document.getElementById('donateTitle');
const donateQR = document.getElementById('donateQR');
const donateAddress = document.getElementById('donateAddress');
const donateClose = document.getElementById('donateClose');
const menuBtn = document.getElementById('menuBtn');
const menuCloseBtn = document.getElementById('menuClose');
const soundBtn = document.getElementById('soundBtn');
const contrastBtn = document.getElementById('contrastBtn');
const voiceToggle = document.getElementById('voiceToggle');
const btcBtn = document.getElementById('btcBtn');
const ethBtn = document.getElementById('ethBtn');

const phases = ['inhale','hold-in','exhale','hold-out'];
const words = ['breathe in','hold','release','rest'];
const durations = [4000,4000,4000,4000];

function savePrefs(){
  try {
    localStorage.setItem('innerafield', JSON.stringify({
      journey: S.journey,
      duration: S.duration,
      sound: S.sound,
      voice: S.voice
    }));
  } catch(e){}
}

function initAudio(){
  if(S.audio) return;
  S.audio = new (window.AudioContext||window.webkitAudioContext)();
  
  S.gain = S.audio.createGain();
  S.gain.gain.value = 0;
  S.gain.connect(S.audio.destination);
  
  S.gainL = S.audio.createGain();
  S.gainR = S.audio.createGain();
  S.gainL.gain.value = 0;
  S.gainR.gain.value = 0;
  
  const merger = S.audio.createChannelMerger(2);
  S.gainL.connect(merger, 0, 0);
  S.gainR.connect(merger, 0, 1);
  merger.connect(S.audio.destination);
  
  S.subGain = S.audio.createGain();
  S.subGain.gain.value = 0;
  S.subGain.connect(S.audio.destination);
}

function playFreq(hz){
  if(!S.audio) return;
  if(S.osc){
    S.osc.frequency.setTargetAtTime(hz, S.audio.currentTime, 0.6);
  } else {
    S.osc = S.audio.createOscillator();
    S.osc.type = 'sine';
    S.osc.frequency.value = hz;
    S.osc.connect(S.gain);
    S.osc.start();
  }
  S.gain.gain.setTargetAtTime(0.05, S.audio.currentTime, 0.4);
}

function playBinaural(beatHz){
  if(!S.audio) return;
  const baseHz = 200;
  
  if(!S.oscL){
    S.oscL = S.audio.createOscillator();
    S.oscL.type = 'sine';
    S.oscL.connect(S.gainL);
    S.oscL.start();
  }
  S.oscL.frequency.setTargetAtTime(baseHz, S.audio.currentTime, 0.3);
  
  if(!S.oscR){
    S.oscR = S.audio.createOscillator();
    S.oscR.type = 'sine';
    S.oscR.connect(S.gainR);
    S.oscR.start();
  }
  S.oscR.frequency.setTargetAtTime(baseHz + beatHz, S.audio.currentTime, 0.3);
  
  S.gainL.gain.setTargetAtTime(0.04, S.audio.currentTime, 0.5);
  S.gainR.gain.setTargetAtTime(0.04, S.audio.currentTime, 0.5);
}

function playSubBass(){
  if(!S.audio) return;
  if(!S.subOsc){
    S.subOsc = S.audio.createOscillator();
    S.subOsc.type = 'sine';
    S.subOsc.frequency.value = 50;
    S.subOsc.connect(S.subGain);
    S.subOsc.start();
  }
  S.subGain.gain.setTargetAtTime(0.15, S.audio.currentTime, 0.5);
}

function stopAudio(){
  if(S.gain) S.gain.gain.setTargetAtTime(0, S.audio.currentTime, 0.4);
  if(S.gainL) S.gainL.gain.setTargetAtTime(0, S.audio.currentTime, 0.4);
  if(S.gainR) S.gainR.gain.setTargetAtTime(0, S.audio.currentTime, 0.4);
  if(S.subGain) S.subGain.gain.setTargetAtTime(0, S.audio.currentTime, 0.4);
}

function speak(text){
  if(!S.voice || !window.speechSynthesis) return;
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.rate = 0.75;
  u.pitch = 0.85;
  u.volume = 0.6;
  speechSynthesis.speak(u);
}

function showToast(msg, icon = ''){
  toast.innerHTML = icon ? '<div class="icon">' + icon + '</div>' + msg : msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

function setPhase(i){
  S.phase = i;
  const p = phases[i];
  const journey = JOURNEYS[S.journey];
  
  circle.className = 'circle breathing ' + p;
  word.textContent = words[i];
  phase.textContent = p.replace('-in',' in').replace('-out',' out');
  sr.textContent = words[i];
  
  speak(words[i]);
  
  if(S.sound && S.audio){
    playFreq(journey.freqs[i]);
  }
  
  if(i === 2) S.breaths++;
}

function next(){
  const n = (S.phase + 1) % 4;
  setPhase(n);
  S.timer = setTimeout(next, durations[n]);
}

function updateTimer(){
  if(!S.on) return;
  S.elapsed++;
  
  if(S.duration > 0){
    const remaining = S.duration - S.elapsed;
    if(remaining <= 0){
      stop();
      return;
    }
    const min = Math.floor(remaining / 60);
    const sec = remaining % 60;
    timerDisplay.textContent = min + ':' + (sec < 10 ? '0' : '') + sec;
  } else {
    timerDisplay.textContent = 'breath ' + S.breaths;
  }
  
  S.tickTimer = setTimeout(updateTimer, 1000);
}

// FIXED: Smooth start animation
function start(){
  if(S.on) return;
  S.on = true;
  S.breaths = 0;
  S.elapsed = 0;
  S.hasStarted = true;
  
  const journey = JOURNEYS[S.journey];
  
  document.body.classList.add('active');
  sessionMsg.classList.remove('show');
  sessionMsg.innerHTML = '';
  hint.style.display = 'none';
  
  wisdom.textContent = journey.wisdoms[Math.floor(Math.random() * journey.wisdoms.length)];
  
  // Remove idle, add starting for smooth entry
  circle.classList.remove('idle');
  circle.classList.add('starting');
  
  if(S.sound){
    initAudio();
    if(S.audio.state === 'suspended') S.audio.resume();
    playBinaural(journey.binaural);
    playSubBass();
  }
  
  // Smooth entry then start breathing
  setTimeout(() => {
    circle.classList.remove('starting');
    setPhase(0);
    S.timer = setTimeout(next, durations[0]);
    updateTimer();
  }, 400);
  
  sr.textContent = 'Breathing started.';
}

function stop(){
  if(!S.on) return;
  S.on = false;
  
  document.body.classList.remove('active');
  
  clearTimeout(S.timer);
  clearTimeout(S.tickTimer);
  S.timer = null;
  S.tickTimer = null;
  
  circle.className = 'circle idle';
  word.textContent = 'breathe';
  phase.textContent = '';
  timerDisplay.textContent = '';
  
  stopAudio();
  
  sessionMsg.innerHTML = '<span class="count">‚úß ' + S.breaths + ' breaths with Source ‚úß</span><br>return when you forget.';
  sessionMsg.classList.add('show');
  
  setTimeout(() => {
    sessionMsg.classList.remove('show');
    wisdom.textContent = '';
  }, 6000);
  
  sr.textContent = S.breaths + ' breaths complete. You are infinite.';
}

function toggle(){
  S.on ? stop() : start();
}

function openMenu(){
  menu.classList.add('open');
  overlay.classList.add('show');
}

function closeMenu(){
  menu.classList.remove('open');
  overlay.classList.remove('show');
}

function initMenuState(){
  document.querySelectorAll('[data-journey]').forEach(el => {
    el.classList.toggle('selected', el.dataset.journey === S.journey);
  });
  document.querySelectorAll('[data-time]').forEach(el => {
    el.classList.toggle('selected', parseInt(el.dataset.time) === S.duration);
  });
  soundBtn.classList.toggle('on', S.sound);
  soundBtn.setAttribute('aria-pressed', S.sound);
  voiceToggle.classList.toggle('on', S.voice);
  voiceToggle.setAttribute('aria-checked', S.voice);
}

document.querySelectorAll('[data-journey]').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('[data-journey]').forEach(e => e.classList.remove('selected'));
    el.classList.add('selected');
    S.journey = el.dataset.journey;
    savePrefs();
  });
});

document.querySelectorAll('[data-time]').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('[data-time]').forEach(e => e.classList.remove('selected'));
    el.classList.add('selected');
    S.duration = parseInt(el.dataset.time);
    savePrefs();
  });
});

voiceToggle.addEventListener('click', () => {
  S.voice = !S.voice;
  voiceToggle.classList.toggle('on', S.voice);
  voiceToggle.setAttribute('aria-checked', S.voice);
  savePrefs();
});

menuBtn.addEventListener('click', openMenu);
menuCloseBtn.addEventListener('click', closeMenu);
overlay.addEventListener('click', () => {
  closeMenu();
  closeDonateModal();
});

soundBtn.addEventListener('click', () => {
  S.sound = !S.sound;
  soundBtn.classList.toggle('on', S.sound);
  soundBtn.setAttribute('aria-pressed', S.sound);
  savePrefs();
  
  if(S.sound){
    if(!S.headphonesShown){
      showToast('headphones enhance<br>the binaural experience', 'üéß');
      S.headphonesShown = true;
    }
    
    if(S.on){
      initAudio();
      if(S.audio.state === 'suspended') S.audio.resume();
      const journey = JOURNEYS[S.journey];
      playFreq(journey.freqs[S.phase]);
      playBinaural(journey.binaural);
      playSubBass();
    }
  } else {
    stopAudio();
  }
});

contrastBtn.addEventListener('click', () => {
  document.body.classList.toggle('contrast');
  const on = document.body.classList.contains('contrast');
  contrastBtn.classList.toggle('on', on);
  contrastBtn.setAttribute('aria-pressed', on);
});

function copyToClipboard(text){
  navigator.clipboard.writeText(text).then(() => {
    showToast('address copied ‚úì');
  }).catch(() => {
    showToast('copy failed');
  });
}

function showDonateModal(type){
  const addr = type === 'btc' ? CRYPTO.btc : CRYPTO.eth;
  const name = type === 'btc' ? 'BITCOIN' : 'ETHEREUM';
  
  donateTitle.textContent = name;
  donateAddress.textContent = addr;
  donateQR.src = 'https://api.qrserver.com/v1/create-qr-code/?size=170x170&data=' + encodeURIComponent(addr);
  
  donateModal.classList.add('show');
}

function closeDonateModal(){
  donateModal.classList.remove('show');
}

btcBtn.addEventListener('click', () => showDonateModal('btc'));
ethBtn.addEventListener('click', () => showDonateModal('eth'));
donateClose.addEventListener('click', closeDonateModal);
donateAddress.addEventListener('click', () => copyToClipboard(donateAddress.textContent));

circle.addEventListener('click', toggle);
circle.addEventListener('keydown', e => {
  if(e.key === 'Enter' || e.key === ' '){
    e.preventDefault();
    toggle();
  }
});

document.addEventListener('keydown', e => {
  if(e.key === ' ' && document.activeElement === document.body){
    e.preventDefault();
    toggle();
  }
  if(e.key === 'Escape'){
    if(donateModal.classList.contains('show')){
      closeDonateModal();
    } else if(menu.classList.contains('open')){
      closeMenu();
    } else if(S.on){
      stop();
    }
  }
});

setTimeout(() => {
  if(!S.hasStarted && hint) hint.style.opacity = '0';
}, 8000);

initMenuState();

if(window.matchMedia('(prefers-contrast:more)').matches){
  document.body.classList.add('contrast');
  contrastBtn.classList.add('on');
  contrastBtn.setAttribute('aria-pressed', 'true');
}

})();
</script>

</body>
</html>
