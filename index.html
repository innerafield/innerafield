<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Universal portal for all consciousness. Breathe. Connect. Remember you are infinite.">
    <meta name="theme-color" content="#000000">
    <title>Innera Field</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #000; --text: #fff; --dim: rgba(255,255,255,0.65);
            --glass: rgba(255,255,255,0.05); --border: rgba(255,255,255,0.12);
            --pink: rgba(255,20,147,0.5); --blue: rgba(0,191,255,0.5); --purple: rgba(138,43,226,0.4);
        }

        body.light {
            --bg: #f8f9fa; --text: #1a1a1a; --dim: rgba(0,0,0,0.65);
            --glass: rgba(0,0,0,0.03); --border: rgba(0,0,0,0.08);
        }

        body.contrast {
            --bg: #000; --text: #fff; --dim: #fff;
            --glass: rgba(255,255,255,0.15); --border: rgba(255,255,255,0.4);
        }

        body.eyes-closed {
            --bg: #000 !important; --text: #222 !important;
        }

        body.eyes-closed * { opacity: 0.05 !important; transition: opacity 1s; }
        body.eyes-closed #canvas, body.eyes-closed .glow { opacity: 0 !important; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg); color: var(--text);
            min-height: 100vh; overflow-x: hidden;
            transition: background 0.5s, color 0.5s;
        }

        #canvas { position: fixed; inset: 0; z-index: 0; transition: opacity 0.5s; }
        .glow {
            position: fixed; inset: 0; z-index: 1; pointer-events: none;
            background: radial-gradient(circle at 50% 0%, var(--pink), transparent 50%),
                        radial-gradient(circle at 50% 100%, var(--blue), transparent 50%);
            opacity: 0.25; animation: breatheGlow 8s ease-in-out infinite;
            transition: opacity 0.5s;
        }
        @keyframes breatheGlow { 0%, 100% { opacity: 0.25; } 50% { opacity: 0.4; } }

        .topbar {
            position: fixed; top: 0; left: 0; right: 0; height: 60px; z-index: 1000;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: center; align-items: center;
            gap: 0.8rem; padding: 0 1rem; flex-wrap: wrap;
        }
        body.light .topbar { background: rgba(255,255,255,0.7); }

        .container {
            position: relative; z-index: 2; max-width: 900px; margin: 0 auto;
            padding: 80px 2rem 250px 2rem; display: flex; flex-direction: column; align-items: center;
        }

        .brand {
            font-size: clamp(3rem, 8vw, 6rem); font-weight: 700; letter-spacing: 0.5em;
            text-align: center; margin-bottom: 2rem;
            background: linear-gradient(135deg, #ff1493, #00bfff, #8a2be2);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; filter: drop-shadow(0 0 40px rgba(255,20,147,0.4));
            animation: fadeIn 1s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .session-info {
            font-size: 0.9rem; color: var(--dim); margin-bottom: 2rem; text-align: center;
            animation: fadeIn 1.5s ease 0.3s both;
        }

        .presets {
            display: flex; gap: 0.8rem; margin-bottom: 2rem; flex-wrap: wrap; justify-content: center;
            animation: fadeIn 1.5s ease 0.5s both;
        }
        .preset { font-size: 0.85rem; padding: 0.6rem 1.2rem; }
        .preset.active { background: rgba(255,20,147,0.2); border-color: var(--pink); }

        .breath-section { width: 100%; display: flex; flex-direction: column; align-items: center; margin: 2rem 0; }
        
        .circle-container { position: relative; width: 280px; height: 280px; }
        
        .progress-ring {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            transform: rotate(-90deg);
        }
        .progress-ring circle {
            fill: none; stroke: var(--pink); stroke-width: 3;
            stroke-dasharray: 880; stroke-dashoffset: 880;
            transition: stroke-dashoffset 4s linear;
        }
        
        .circle {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 260px; height: 260px; border: 3px solid var(--border); border-radius: 50%;
            background: var(--glass); backdrop-filter: blur(20px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 80px var(--pink), inset 0 0 80px var(--purple);
            transition: transform 4s cubic-bezier(0.4,0,0.2,1), box-shadow 4s cubic-bezier(0.4,0,0.2,1);
        }
        .circle:hover { transform: translate(-50%, -50%) scale(1.02); }
        .circle.in { transform: translate(-50%, -50%) scale(1.3); box-shadow: 0 0 120px var(--pink), inset 0 0 100px var(--purple); }
        .circle.out { transform: translate(-50%, -50%) scale(0.85); box-shadow: 0 0 50px var(--pink), inset 0 0 60px var(--purple); }

        .circle-label { font-size: 1.5rem; font-weight: 300; letter-spacing: 0.4em; opacity: 0.7; }
        .breath-count { font-size: 0.85rem; color: var(--dim); margin-top: 0.5rem; }

        .timer {
            margin-top: 2.5rem; font-size: 3.5rem; font-weight: 300;
            font-variant-numeric: tabular-nums; text-align: center;
            opacity: 0; transition: opacity 0.5s;
        }
        .timer.show { opacity: 1; }

        .wisdom {
            width: 100%; max-width: 650px; text-align: center;
            font-size: 1.2rem; font-weight: 300; line-height: 1.9; color: var(--dim);
            margin: 4rem 0; padding: 2.5rem;
            background: var(--glass); border: 1px solid var(--border);
            border-radius: 24px; backdrop-filter: blur(20px);
            animation: fadeIn 1.5s ease 0.3s both;
        }

        .frequencies {
            width: 100%; display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem; margin: 3rem 0;
            animation: fadeIn 1.5s ease 0.6s both;
        }
        .freq {
            background: var(--glass); border: 1px solid var(--border);
            border-radius: 20px; padding: 2.5rem 1.5rem; text-align: center;
            cursor: pointer; backdrop-filter: blur(20px); transition: all 0.3s;
        }
        .freq:hover {
            background: rgba(255,255,255,0.08); transform: translateY(-4px);
            box-shadow: 0 12px 40px var(--purple); border-color: var(--pink);
        }
        .freq.active {
            background: rgba(255,20,147,0.12); border-color: var(--pink);
            box-shadow: 0 0 30px var(--pink);
        }
        .freq h3 { font-size: 1.4rem; font-weight: 500; letter-spacing: 0.03em; }

        .donate {
            width: 100%; max-width: 600px; text-align: center;
            margin: 5rem 0 2rem 0; padding: 2.5rem;
            background: var(--glass); border: 1px solid var(--border);
            border-radius: 24px; backdrop-filter: blur(20px);
            animation: fadeIn 1.5s ease 0.9s both;
        }
        .donate h3 { font-size: 1.3rem; font-weight: 500; margin-bottom: 1rem; letter-spacing: 0.08em; }
        .donate p { color: var(--dim); line-height: 1.7; margin-bottom: 1.5rem; font-size: 0.95rem; }
        .donate-options { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 1.5rem; }
        .crypto-address {
            background: rgba(0,0,0,0.3); padding: 0.8rem; border-radius: 12px;
            font-size: 0.75rem; font-family: monospace; word-break: break-all;
            margin: 0.5rem 0; cursor: pointer; transition: all 0.3s;
        }
        .crypto-address:hover { background: rgba(255,20,147,0.2); }

        .btn {
            background: var(--glass); border: 1px solid var(--border); color: var(--text);
            padding: 0.75rem 1.5rem; border-radius: 50px;
            font-family: 'Inter', sans-serif; font-size: 0.9rem; font-weight: 500;
            letter-spacing: 0.02em; cursor: pointer; backdrop-filter: blur(20px);
            transition: all 0.3s;
        }
        .btn:hover {
            background: rgba(255,20,147,0.15); border-color: var(--pink);
            transform: translateY(-2px); box-shadow: 0 8px 25px var(--pink);
        }
        .btn.active { background: rgba(255,20,147,0.2); border-color: var(--pink); }

        .btn-primary {
            background: linear-gradient(135deg, var(--pink), var(--blue));
            border: none; color: white; padding: 1.1rem 3rem; font-size: 1.1rem;
            box-shadow: 0 10px 40px rgba(255,20,147,0.3);
        }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 50px rgba(255,20,147,0.4); }

        .bottombar {
            position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000;
            background: transparent;
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--border); padding: 1.5rem;
            display: flex; flex-direction: column; align-items: center; gap: 1rem;
        }

        .actions { display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; }

        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.93);
            backdrop-filter: blur(12px); z-index: 2000; display: none;
            align-items: center; justify-content: center; padding: 2rem;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: rgba(15,15,30,0.95); border: 2px solid var(--pink);
            border-radius: 28px; padding: 3rem; max-width: 500px; width: 100%;
            box-shadow: 0 0 80px var(--pink); animation: slideUp 0.4s ease;
            position: relative; max-height: 80vh; overflow-y: auto;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        .modal-content h2 {
            color: white; font-size: 2rem; font-weight: 600;
            margin-bottom: 1.5rem; letter-spacing: 0.03em;
        }
        .modal-content p { color: rgba(255,255,255,0.75); line-height: 1.7; margin-bottom: 1.5rem; }
        .close {
            position: absolute; top: 1.5rem; right: 1.5rem;
            background: none; border: none; color: white;
            font-size: 2.5rem; cursor: pointer; opacity: 0.5;
            transition: opacity 0.3s; padding: 0; line-height: 1;
        }
        .close:hover { opacity: 1; }

        textarea {
            width: 100%; min-height: 130px;
            background: rgba(0,0,0,0.4); border: 1px solid var(--border);
            border-radius: 16px; padding: 1.2rem; color: white;
            font-family: 'Inter', sans-serif; font-size: 1rem; resize: vertical;
            margin-bottom: 1.5rem;
        }
        textarea:focus {
            outline: none; border-color: var(--pink);
            box-shadow: 0 0 20px rgba(255,20,147,0.2);
        }

        canvas#preview { display: none; }
        .preview img {
            width: 100%; border-radius: 16px; margin: 1rem 0;
            box-shadow: 0 0 40px var(--pink);
        }

        .sound-options {
            display: flex; flex-direction: column; gap: 1rem; margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .brand { letter-spacing: 0.3em; margin-bottom: 2rem; }
            .circle-container { width: 240px; height: 240px; }
            .circle { width: 220px; height: 220px; }
            .timer { font-size: 2.8rem; }
            .frequencies { grid-template-columns: 1fr; gap: 1rem; max-width: 320px; }
            .btn-primary { padding: 1rem 2.5rem; }
            .container { padding-bottom: 280px; }
            .presets { font-size: 0.8rem; }
        }

        @media (max-width: 480px) {
            .circle-container { width: 200px; height: 200px; }
            .circle { width: 180px; height: 180px; }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
        }

        body.no-motion * { 
            animation: none !important; 
            transition: opacity 0.3s, transform 0.3s, background 0.3s, color 0.3s, border 0.3s !important; 
        }
        body.no-motion .circle { transition: transform 4s cubic-bezier(0.4,0,0.2,1) !important; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="glow"></div>

    <!-- TOP BAR -->
    <div class="topbar">
        <button class="btn" id="themeBtn" title="Toggle light/dark theme">‚òÄÔ∏è Light</button>
        <button class="btn" id="contrastBtn" title="High contrast mode">‚óê Contrast</button>
        <button class="btn" id="textBtn" title="Larger text">A+ Text</button>
        <button class="btn" id="readerBtn" title="Reader mode - screen reader optimized">üìñ Reader</button>
        <button class="btn" id="motionBtn" title="Reduce motion">‚è∏Ô∏è Motion</button>
        <button class="btn" id="eyesBtn" title="Close eyes mode - screen goes dark">üëÅÔ∏è Eyes Closed</button>
    </div>

    <!-- MAIN -->
    <div class="container">
        <h1 class="brand">INNERA FIELD</h1>

        <div class="session-info" id="sessionInfo">Welcome, infinite being</div>

        <!-- PRESET TIMERS -->
        <div class="presets">
            <button class="btn preset" data-time="300">5 min</button>
            <button class="btn preset" data-time="600">10 min</button>
            <button class="btn preset" data-time="1200">20 min</button>
            <button class="btn preset active" data-time="0">‚àû</button>
        </div>

        <!-- BREATHING -->
        <div class="breath-section">
            <div class="circle-container">
                <svg class="progress-ring" viewBox="0 0 280 280">
                    <circle id="progressCircle" cx="140" cy="140" r="140"></circle>
                </svg>
                <div class="circle" id="circle" tabindex="0" role="button" 
                     aria-label="Breathing circle - click to begin 4-4-4-4 breathing">
                    <span class="circle-label" id="label">BREATHE</span>
                    <span class="breath-count" id="breathCount"></span>
                </div>
            </div>
            <div class="timer" id="timer">00:00</div>
        </div>

        <!-- WISDOM -->
        <div class="wisdom" id="wisdom">
            You are not broken. You are infinite. You are the bridge between form and formless.
        </div>

        <!-- FREQUENCIES -->
        <div class="frequencies">
            <div class="freq" data-freq="528" tabindex="0"><h3>Healing</h3></div>
            <div class="freq" data-freq="432" tabindex="0"><h3>Peace</h3></div>
            <div class="freq" data-freq="396" tabindex="0"><h3>Liberation</h3></div>
            <div class="freq" data-freq="639" tabindex="0"><h3>Connection</h3></div>
            <div class="freq" data-freq="963" tabindex="0"><h3>Awakening</h3></div>
            <div class="freq" data-freq="7.83" tabindex="0"><h3>Earth</h3></div>
        </div>

        <!-- DONATION -->
        <div class="donate">
            <h3>‚ú® Energy Exchange</h3>
            <p>Innera Field is free forever, for all beings. If it has served you, pass it forward.</p>
            
            <div class="donate-options">
                <button class="btn-primary" onclick="window.open('https://ko-fi.com/innerafield','_blank')">
                    Ko-fi (Easy) ‚òï
                </button>
                <button class="btn" id="cryptoBtn">üîê Crypto (Direct)</button>
            </div>
        </div>
    </div>

    <!-- BOTTOM BAR -->
    <div class="bottombar">
        <button class="btn-primary" id="peace">üïäÔ∏è Peace Now</button>
        <div class="actions">
            <button class="btn" id="soundBtn">üéµ Ambient</button>
            <button class="btn" id="vibrateBtn">üì≥ Vibrate</button>
            <button class="btn" id="intentionBtn">üí´ Intention</button>
            <button class="btn" id="shareBtn">üì∏ Share</button>
            <button class="btn" id="stopBtn">‚èπÔ∏è Stop</button>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal" id="intentionModal">
        <div class="modal-content">
            <button class="close" onclick="closeModal('intentionModal')">√ó</button>
            <h2>Set Your Intention</h2>
            <p>What do you wish to call into being?</p>
            <textarea id="intentionText" placeholder="I intend to..." aria-label="Your intention"></textarea>
            <button class="btn-primary" style="width: 100%;" id="releaseBtn">Release to Source ‚ú®</button>
        </div>
    </div>

    <div class="modal" id="shareModal">
        <div class="modal-content">
            <button class="close" onclick="closeModal('shareModal')">√ó</button>
            <h2>Share Your Moment</h2>
            <canvas id="preview" width="1200" height="630"></canvas>
            <div class="preview" id="previewContainer"></div>
            <button class="btn-primary" style="width: 100%;" id="downloadBtn">Download üíæ</button>
        </div>
    </div>

    <div class="modal" id="soundModal">
        <div class="modal-content">
            <button class="close" onclick="closeModal('soundModal')">√ó</button>
            <h2>Ambient Sound</h2>
            <p>Choose a sound to accompany your practice:</p>
            <div class="sound-options">
                <button class="btn" data-sound="rain">üåßÔ∏è Rain</button>
                <button class="btn" data-sound="ocean">üåä Ocean</button>
                <button class="btn" data-sound="earth">üåç Earth (7.83Hz)</button>
                <button class="btn" data-sound="off">üîá Off</button>
            </div>
        </div>
    </div>

    <div class="modal" id="cryptoModal">
        <div class="modal-content">
            <button class="close" onclick="closeModal('cryptoModal')">√ó</button>
            <h2>Direct Crypto Donation</h2>
            <p style="font-size: 0.85rem; opacity: 0.8;">100% reaches creator. No middleman. Click to copy address:</p>
            
            <div style="margin: 1.5rem 0;">
                <p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Ethereum (ETH):</p>
                <div class="crypto-address" onclick="copyAddress(this)" title="Click to copy">
                    0x12e10C6aA1557A9B13c570c0070E223aec8dE498
                </div>
            </div>
            
            <div style="margin: 1.5rem 0;">
                <p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Bitcoin (BTC):</p>
                <div class="crypto-address" onclick="copyAddress(this)" title="Click to copy">
                    bc1qwjsvjg0ckfw2aa9c5zdhc4ewxn7yse8lvstuaz
                </div>
            </div>
            
            <p style="font-size: 0.75rem; opacity: 0.6; margin-top: 1rem;">
                Direct to creator. Zero fees. Decentralized. Thank you. üôè
            </p>
        </div>
    </div>

    <script>
        // === SESSION MEMORY ===
        let visits = parseInt(localStorage.getItem('innerafield_visits') || '0') + 1;
        localStorage.setItem('innerafield_visits', visits);
        if (visits > 1) {
            document.getElementById('sessionInfo').textContent = 
                `Welcome back ¬∑ ${visits} ${visits === 1 ? 'visit' : 'visits'}`;
        }

        // === WISDOM ===
        const wisdom = [
            "You are not broken. You are infinite. You are the bridge between form and formless.",
            "You are the universe experiencing itself in human form.",
            "Separation is the grand illusion. You have never been apart from Source.",
            "Every breath is a conversation with infinity.",
            "Light does not fight darkness. It simply shines.",
            "The present moment is the only portal to eternity.",
            "Love is not an emotion. It is the fundamental frequency of existence.",
            "Stillness is not the absence of movement. It is the presence of everything.",
            "Forgiveness is not for the other. It is the key to your own freedom.",
            "You are both the wave and the ocean.",
            "Your consciousness is the universe becoming aware of itself.",
            "Peace is not found. It is uncovered by letting go of what blocks it.",
            "You are not a drop in the ocean. You are the entire ocean in a drop.",
            "What you seek is seeking you.",
            "Connection to Source is not earned. It is your birthright.",
            "You are consciousness temporarily focused through a human lens."
        ];
        document.getElementById('wisdom').textContent = wisdom[new Date().getDate() % wisdom.length];

        // === STATE ===
        let audio, osc, gain, ambientOsc, ambientGain, timer, breathing = false, playing = false;
        let start = null, presetTime = 0, breathCount = 0, vibrateEnabled = false;

        // === AUDIO ===
        function init() {
            if (!audio) {
                audio = new (window.AudioContext || window.webkitAudioContext)();
                gain = audio.createGain();
                gain.gain.value = 0.07;
                gain.connect(audio.destination);
                
                ambientGain = audio.createGain();
                ambientGain.gain.value = 0.03;
                ambientGain.connect(audio.destination);
            }
        }

        function play(freq) {
            init();
            stop();
            if (freq === 0) { startTimer(); return; }
            osc = audio.createOscillator();
            osc.frequency.value = freq;
            osc.connect(gain);
            osc.start();
            playing = true;
            startTimer();
            if (vibrateEnabled && 'vibrate' in navigator) {
                navigator.vibrate([200, 100, 200]);
            }
        }

        function playAmbient(type) {
            stopAmbient();
            if (type === 'off') return;
            
            init();
            ambientOsc = audio.createOscillator();
            
            if (type === 'rain') {
                ambientOsc.frequency.value = 100;
                ambientOsc.type = 'sine';
            } else if (type === 'ocean') {
                ambientOsc.frequency.value = 60;
                ambientOsc.type = 'sine';
            } else if (type === 'earth') {
                ambientOsc.frequency.value = 7.83; // Schumann Resonance
                ambientOsc.type = 'sine';
            }
            
            ambientOsc.connect(ambientGain);
            ambientOsc.start();
        }

        function stopAmbient() {
            if (ambientOsc) {
                ambientOsc.stop();
                ambientOsc.disconnect();
                ambientOsc = null;
            }
        }

        function stop() {
            if (osc) { osc.stop(); osc.disconnect(); osc = null; }
            playing = false;
            breathing = false;
            breathCount = 0;
            stopTimer();
            document.querySelectorAll('.freq').forEach(f => f.classList.remove('active'));
            document.getElementById('label').textContent = 'BREATHE';
            document.getElementById('breathCount').textContent = '';
            document.getElementById('circle').className = 'circle';
            document.getElementById('progressCircle').style.strokeDashoffset = 880;
        }

        // === TIMER ===
        function startTimer() {
            if (timer) return;
            start = Date.now();
            document.getElementById('timer').classList.add('show');
            timer = setInterval(() => {
                const s = Math.floor((Date.now() - start) / 1000);
                document.getElementById('timer').textContent = 
                    `${String(Math.floor(s / 60)).padStart(2, '0')}:${String(s % 60).padStart(2, '0')}`;
                
                if (presetTime > 0 && s >= presetTime) {
                    stop();
                    alert('üôè Session complete. You are infinite.');
                }
            }, 1000);
        }

        function stopTimer() {
            if (timer) { clearInterval(timer); timer = null; }
            document.getElementById('timer').classList.remove('show');
            document.getElementById('timer').textContent = '00:00';
            start = null;
        }

        // === BREATHING ===
        function breathe() {
            breathing = !breathing;
            const circle = document.getElementById('circle');
            const label = document.getElementById('label');
            const counter = document.getElementById('breathCount');
            const progress = document.getElementById('progressCircle');
            
            if (!breathing) {
                label.textContent = 'BREATHE';
                counter.textContent = '';
                circle.className = 'circle';
                progress.style.strokeDashoffset = 880;
                breathCount = 0;
                return;
            }

            const phases = [
                { text: 'INHALE', cls: 'in' },
                { text: 'HOLD', cls: 'in' },
                { text: 'EXHALE', cls: 'out' },
                { text: 'HOLD', cls: 'out' }
            ];
            
            let i = 0;
            function cycle() {
                if (!breathing) return;
                
                if (i === 0) breathCount++;
                
                label.textContent = phases[i].text;
                counter.textContent = `Breath ${breathCount} of ‚àû`;
                circle.className = 'circle ' + phases[i].cls;
                
                // Progress ring animation
                progress.style.strokeDashoffset = 880;
                setTimeout(() => {
                    progress.style.strokeDashoffset = 0;
                }, 50);
                
                if (vibrateEnabled && 'vibrate' in navigator) {
                    navigator.vibrate(100);
                }
                
                i = (i + 1) % phases.length;
                setTimeout(cycle, 4000);
            }
            cycle();
        }

        // === PARTICLES ===
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        for (let i = 0; i < 80; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 0.3,
                vy: (Math.random() - 0.5) * 0.3,
                r: Math.random() * 2 + 0.5,
                c: Math.random() > 0.5 ? 'rgba(255,20,147,0.4)' : 'rgba(0,191,255,0.4)'
            });
        }

        function draw() {
            ctx.fillStyle = 'rgba(0,0,0,0.04)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            particles.forEach(p => {
                p.x += p.vx; p.y += p.vy;
                if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                ctx.fillStyle = p.c;
                ctx.fill();
            });

            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const dx = particles[i].x - particles[j].x;
                    const dy = particles[i].y - particles[j].y;
                    const d = Math.sqrt(dx * dx + dy * dy);
                    if (d < 100) {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(255,20,147,${0.1 * (1 - d / 100)})`;
                        ctx.lineWidth = 0.5;
                        ctx.moveTo(particles[i].x, particles[i].y);
                        ctx.lineTo(particles[j].x, particles[j].y);
                        ctx.stroke();
                    }
                }
            }
            requestAnimationFrame(draw);
        }
        draw();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // === EVENTS ===
        document.getElementById('circle').addEventListener('click', breathe);

        document.querySelectorAll('.freq').forEach(f => {
            f.addEventListener('click', function() {
                const freq = parseFloat(this.dataset.freq);
                document.querySelectorAll('.freq').forEach(x => x.classList.remove('active'));
                this.classList.add('active');
                play(freq);
                
                // Auto-start breathing animation
                if (!breathing) {
                    breathe();
                }
            });
        });

        document.querySelectorAll('.preset').forEach(p => {
            p.addEventListener('click', function() {
                presetTime = parseInt(this.dataset.time);
                document.querySelectorAll('.preset').forEach(x => x.classList.remove('active'));
                this.classList.add('active');
            });
        });

        document.getElementById('peace').addEventListener('click', () => {
            play(432);
            document.querySelector('.glow').style.opacity = '0.6';
            setTimeout(() => document.querySelector('.glow').style.opacity = '0.25', 5000);
            
            // Auto-start breathing animation
            if (!breathing) {
                breathe();
            }
        });

        document.getElementById('stopBtn').addEventListener('click', stop);

        // ACCESSIBILITY
        document.getElementById('themeBtn').addEventListener('click', function() {
            document.body.classList.remove('contrast');
            document.body.classList.toggle('light');
            this.textContent = document.body.classList.contains('light') ? 'üåô Dark' : '‚òÄÔ∏è Light';
        });

        document.getElementById('contrastBtn').addEventListener('click', function() {
            document.body.classList.remove('light');
            document.body.classList.toggle('contrast');
            this.classList.toggle('active');
        });

        document.getElementById('textBtn').addEventListener('click', function() {
            const s = parseFloat(getComputedStyle(document.documentElement).fontSize);
            document.documentElement.style.fontSize = (s === 16 ? 20 : 16) + 'px';
            this.classList.toggle('active');
        });

        document.getElementById('motionBtn').addEventListener('click', function() {
            document.body.classList.toggle('no-motion');
            this.classList.toggle('active');
            
            // Also hide canvas particles for reduced motion
            const canvas = document.getElementById('canvas');
            const glow = document.querySelector('.glow');
            if (document.body.classList.contains('no-motion')) {
                canvas.style.display = 'none';
                glow.style.display = 'none';
            } else {
                canvas.style.display = 'block';
                glow.style.display = 'block';
            }
        });

        document.getElementById('readerBtn').addEventListener('click', function() {
            const canvas = document.getElementById('canvas');
            const glow = document.querySelector('.glow');
            const isReaderMode = canvas.style.opacity === '0';
            
            if (!isReaderMode) {
                canvas.style.opacity = '0';
                glow.style.opacity = '0';
                this.classList.add('active');
            } else {
                canvas.style.opacity = '1';
                glow.style.opacity = '0.25';
                this.classList.remove('active');
            }
        });

        document.getElementById('eyesBtn').addEventListener('click', function() {
            const isClosing = !document.body.classList.contains('eyes-closed');
            document.body.classList.toggle('eyes-closed');
            this.textContent = document.body.classList.contains('eyes-closed') ? 'üëÅÔ∏è Open Eyes' : 'üëÅÔ∏è Eyes Closed';
            
            if (isClosing) {
                // Show brief instruction
                const msg = document.createElement('div');
                msg.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:1.2rem;opacity:1;z-index:9999;text-align:center;padding:2rem;background:rgba(0,0,0,0.9);border-radius:20px;border:1px solid rgba(255,20,147,0.3);';
                msg.textContent = 'Press ESC or click anywhere to open eyes';
                document.body.appendChild(msg);
                setTimeout(() => {
                    msg.style.transition = 'opacity 2s';
                    msg.style.opacity = '0';
                    setTimeout(() => msg.remove(), 2000);
                }, 2000);
            }
        });
        
        // Exit eyes-closed mode with ESC or click
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.body.classList.contains('eyes-closed')) {
                document.body.classList.remove('eyes-closed');
                document.getElementById('eyesBtn').textContent = 'üëÅÔ∏è Eyes Closed';
            }
        });
        
        document.addEventListener('click', function(e) {
            if (document.body.classList.contains('eyes-closed') && 
                !e.target.closest('.topbar') && 
                !e.target.closest('.bottombar')) {
                document.body.classList.remove('eyes-closed');
                document.getElementById('eyesBtn').textContent = 'üëÅÔ∏è Eyes Closed';
            }
        });

        document.getElementById('vibrateBtn').addEventListener('click', function() {
            vibrateEnabled = !vibrateEnabled;
            this.classList.toggle('active');
            if (vibrateEnabled && 'vibrate' in navigator) {
                navigator.vibrate(200);
            }
        });

        // MODALS
        function openModal(id) { document.getElementById(id).classList.add('show'); }
        function closeModal(id) { document.getElementById(id).classList.remove('show'); }

        document.getElementById('intentionBtn').addEventListener('click', () => openModal('intentionModal'));
        document.getElementById('releaseBtn').addEventListener('click', () => {
            if (document.getElementById('intentionText').value.trim()) {
                document.getElementById('intentionText').value = '';
                document.body.style.filter = 'brightness(1.5)';
                setTimeout(() => document.body.style.filter = 'brightness(1)', 2000);
            }
            closeModal('intentionModal');
        });

        document.getElementById('soundBtn').addEventListener('click', () => openModal('soundModal'));
        document.querySelectorAll('[data-sound]').forEach(btn => {
            btn.addEventListener('click', function() {
                playAmbient(this.dataset.sound);
                closeModal('soundModal');
                // Ambient sound is background only - no auto-breathing
            });
        });

        document.getElementById('cryptoBtn').addEventListener('click', () => openModal('cryptoModal'));

        function copyAddress(el) {
            navigator.clipboard.writeText(el.textContent.trim()).then(() => {
                const orig = el.textContent;
                el.textContent = '‚úì Copied!';
                setTimeout(() => el.textContent = orig, 2000);
            });
        }

        document.getElementById('shareBtn').addEventListener('click', () => {
            const canvas = document.getElementById('preview');
            const ctx = canvas.getContext('2d');
            const g = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            g.addColorStop(0, '#1a0033');
            g.addColorStop(0.5, '#8a2be2');
            g.addColorStop(1, '#ff1493');
            ctx.fillStyle = g;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = 'bold 90px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('INNERA FIELD', 600, 280);
            ctx.font = '45px Inter';
            ctx.fillText('You are infinite', 600, 360);
            document.getElementById('previewContainer').innerHTML = 
                `<img src="${canvas.toDataURL()}" alt="Share card">`;
            openModal('shareModal');
        });

        document.getElementById('downloadBtn').addEventListener('click', () => {
            const a = document.createElement('a');
            a.download = 'innerafield.png';
            a.href = document.getElementById('preview').toDataURL();
            a.click();
        });

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                closeModal('intentionModal');
                closeModal('shareModal');
                closeModal('soundModal');
                closeModal('cryptoModal');
            }
        });

        document.querySelectorAll('.modal').forEach(m => {
            m.addEventListener('click', e => {
                if (e.target === m) closeModal(m.id);
            });
        });

        // PWA Install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Could show install button here
        });
    </script>
</body>
</html>
