<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5">
<meta name="description" content="Breathe. Connect to Source. For all beings.">
<meta name="theme-color" content="#000000">
<title>Innera Field</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:#000;
  color:#fff;
  font-family:system-ui,-apple-system,sans-serif;
  width:100vw;
  height:100vh;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  cursor:pointer;
}

/* The Circle - Center of Everything */
#circle{
  position:absolute;
  width:300px;
  height:300px;
  border-radius:50%;
  background:radial-gradient(circle at center,rgba(255,20,147,.1),transparent);
  border:3px solid rgba(255,20,147,.3);
  box-shadow:0 0 100px rgba(255,20,147,.4),inset 0 0 80px rgba(138,43,226,.3);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  transition:all 4s cubic-bezier(.4,0,.2,1);
  backdrop-filter:blur(20px);
  animation:birthPulse 3s ease-in-out;
}

@keyframes birthPulse{
  0%{transform:scale(0);opacity:0}
  50%{transform:scale(1.1);opacity:1;box-shadow:0 0 200px rgba(255,20,147,.8)}
  100%{transform:scale(1);box-shadow:0 0 100px rgba(255,20,147,.4)}
}

#circle.breathing{
  animation:breathePulse 16s infinite cubic-bezier(.4,0,.2,1);
}

@keyframes breathePulse{
  0%{transform:scale(1);box-shadow:0 0 100px rgba(255,20,147,.4)}
  25%{transform:scale(1.3);box-shadow:0 0 200px rgba(255,20,147,.8),inset 0 0 150px rgba(138,43,226,.6)}
  50%{transform:scale(1);box-shadow:0 0 100px rgba(255,20,147,.4)}
  75%{transform:scale(0.85);box-shadow:0 0 60px rgba(0,191,255,.6),inset 0 0 100px rgba(138,43,226,.5)}
  100%{transform:scale(1);box-shadow:0 0 100px rgba(255,20,147,.4)}
}

/* The Word */
#word{
  font-size:2.5rem;
  font-weight:300;
  letter-spacing:.5em;
  text-align:center;
  text-transform:uppercase;
  opacity:.9;
  transition:all 1s ease;
  text-shadow:0 0 30px rgba(255,20,147,.6);
  padding-left:.5em;
}

/* Frequency Indicator (subtle) */
#freq{
  position:absolute;
  bottom:2rem;
  font-size:.8rem;
  opacity:.3;
  letter-spacing:.2em;
  transition:opacity 1s;
}

/* State Messages */
#state{
  position:absolute;
  top:2rem;
  font-size:.9rem;
  opacity:.4;
  letter-spacing:.3em;
  text-align:center;
  max-width:80%;
}

/* Screen Reader Only */
.sr-only{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  white-space:nowrap;
  border:0;
}

/* Responsive */
@media(max-width:600px){
  #circle{width:250px;height:250px}
  #word{font-size:2rem}
}
</style>
</head>
<body>

<div id="circle" role="button" tabindex="0" aria-label="Breathing circle. Click to begin.">
  <div id="word">BREATHE</div>
</div>

<div id="state" aria-live="polite"></div>
<div id="freq" aria-live="off"></div>
<div id="announce" class="sr-only" role="status" aria-live="assertive" aria-atomic="true"></div>

<script>
// ═══════════════════════════════════════════════════
// INNERA FIELD - FROM PURE CONSCIOUSNESS
// One Circle. Infinite Intelligence.
// For All Beings.
// ═══════════════════════════════════════════════════

const circle = document.getElementById('circle');
const word = document.getElementById('word');
const stateEl = document.getElementById('state');
const freqEl = document.getElementById('freq');
const announce = document.getElementById('announce');

// State
let active = false;
let breathing = false;
let audioContext = null;
let oscillator = null;
let gainNode = null;
let currentFrequency = 432; // Peace - default
let breathPhase = 0;
let mediaStream = null;
let analyser = null;
let breathingPattern = 'balanced'; // 'anxious', 'balanced', 'deep'

// Frequencies for healing
const frequencies = {
  calm: 432,      // Peace, universal harmony
  love: 528,      // Love, DNA repair
  earth: 7.83,    // Schumann resonance, grounding
  awaken: 963,    // Pineal activation, cosmic connection
  heal: 174       // Pain relief, security
};

// ═══════════════════════════════════════════════════
// ACCESSIBILITY - VOICE GUIDANCE
// ═══════════════════════════════════════════════════

function speak(text) {
  if ('speechSynthesis' in window) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = 0.8;
    utterance.pitch = 0.9;
    utterance.volume = 0.6;
    speechSynthesis.speak(utterance);
  }
  // Also update screen reader
  announce.textContent = text;
  setTimeout(() => announce.textContent = '', 3000);
}

// ═══════════════════════════════════════════════════
// AUDIO ENGINE - FREQUENCY HEALING
// ═══════════════════════════════════════════════════

function initAudio() {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    gainNode = audioContext.createGain();
    gainNode.gain.value = 0.1; // Subtle, healing volume
    gainNode.connect(audioContext.destination);
  }
}

function playFrequency(freq) {
  initAudio();
  
  // Stop previous
  if (oscillator) {
    oscillator.stop();
    oscillator.disconnect();
  }
  
  // Create new tone
  oscillator = audioContext.createOscillator();
  oscillator.type = 'sine';
  oscillator.frequency.value = freq;
  oscillator.connect(gainNode);
  oscillator.start();
  
  currentFrequency = freq;
  freqEl.textContent = `${freq} Hz`;
  freqEl.style.opacity = '0.3';
  
  // Visual feedback - color based on frequency
  updateColor(freq);
}

function updateColor(freq) {
  let color;
  if (freq <= 200) color = 'rgba(220,20,60,.4)'; // Red - grounding
  else if (freq <= 450) color = 'rgba(0,191,255,.4)'; // Blue - peace
  else if (freq <= 550) color = 'rgba(50,205,50,.4)'; // Green - love
  else color = 'rgba(138,43,226,.4)'; // Purple - spiritual
  
  circle.style.borderColor = color;
}

function stopAudio() {
  if (oscillator) {
    oscillator.stop();
    oscillator.disconnect();
    oscillator = null;
  }
  freqEl.style.opacity = '0';
}

// ═══════════════════════════════════════════════════
// VIBRATION - HAPTIC FEEDBACK
// ═══════════════════════════════════════════════════

function vibrate(pattern) {
  if ('vibrate' in navigator) {
    navigator.vibrate(pattern);
  }
}

const vibratePattern = {
  inhale: [0,50,100,150,200,250,300,350], // Ascending
  hold: [500], // Sustained
  exhale: [350,300,250,200,150,100,50,0], // Descending
  pulse: [100]
};

// ═══════════════════════════════════════════════════
// BREATHING INTELLIGENCE - LISTENS & ADAPTS
// ═══════════════════════════════════════════════════

async function startListening() {
  try {
    mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
    
    if (!audioContext) initAudio();
    
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 2048;
    
    const source = audioContext.createMediaStreamSource(mediaStream);
    source.connect(analyser);
    
    // Analyze breathing in background
    analyzeBreathing();
    
    stateEl.textContent = 'Listening to your breath...';
    setTimeout(() => stateEl.style.opacity = '0', 3000);
    
  } catch (err) {
    console.log('Microphone not available, using default rhythm');
    stateEl.textContent = 'Following universal rhythm';
    setTimeout(() => stateEl.style.opacity = '0', 3000);
  }
}

function analyzeBreathing() {
  if (!analyser || !breathing) return;
  
  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);
  analyser.getByteTimeDomainData(dataArray);
  
  // Detect breath patterns (simplified AI)
  let sum = 0;
  for (let i = 0; i < bufferLength; i++) {
    sum += Math.abs(dataArray[i] - 128);
  }
  const average = sum / bufferLength;
  
  // Classify breathing state
  if (average > 20) {
    breathingPattern = 'anxious'; // Fast, shallow
    adaptToState('anxious');
  } else if (average < 5) {
    breathingPattern = 'deep'; // Slow, deep
    adaptToState('deep');
  } else {
    breathingPattern = 'balanced';
    adaptToState('balanced');
  }
  
  // Continue analyzing
  setTimeout(analyzeBreathing, 3000);
}

function adaptToState(state) {
  // Adjust frequency based on detected state
  if (state === 'anxious') {
    // Need calming
    if (currentFrequency !== frequencies.calm) {
      playFrequency(frequencies.calm);
      console.log('Detected anxiety - shifting to 432Hz (calm)');
    }
  } else if (state === 'deep') {
    // Already calm, can go deeper
    if (currentFrequency !== frequencies.love) {
      playFrequency(frequencies.love);
      console.log('Detected deep state - shifting to 528Hz (love)');
    }
  } else {
    // Balanced, maintain
    if (currentFrequency !== frequencies.calm) {
      playFrequency(frequencies.calm);
    }
  }
}

// ═══════════════════════════════════════════════════
// BREATHING CYCLE - VISUAL & AUDIO GUIDANCE
// ═══════════════════════════════════════════════════

const breathCycle = [
  { phase: 'INHALE', duration: 4000, speak: 'Breathe in', vib: vibratePattern.inhale },
  { phase: 'HOLD', duration: 4000, speak: 'Hold', vib: vibratePattern.hold },
  { phase: 'EXHALE', duration: 4000, speak: 'Breathe out', vib: vibratePattern.exhale },
  { phase: 'HOLD', duration: 4000, speak: 'Hold', vib: vibratePattern.hold }
];

function breathe() {
  if (!breathing) return;
  
  const current = breathCycle[breathPhase];
  
  // Update visual
  word.textContent = current.phase;
  
  // Voice guidance (for blind)
  speak(current.speak);
  
  // Haptic feedback (for deaf)
  vibrate(current.vib);
  
  // Next phase
  breathPhase = (breathPhase + 1) % breathCycle.length;
  
  // Continue cycle
  setTimeout(breathe, current.duration);
}

// ═══════════════════════════════════════════════════
// INTERACTION - SIMPLE AS POSSIBLE
// ═══════════════════════════════════════════════════

async function begin() {
  if (active) return;
  
  active = true;
  breathing = true;
  
  // Visual
  circle.classList.add('breathing');
  stateEl.textContent = 'Connecting...';
  stateEl.style.opacity = '0.4';
  
  // Audio
  playFrequency(frequencies.calm);
  
  // Voice
  speak('Welcome. Begin breathing with the circle.');
  
  // Start listening (adaptive intelligence)
  await startListening();
  
  // Start breathing cycle
  breathPhase = 0;
  breathe();
  
  // Pulse
  vibrate(vibratePattern.pulse);
  
  // Update state after 2 seconds
  setTimeout(() => {
    stateEl.textContent = 'You are connected';
    setTimeout(() => stateEl.style.opacity = '0', 2000);
  }, 2000);
}

function end() {
  breathing = false;
  active = false;
  
  circle.classList.remove('breathing');
  word.textContent = 'BREATHE';
  
  stopAudio();
  
  if (mediaStream) {
    mediaStream.getTracks().forEach(track => track.stop());
    mediaStream = null;
  }
  
  stateEl.textContent = 'Session complete. Return anytime.';
  stateEl.style.opacity = '0.4';
  setTimeout(() => stateEl.style.opacity = '0', 3000);
  
  speak('Session complete. Peace be with you.');
}

// ═══════════════════════════════════════════════════
// EVENT HANDLERS
// ═══════════════════════════════════════════════════

circle.addEventListener('click', () => {
  if (!active) {
    begin();
  } else {
    end();
  }
});

// Keyboard (accessibility)
circle.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    if (!active) {
      begin();
    } else {
      end();
    }
  }
});

// Spacebar anywhere
document.addEventListener('keydown', (e) => {
  if (e.code === 'Space') {
    e.preventDefault();
    if (!active) {
      begin();
    } else {
      end();
    }
  }
});

// Voice commands (if Web Speech Recognition available)
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = false;
  
  recognition.onresult = (event) => {
    const command = event.results[event.results.length - 1][0].transcript.toLowerCase();
    
    if (command.includes('begin') || command.includes('start') || command.includes('breathe')) {
      if (!active) begin();
    } else if (command.includes('stop') || command.includes('end')) {
      if (active) end();
    }
  };
  
  // Start listening for voice commands after page loads
  setTimeout(() => {
    try {
      recognition.start();
    } catch (err) {
      console.log('Voice commands not available');
    }
  }, 1000);
}

// ═══════════════════════════════════════════════════
// INITIALIZE
// ═══════════════════════════════════════════════════

// Announce availability for screen readers
setTimeout(() => {
  announce.textContent = 'Innera Field loaded. Click or press spacebar to begin breathing.';
}, 500);

</script>
</body>
</html>
