<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes">
<meta name="description" content="One breath. One field. One source. Free meditation for all beings.">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Innera Field">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
<title>Innera Field</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --void:#000;
  --light:#fff;
  --dim:rgba(255,255,255,.6);
  --faint:rgba(255,255,255,.35);
  --glass:rgba(255,255,255,.1);
  --glass-hover:rgba(255,255,255,.18);
  --border:rgba(255,255,255,.2);
  --border-hover:rgba(255,255,255,.35);
  --gold:rgba(255,215,0,.4);
  --accent:#ffd700;
  --accent-dim:rgba(255,215,0,.5);
  --love:#ff69b4;
}
html,body{height:100%;overflow:hidden}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;
  background:var(--void);
  color:var(--light);
  display:flex;
  align-items:center;
  justify-content:center;
  -webkit-tap-highlight-color:transparent;
  -webkit-font-smoothing:antialiased;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THE COSMOS â€” breathing with you
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cosmos{
  position:fixed;
  inset:0;
  background:
    radial-gradient(ellipse at 20% 20%,rgba(255,215,0,.15),transparent 50%),
    radial-gradient(ellipse at 80% 80%,rgba(255,105,180,.12),transparent 50%),
    radial-gradient(ellipse at 50% 50%,rgba(138,43,226,.08),transparent 60%);
  opacity:.6;
  animation:cosmicBreath 20s ease-in-out infinite;
  pointer-events:none;
}
@keyframes cosmicBreath{
  0%,100%{opacity:.5;transform:scale(1)}
  50%{opacity:.7;transform:scale(1.02)}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THE FIELD â€” container of presence
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.field{
  position:relative;
  z-index:1;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:1.5rem;
  text-align:center;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THE TITLE â€” radiating like Source
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.title{
  position:absolute;
  top:max(10vh,50px);
  font-size:clamp(1.4rem,5vw,2.8rem);
  font-weight:600;
  letter-spacing:.4em;
  padding-left:.4em;
  background:linear-gradient(135deg,#fff 0%,#ffd700 25%,#fff 50%,#ffd700 75%,#fff 100%);
  background-size:200% 200%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  animation:sourceGlow 4s ease-in-out infinite;
  user-select:none;
  filter:drop-shadow(0 0 30px rgba(255,215,0,.3));
}
@keyframes sourceGlow{
  0%,100%{background-position:0% 50%}
  50%{background-position:100% 50%}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTROLS â€” minimal, present
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.controls{
  position:absolute;
  top:max(2.5vh,15px);
  right:max(3vw,15px);
  display:flex;
  gap:.75rem;
  z-index:100;
}
.ctrl{
  background:var(--glass);
  border:1px solid var(--border);
  color:var(--dim);
  width:56px;
  height:56px;
  cursor:pointer;
  transition:all .3s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  font-size:1.5rem;
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
}
.ctrl:hover,.ctrl:focus{
  color:var(--light);
  background:var(--glass-hover);
  border-color:var(--border-hover);
  transform:scale(1.08);
}
.ctrl:active{transform:scale(.95)}
.ctrl.on{
  color:var(--accent);
  background:rgba(255,215,0,.15);
  border-color:var(--accent-dim);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THE CIRCLE â€” the breath itself
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.circle{
  position:relative;
  width:min(240px,55vw);
  height:min(240px,55vw);
  border-radius:50%;
  background:radial-gradient(circle,rgba(255,215,0,.03),transparent 70%);
  border:2px solid rgba(255,255,255,.15);
  box-shadow:
    0 0 60px rgba(255,215,0,.15),
    0 0 120px rgba(255,105,180,.08),
    inset 0 0 60px rgba(255,255,255,.02);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  cursor:pointer;
  transition:transform .4s cubic-bezier(.4,0,.2,1),box-shadow .4s,border-color .4s;
}
.circle.idle{animation:gentlePulse 6s ease-in-out infinite}
@keyframes gentlePulse{
  0%,100%{transform:scale(1);box-shadow:0 0 60px rgba(255,215,0,.15),0 0 120px rgba(255,105,180,.08)}
  50%{transform:scale(1.02);box-shadow:0 0 80px rgba(255,215,0,.2),0 0 140px rgba(255,105,180,.12)}
}
.circle.breathing{transition-timing-function:cubic-bezier(.4,0,.2,1)}
.circle.inhale{
  transform:scale(1.35);
  border-color:rgba(255,215,0,.5);
  box-shadow:0 0 100px rgba(255,215,0,.4),0 0 160px rgba(255,215,0,.2);
}
.circle.hold{
  transform:scale(1.35);
  border-color:rgba(255,255,255,.4);
  box-shadow:0 0 80px rgba(255,255,255,.25),0 0 140px rgba(255,215,0,.15);
}
.circle.exhale{
  transform:scale(.65);
  border-color:rgba(138,43,226,.5);
  box-shadow:0 0 70px rgba(138,43,226,.35),0 0 120px rgba(100,100,255,.15);
}
.circle.rest{
  transform:scale(.65);
  border-color:rgba(255,105,180,.4);
  box-shadow:0 0 60px rgba(255,105,180,.3),0 0 100px rgba(138,43,226,.15);
}
.circle:focus{outline:none}
.circle:focus-visible{outline:2px solid rgba(255,215,0,.5);outline-offset:15px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THE WORD â€” guidance from within
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.word{
  font-size:clamp(1.1rem,3.5vw,1.5rem);
  font-weight:300;
  letter-spacing:.3em;
  padding-left:.3em;
  text-transform:lowercase;
  opacity:.9;
  user-select:none;
  transition:opacity .5s;
}
.hint{
  font-size:clamp(.75rem,2vw,.9rem);
  font-weight:300;
  letter-spacing:.15em;
  margin-top:.8rem;
  opacity:.4;
  color:var(--dim);
  transition:opacity .8s;
}
.breathing .hint{opacity:0;pointer-events:none}
.timer{
  font-size:clamp(.65rem,1.8vw,.8rem);
  font-weight:400;
  letter-spacing:.1em;
  margin-top:.5rem;
  opacity:0;
  color:var(--faint);
  transition:opacity .5s;
}
.breathing .timer{opacity:1}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THE WISDOM â€” truth remembered
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wisdom-area{
  position:absolute;
  bottom:max(10vh,60px);
  text-align:center;
  max-width:min(85%,380px);
  padding:0 1rem;
}
.wisdom{
  font-size:clamp(.85rem,2.2vw,1rem);
  font-weight:300;
  letter-spacing:.03em;
  line-height:1.8;
  opacity:0;
  transition:opacity 3s ease;
  font-style:italic;
  color:rgba(255,255,255,.5);
}
.active .wisdom{opacity:1}
.session-msg{
  margin-top:1rem;
  font-size:clamp(.8rem,2vw,.9rem);
  font-weight:400;
  letter-spacing:.1em;
  opacity:0;
  color:var(--dim);
  transition:opacity 2s;
  line-height:1.8;
}
.session-msg.show{opacity:1}
.session-msg .count{color:var(--accent);font-weight:500}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THE MENU â€” simple, humble
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:150;
  opacity:0;
  pointer-events:none;
  transition:opacity .35s;
  backdrop-filter:blur(3px);
}
.overlay.show{opacity:1;pointer-events:auto}

.menu{
  position:fixed;
  top:0;
  right:-320px;
  width:min(300px,88vw);
  height:100%;
  background:rgba(8,8,12,.98);
  border-left:1px solid var(--border);
  z-index:200;
  transition:right .35s cubic-bezier(.4,0,.2,1);
  overflow-y:auto;
  padding:2rem 1.5rem;
  display:flex;
  flex-direction:column;
  backdrop-filter:blur(20px);
}
.menu.open{right:0}

.menu-close{
  position:absolute;
  top:1rem;
  right:1rem;
  background:var(--glass);
  border:1px solid var(--border);
  color:var(--dim);
  font-size:1.8rem;
  cursor:pointer;
  width:50px;
  height:50px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  transition:all .3s;
}
.menu-close:hover{
  color:var(--light);
  background:var(--glass-hover);
  border-color:var(--border-hover);
}

.menu h3{
  font-size:.7rem;
  font-weight:500;
  letter-spacing:.2em;
  color:var(--faint);
  margin:1.5rem 0 .8rem;
  text-transform:uppercase;
}
.menu h3:first-of-type{margin-top:3.5rem}

.menu-row{display:flex;gap:.5rem;flex-wrap:wrap}
.menu-btn{
  flex:1;
  min-width:70px;
  padding:.75rem .5rem;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:12px;
  color:var(--dim);
  font-size:.8rem;
  font-weight:400;
  cursor:pointer;
  transition:all .25s;
  text-align:center;
}
.menu-btn:hover{background:var(--glass-hover);color:var(--light)}
.menu-btn.selected{
  border-color:var(--accent-dim);
  background:rgba(255,215,0,.1);
  color:var(--light);
}

.menu-divider{
  height:1px;
  background:var(--border);
  margin:1.2rem 0;
}

.menu-item{
  display:flex;
  align-items:center;
  padding:.85rem 1rem;
  margin:.3rem 0;
  background:transparent;
  border:1px solid transparent;
  border-radius:12px;
  cursor:pointer;
  transition:all .25s;
  font-size:.9rem;
  color:var(--dim);
  gap:.8rem;
}
.menu-item:hover{background:var(--glass);color:var(--light)}
.menu-item.on{color:var(--accent)}
.menu-item .icon{font-size:1.2rem;width:28px;text-align:center}

.menu-footer{
  margin-top:auto;
  padding-top:1.5rem;
  border-top:1px solid var(--border);
  text-align:center;
}
.support-btn{
  display:inline-flex;
  align-items:center;
  gap:.6rem;
  padding:.8rem 1.5rem;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:30px;
  color:var(--dim);
  font-size:.85rem;
  cursor:pointer;
  transition:all .3s;
  text-decoration:none;
}
.support-btn:hover{
  background:rgba(255,105,180,.1);
  border-color:rgba(255,105,180,.4);
  color:var(--love);
}
.support-btn .heart{font-size:1.1rem}

.menu-version{
  margin-top:1rem;
  font-size:.7rem;
  letter-spacing:.1em;
  color:var(--faint);
  opacity:.5;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUPPORT MODAL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.95);
  z-index:300;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:opacity .35s;
  backdrop-filter:blur(8px);
}
.modal.show{opacity:1;pointer-events:auto}
.modal-content{
  background:rgba(12,12,18,.98);
  border:1px solid var(--border);
  border-radius:20px;
  padding:2rem;
  text-align:center;
  max-width:min(90%,340px);
  transform:scale(.95);
  transition:transform .35s;
}
.modal.show .modal-content{transform:scale(1)}
.modal-content h3{
  font-size:1rem;
  font-weight:500;
  letter-spacing:.15em;
  margin-bottom:1.5rem;
  color:var(--dim);
}
.donate-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:.8rem;
  margin-bottom:1.5rem;
}
.donate-btn{
  padding:1rem;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:14px;
  color:var(--dim);
  font-size:.85rem;
  cursor:pointer;
  transition:all .25s;
  text-decoration:none;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:.5rem;
}
.donate-btn:hover{
  background:var(--glass-hover);
  border-color:var(--border-hover);
  color:var(--light);
}
.donate-btn .icon{font-size:1.5rem}
.modal-close{
  background:var(--glass);
  border:1px solid var(--border);
  color:var(--dim);
  padding:.75rem 2rem;
  font-size:.8rem;
  letter-spacing:.1em;
  cursor:pointer;
  border-radius:12px;
  transition:all .3s;
}
.modal-close:hover{background:var(--glass-hover);color:var(--light)}

/* Crypto modal */
.crypto-modal .donate-qr{
  width:160px;
  height:160px;
  margin:0 auto 1rem;
  background:#fff;
  border-radius:12px;
  padding:10px;
}
.crypto-modal .donate-qr img{width:100%;height:100%;border-radius:4px}
.crypto-modal .donate-address{
  font-size:.65rem;
  font-family:monospace;
  color:var(--faint);
  word-break:break-all;
  padding:1rem;
  background:var(--glass);
  border-radius:10px;
  cursor:pointer;
  margin-bottom:1rem;
  transition:all .3s;
}
.crypto-modal .donate-address:hover{background:var(--glass-hover);color:var(--light)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANGUAGE MODAL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.lang-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:.5rem;
  margin-bottom:1.5rem;
}
.lang-btn{
  padding:.8rem .5rem;
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:10px;
  color:var(--dim);
  font-size:.8rem;
  cursor:pointer;
  transition:all .25s;
}
.lang-btn:hover{background:var(--glass-hover);color:var(--light)}
.lang-btn.selected{
  border-color:var(--accent-dim);
  background:rgba(255,215,0,.1);
  color:var(--light);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{
  position:fixed;
  bottom:15%;
  left:50%;
  transform:translateX(-50%) translateY(20px);
  background:rgba(8,8,12,.95);
  border:1px solid var(--border);
  padding:1rem 1.8rem;
  border-radius:16px;
  font-size:.85rem;
  opacity:0;
  pointer-events:none;
  transition:all .4s;
  z-index:400;
  backdrop-filter:blur(10px);
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACCESSIBILITY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sr-only{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  border:0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:400px){
  .ctrl{width:52px;height:52px;font-size:1.4rem}
  .circle{width:min(200px,60vw);height:min(200px,60vw)}
  .title{font-size:clamp(1.2rem,5vw,1.8rem);letter-spacing:.3em}
}
@media(min-width:800px){
  .ctrl{width:60px;height:60px;font-size:1.6rem}
  .circle{width:280px;height:280px}
}
@media(prefers-reduced-motion:reduce){
  *{animation:none!important;transition-duration:.1s!important}
}
</style>
</head>
<body>

<div class="cosmos"></div>

<div class="field">
  <h1 class="title">INNERA FIELD</h1>
  
  <div class="controls">
    <button class="ctrl" id="soundBtn" title="Sound" aria-label="Toggle sound">â™ª</button>
    <button class="ctrl" id="menuBtn" title="Menu" aria-label="Open menu">â˜°</button>
  </div>
  
  <div class="circle idle" id="circle" role="button" tabindex="0" aria-label="Breathing circle. Tap to begin.">
    <span class="word" id="word">breathe</span>
    <span class="hint" id="hint">tap to begin</span>
    <span class="timer" id="timer"></span>
  </div>
  
  <div class="wisdom-area">
    <p class="wisdom" id="wisdom"></p>
    <p class="session-msg" id="sessionMsg"></p>
  </div>
  
  <div class="sr-only" id="sr" role="status" aria-live="assertive"></div>
</div>

<div class="overlay" id="overlay"></div>

<nav class="menu" id="menu" aria-label="Settings">
  <button class="menu-close" id="menuClose" aria-label="Close menu">Ã—</button>
  
  <h3 id="durationLabel">Duration</h3>
  <div class="menu-row">
    <button class="menu-btn" data-time="300">5 min</button>
    <button class="menu-btn selected" data-time="600">10 min</button>
    <button class="menu-btn" data-time="1200">20 min</button>
    <button class="menu-btn" data-time="0">âˆ</button>
  </div>
  
  <div class="menu-divider"></div>
  
  <div class="menu-item" id="voiceToggle">
    <span class="icon">ğŸ”ˆ</span>
    <span id="voiceLabel">Voice guidance</span>
  </div>
  
  <div class="menu-item" id="langToggle">
    <span class="icon">ğŸŒ</span>
    <span id="langLabel">Language</span>
  </div>
  
  <div class="menu-item" id="shareToggle">
    <span class="icon">â†—</span>
    <span id="shareLabel">Share the peace</span>
  </div>
  
  <div class="menu-item" id="installToggle" style="display:none">
    <span class="icon">â¬‡</span>
    <span id="installLabel">Install app</span>
  </div>
  
  <div class="menu-footer">
    <button class="support-btn" id="supportBtn">
      <span class="heart">â™¡</span>
      <span id="supportLabel">Support this work</span>
    </button>
    <div class="menu-version">v4.0</div>
  </div>
</nav>

<div class="modal" id="supportModal">
  <div class="modal-content">
    <h3 id="supportTitle">SUPPORT</h3>
    <div class="donate-grid">
      <a class="donate-btn" href="https://ko-fi.com/innerafield" target="_blank" rel="noopener">
        <span class="icon">â™¡</span>
        <span>Ko-fi</span>
      </a>
      <a class="donate-btn" href="https://www.paypal.com/ncp/payment/3MLTXSEW9L3RL" target="_blank" rel="noopener">
        <span class="icon">$</span>
        <span>PayPal</span>
      </a>
      <button class="donate-btn" id="btcBtn">
        <span class="icon">â‚¿</span>
        <span>Bitcoin</span>
      </button>
      <button class="donate-btn" id="ethBtn">
        <span class="icon">Î</span>
        <span>Ethereum</span>
      </button>
    </div>
    <button class="modal-close" id="supportClose">close</button>
  </div>
</div>

<div class="modal crypto-modal" id="cryptoModal">
  <div class="modal-content">
    <h3 id="cryptoTitle">BITCOIN</h3>
    <div class="donate-qr"><img id="cryptoQR" src="" alt="QR Code"></div>
    <div class="donate-address" id="cryptoAddress" title="Click to copy"></div>
    <button class="modal-close" id="cryptoClose">close</button>
  </div>
</div>

<div class="modal" id="langModal">
  <div class="modal-content">
    <h3 id="langTitle">Language</h3>
    <div class="lang-grid">
      <button class="lang-btn selected" data-lang="en">English</button>
      <button class="lang-btn" data-lang="es">EspaÃ±ol</button>
      <button class="lang-btn" data-lang="zh">ä¸­æ–‡</button>
      <button class="lang-btn" data-lang="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</button>
      <button class="lang-btn" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
      <button class="lang-btn" data-lang="pt">PortuguÃªs</button>
      <button class="lang-btn" data-lang="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
      <button class="lang-btn" data-lang="ja">æ—¥æœ¬èª</button>
      <button class="lang-btn" data-lang="ko">í•œêµ­ì–´</button>
      <button class="lang-btn" data-lang="fr">FranÃ§ais</button>
    </div>
    <button class="modal-close" id="langClose">close</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
(function(){'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THE ESSENCE â€” One breath. One source.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const VERSION = '4.0';

// One pattern. The heartbeat of the universe.
const BREATH = [4, 4, 4, 4]; // inhale, hold, exhale, rest
const PHASES = ['inhale', 'hold', 'exhale', 'rest'];

// One frequency. 528Hz â€” the love frequency.
const SOLFEGGIO = 528;

// One binaural. 8Hz â€” alpha waves, relaxed awareness.
const BINAURAL_BASE = 200;
const BINAURAL_BEAT = 8;

// The crypto addresses
const CRYPTO = {
  btc: 'bc1qwjsvjg0ckfw2aa9c5zdhc4ewxn7yse8lvstuaz',
  eth: '0x12e10C6aA1557A9B13c570c0070E223aec8dE498'
};

// Translations â€” essential words only
const LANG = {
  en: {
    breathe: 'breathe',
    inhale: 'breathe in',
    hold: 'hold',
    exhale: 'release',
    rest: 'rest',
    tap: 'tap to begin',
    duration: 'Duration',
    voice: 'Voice guidance',
    language: 'Language',
    share: 'Share the peace',
    install: 'Install app',
    support: 'Support this work',
    close: 'close',
    copied: 'copied âœ“',
    breaths: 'breaths with Source',
    return: 'return when you forget',
    headphones: 'headphones enhance the experience'
  },
  es: {
    breathe: 'respira',
    inhale: 'inhala',
    hold: 'sostÃ©n',
    exhale: 'exhala',
    rest: 'descansa',
    tap: 'toca para comenzar',
    duration: 'DuraciÃ³n',
    voice: 'GuÃ­a de voz',
    language: 'Idioma',
    share: 'Comparte la paz',
    install: 'Instalar app',
    support: 'Apoya este trabajo',
    close: 'cerrar',
    copied: 'copiado âœ“',
    breaths: 'respiraciones con la Fuente',
    return: 'regresa cuando olvides',
    headphones: 'los auriculares mejoran la experiencia'
  },
  zh: {
    breathe: 'å‘¼å¸',
    inhale: 'å¸æ°”',
    hold: 'å±æ¯',
    exhale: 'å‘¼æ°”',
    rest: 'ä¼‘æ¯',
    tap: 'ç‚¹å‡»å¼€å§‹',
    duration: 'æ—¶é•¿',
    voice: 'è¯­éŸ³å¼•å¯¼',
    language: 'è¯­è¨€',
    share: 'åˆ†äº«å¹³é™',
    install: 'å®‰è£…åº”ç”¨',
    support: 'æ”¯æŒè¿™é¡¹å·¥ä½œ',
    close: 'å…³é—­',
    copied: 'å·²å¤åˆ¶ âœ“',
    breaths: 'æ¬¡å‘¼å¸',
    return: 'å¿˜è®°æ—¶è¯·å›æ¥',
    headphones: 'è€³æœºå¢å¼ºä½“éªŒ'
  },
  hi: {
    breathe: 'à¤¸à¤¾à¤à¤¸',
    inhale: 'à¤¸à¤¾à¤à¤¸ à¤²à¥‹',
    hold: 'à¤°à¥‹à¤•à¥‹',
    exhale: 'à¤›à¥‹à¤¡à¤¼à¥‹',
    rest: 'à¤µà¤¿à¤¶à¥à¤°à¤¾à¤®',
    tap: 'à¤Ÿà¥ˆà¤ª à¤•à¤°à¥‡à¤‚',
    duration: 'à¤…à¤µà¤§à¤¿',
    voice: 'à¤†à¤µà¤¾à¤œà¤¼ à¤®à¤¾à¤°à¥à¤—à¤¦à¤°à¥à¤¶à¤¨',
    language: 'à¤­à¤¾à¤·à¤¾',
    share: 'à¤¶à¤¾à¤‚à¤¤à¤¿ à¤¸à¤¾à¤à¤¾ à¤•à¤°à¥‡à¤‚',
    install: 'à¤à¤ª à¤‡à¤‚à¤¸à¥à¤Ÿà¥‰à¤² à¤•à¤°à¥‡à¤‚',
    support: 'à¤‡à¤¸ à¤•à¤¾à¤® à¤•à¤¾ à¤¸à¤®à¤°à¥à¤¥à¤¨ à¤•à¤°à¥‡à¤‚',
    close: 'à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚',
    copied: 'à¤•à¥‰à¤ªà¥€ âœ“',
    breaths: 'à¤¸à¤¾à¤à¤¸à¥‡à¤‚',
    return: 'à¤œà¤¬ à¤­à¥‚à¤² à¤œà¤¾à¤“ à¤²à¥Œà¤Ÿ à¤†à¤“',
    headphones: 'à¤¹à¥‡à¤¡à¤«à¥‹à¤¨ à¤¸à¥‡ à¤¬à¥‡à¤¹à¤¤à¤° à¤…à¤¨à¥à¤­à¤µ'
  },
  ar: {
    breathe: 'ØªÙ†ÙØ³',
    inhale: 'Ø´Ù‡ÙŠÙ‚',
    hold: 'Ø§Ø­Ø¨Ø³',
    exhale: 'Ø²ÙÙŠØ±',
    rest: 'Ø§Ø³ØªØ±Ø­',
    tap: 'Ø§Ù†Ù‚Ø± Ù„Ù„Ø¨Ø¯Ø¡',
    duration: 'Ø§Ù„Ù…Ø¯Ø©',
    voice: 'Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØµÙˆØªÙŠ',
    language: 'Ø§Ù„Ù„ØºØ©',
    share: 'Ø´Ø§Ø±Ùƒ Ø§Ù„Ø³Ù„Ø§Ù…',
    install: 'ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚',
    support: 'Ø§Ø¯Ø¹Ù… Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„',
    close: 'Ø¥ØºÙ„Ø§Ù‚',
    copied: 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“',
    breaths: 'Ø£Ù†ÙØ§Ø³',
    return: 'Ø¹Ø¯ Ø¹Ù†Ø¯Ù…Ø§ ØªÙ†Ø³Ù‰',
    headphones: 'Ø§Ù„Ø³Ù…Ø§Ø¹Ø§Øª ØªØ¹Ø²Ø² Ø§Ù„ØªØ¬Ø±Ø¨Ø©'
  },
  pt: {
    breathe: 'respire',
    inhale: 'inspire',
    hold: 'segure',
    exhale: 'expire',
    rest: 'descanse',
    tap: 'toque para comeÃ§ar',
    duration: 'DuraÃ§Ã£o',
    voice: 'OrientaÃ§Ã£o por voz',
    language: 'Idioma',
    share: 'Compartilhe a paz',
    install: 'Instalar app',
    support: 'Apoie este trabalho',
    close: 'fechar',
    copied: 'copiado âœ“',
    breaths: 'respiraÃ§Ãµes',
    return: 'volte quando esquecer',
    headphones: 'fones melhoram a experiÃªncia'
  },
  ru: {
    breathe: 'Ğ´Ñ‹ÑˆĞ¸',
    inhale: 'Ğ²Ğ´Ğ¾Ñ…',
    hold: 'Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ°',
    exhale: 'Ğ²Ñ‹Ğ´Ğ¾Ñ…',
    rest: 'Ğ¾Ñ‚Ğ´Ñ‹Ñ…',
    tap: 'Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ',
    duration: 'Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ',
    voice: 'Ğ“Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ',
    language: 'Ğ¯Ğ·Ñ‹Ğº',
    share: 'ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ĞµÑÑŒ Ğ¿Ğ¾ĞºĞ¾ĞµĞ¼',
    install: 'Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ',
    support: 'ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ',
    close: 'Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ',
    copied: 'ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ âœ“',
    breaths: 'Ğ²Ğ´Ğ¾Ñ…Ğ¾Ğ²',
    return: 'Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°Ğ¹Ñ‚ĞµÑÑŒ',
    headphones: 'Ğ½Ğ°ÑƒÑˆĞ½Ğ¸ĞºĞ¸ ÑƒÑĞ¸Ğ»ÑÑ‚ ÑÑ„Ñ„ĞµĞºÑ‚'
  },
  ja: {
    breathe: 'å‘¼å¸',
    inhale: 'å¸ã†',
    hold: 'æ­¢ã‚ã‚‹',
    exhale: 'åã',
    rest: 'ä¼‘ã‚€',
    tap: 'ã‚¿ãƒƒãƒ—ã—ã¦é–‹å§‹',
    duration: 'æ™‚é–“',
    voice: 'éŸ³å£°ã‚¬ã‚¤ãƒ‰',
    language: 'è¨€èª',
    share: 'å¹³å’Œã‚’å…±æœ‰',
    install: 'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«',
    support: 'ã‚µãƒãƒ¼ãƒˆ',
    close: 'é–‰ã˜ã‚‹',
    copied: 'ã‚³ãƒ”ãƒ¼ âœ“',
    breaths: 'å›ã®å‘¼å¸',
    return: 'å¿˜ã‚ŒãŸæ™‚ã«',
    headphones: 'ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³æ¨å¥¨'
  },
  ko: {
    breathe: 'ìˆ¨ì‰¬ê¸°',
    inhale: 'ë“¤ì´ì‰¬ê¸°',
    hold: 'ë©ˆì¶”ê¸°',
    exhale: 'ë‚´ì‰¬ê¸°',
    rest: 'ì‰¬ê¸°',
    tap: 'íƒ­í•˜ì—¬ ì‹œì‘',
    duration: 'ì‹œê°„',
    voice: 'ìŒì„± ì•ˆë‚´',
    language: 'ì–¸ì–´',
    share: 'í‰í™”ë¥¼ ë‚˜ëˆ„ì„¸ìš”',
    install: 'ì„¤ì¹˜',
    support: 'í›„ì›',
    close: 'ë‹«ê¸°',
    copied: 'ë³µì‚¬ë¨ âœ“',
    breaths: 'ë²ˆ í˜¸í¡',
    return: 'ìŠì„ ë•Œ ëŒì•„ì˜¤ì„¸ìš”',
    headphones: 'í—¤ë“œí° ê¶Œì¥'
  },
  fr: {
    breathe: 'respire',
    inhale: 'inspire',
    hold: 'retiens',
    exhale: 'expire',
    rest: 'repose',
    tap: 'touche pour commencer',
    duration: 'DurÃ©e',
    voice: 'Guidage vocal',
    language: 'Langue',
    share: 'Partagez la paix',
    install: 'Installer',
    support: 'Soutenir',
    close: 'fermer',
    copied: 'copiÃ© âœ“',
    breaths: 'respirations',
    return: 'revenez',
    headphones: 'Ã©couteurs recommandÃ©s'
  }
};

// Wisdoms â€” truths to remember
const WISDOMS = [
  "you are worthy of love. you always have been.",
  "your heart knows the way. trust it.",
  "love is not earned. it is remembered.",
  "the truth you seek is seeking you.",
  "stillness speaks louder than thought.",
  "you are held by the earth. always.",
  "presence is the anchor. breath is the chain.",
  "you belong here. you have always belonged.",
  "separation is the illusion. oneness is the truth.",
  "there is no other. there is only one.",
  "in the quiet, God speaks.",
  "surrender is not giving up. it is opening up.",
  "the deepest peace is already within you.",
  "one field. one breath. one source."
];

// State
const S = {
  on: false,
  phase: 0,
  breaths: 0,
  sound: true, // Sound ON by default
  voice: false,
  duration: 600,
  elapsed: 0,
  timer: null,
  tickTimer: null,
  lang: 'en',
  audio: null,
  osc: null,
  oscL: null,
  oscR: null,
  gain: null,
  gainL: null,
  gainR: null,
  deferredPrompt: null,
  lifetimeBreaths: 0
};

// Load saved preferences
try {
  const saved = localStorage.getItem('innerafield');
  if (saved) {
    const p = JSON.parse(saved);
    S.duration = p.duration ?? 600;
    S.sound = p.sound !== false;
    S.voice = p.voice || false;
    S.lang = p.lang || 'en';
    S.lifetimeBreaths = p.lifetimeBreaths || 0;
  }
} catch(e) {}

// DOM
const $ = id => document.getElementById(id);
const circle = $('circle');
const word = $('word');
const hint = $('hint');
const timerDisplay = $('timer');
const wisdom = $('wisdom');
const sessionMsg = $('sessionMsg');
const sr = $('sr');
const menu = $('menu');
const overlay = $('overlay');
const toast = $('toast');

// Translation helper
function t(key) {
  return LANG[S.lang]?.[key] || LANG.en[key] || key;
}

// Save preferences
function savePrefs() {
  try {
    localStorage.setItem('innerafield', JSON.stringify({
      duration: S.duration,
      sound: S.sound,
      voice: S.voice,
      lang: S.lang,
      lifetimeBreaths: S.lifetimeBreaths
    }));
  } catch(e) {}
}

// Update UI text
function updateUI() {
  if (!S.on) {
    word.textContent = t('breathe');
    hint.textContent = t('tap');
  }
  $('durationLabel').textContent = t('duration');
  $('voiceLabel').textContent = t('voice');
  $('langLabel').textContent = t('language');
  $('shareLabel').textContent = t('share');
  $('installLabel').textContent = t('install');
  $('supportLabel').textContent = t('support');
  $('supportClose').textContent = t('close');
  $('cryptoClose').textContent = t('close');
  $('langClose').textContent = t('close');
  $('langTitle').textContent = t('language');
  
  // Update selected states
  document.querySelectorAll('[data-time]').forEach(el => {
    el.classList.toggle('selected', parseInt(el.dataset.time) === S.duration);
  });
  document.querySelectorAll('[data-lang]').forEach(el => {
    el.classList.toggle('selected', el.dataset.lang === S.lang);
  });
  $('soundBtn').classList.toggle('on', S.sound);
  $('voiceToggle').classList.toggle('on', S.voice);
}

// Haptic feedback
function haptic(ms) {
  if ('vibrate' in navigator) {
    try { navigator.vibrate(ms); } catch(e) {}
  }
}

// Toast notification
function showToast(msg) {
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2500);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUDIO â€” The frequency of love
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function initAudio() {
  if (S.audio) return;
  S.audio = new (window.AudioContext || window.webkitAudioContext)();
  
  // Main solfeggio oscillator
  S.gain = S.audio.createGain();
  S.gain.gain.value = 0;
  S.gain.connect(S.audio.destination);
  
  // Binaural beat (stereo)
  S.gainL = S.audio.createGain();
  S.gainR = S.audio.createGain();
  S.gainL.gain.value = 0;
  S.gainR.gain.value = 0;
  const merger = S.audio.createChannelMerger(2);
  S.gainL.connect(merger, 0, 0);
  S.gainR.connect(merger, 0, 1);
  merger.connect(S.audio.destination);
}

function playWelcomeTone() {
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const now = ctx.currentTime;
    const osc = ctx.createOscillator();
    osc.type = 'sine';
    osc.frequency.value = SOLFEGGIO;
    const g = ctx.createGain();
    g.gain.setValueAtTime(0, now);
    g.gain.linearRampToValueAtTime(0.08, now + 0.3);
    g.gain.linearRampToValueAtTime(0.05, now + 1.5);
    g.gain.linearRampToValueAtTime(0, now + 3);
    osc.connect(g);
    g.connect(ctx.destination);
    osc.start(now);
    osc.stop(now + 3.5);
    setTimeout(() => ctx.close(), 4000);
  } catch(e) {}
}

function startSound() {
  if (!S.audio) return;
  
  // Solfeggio 528Hz
  if (!S.osc) {
    S.osc = S.audio.createOscillator();
    S.osc.type = 'sine';
    S.osc.frequency.value = SOLFEGGIO;
    S.osc.connect(S.gain);
    S.osc.start();
  }
  S.gain.gain.setTargetAtTime(0.06, S.audio.currentTime, 0.5);
  
  // Binaural beat
  if (!S.oscL) {
    S.oscL = S.audio.createOscillator();
    S.oscL.type = 'sine';
    S.oscL.frequency.value = BINAURAL_BASE;
    S.oscL.connect(S.gainL);
    S.oscL.start();
  }
  if (!S.oscR) {
    S.oscR = S.audio.createOscillator();
    S.oscR.type = 'sine';
    S.oscR.frequency.value = BINAURAL_BASE + BINAURAL_BEAT;
    S.oscR.connect(S.gainR);
    S.oscR.start();
  }
  S.gainL.gain.setTargetAtTime(0.04, S.audio.currentTime, 0.5);
  S.gainR.gain.setTargetAtTime(0.04, S.audio.currentTime, 0.5);
}

function stopSound() {
  if (!S.audio) return;
  S.gain?.gain.setTargetAtTime(0, S.audio.currentTime, 0.3);
  S.gainL?.gain.setTargetAtTime(0, S.audio.currentTime, 0.3);
  S.gainR?.gain.setTargetAtTime(0, S.audio.currentTime, 0.3);
}

function speak(text) {
  if (!S.voice || !text || !window.speechSynthesis) return;
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.rate = 0.8;
  u.pitch = 0.9;
  u.volume = 0.6;
  u.lang = S.lang;
  speechSynthesis.speak(u);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BREATHING â€” The rhythm of life
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function setPhase(i) {
  S.phase = i;
  const dur = BREATH[i];
  const phase = PHASES[i];
  
  circle.style.transitionDuration = (dur * 0.92) + 's';
  circle.className = 'circle breathing ' + phase;
  
  const words = [t('inhale'), t('hold'), t('exhale'), t('rest')];
  word.textContent = words[i];
  sr.textContent = words[i];
  speak(words[i]);
  
  // Haptic per phase
  const haptics = [80, 40, 60, 30];
  haptic(haptics[i]);
  
  // Count breaths on exhale
  if (i === 2) {
    S.breaths++;
    S.lifetimeBreaths++;
  }
}

function nextPhase() {
  if (!S.on) return;
  setPhase((S.phase + 1) % 4);
  scheduleNext();
}

function scheduleNext() {
  if (!S.on) return;
  S.timer = setTimeout(nextPhase, BREATH[S.phase] * 1000);
}

function updateTimer() {
  if (!S.on) return;
  S.elapsed++;
  
  if (S.duration > 0) {
    const rem = S.duration - S.elapsed;
    if (rem <= 0) {
      stop();
      return;
    }
    timerDisplay.textContent = Math.floor(rem / 60) + ':' + (rem % 60 < 10 ? '0' : '') + (rem % 60);
  } else {
    timerDisplay.textContent = S.breaths + ' ' + t('breathe');
  }
  
  S.tickTimer = setTimeout(updateTimer, 1000);
}

function start() {
  if (S.on) return;
  S.on = true;
  S.breaths = 0;
  S.elapsed = 0;
  
  document.body.classList.add('active');
  sessionMsg.classList.remove('show');
  hint.style.display = 'none';
  wisdom.textContent = WISDOMS[Math.floor(Math.random() * WISDOMS.length)];
  
  circle.classList.remove('idle');
  haptic(100);
  
  if (S.sound) {
    initAudio();
    if (S.audio.state === 'suspended') S.audio.resume();
    startSound();
  }
  
  // Start with inhale
  setTimeout(() => {
    setPhase(0);
    scheduleNext();
    updateTimer();
  }, 300);
  
  sr.textContent = 'Breathing started.';
}

function stop() {
  if (!S.on) return;
  S.on = false;
  
  document.body.classList.remove('active');
  clearTimeout(S.timer);
  clearTimeout(S.tickTimer);
  
  circle.style.transitionDuration = '';
  circle.className = 'circle idle';
  word.textContent = t('breathe');
  timerDisplay.textContent = '';
  
  stopSound();
  savePrefs();
  haptic([50, 50, 50]);
  
  // Session message
  sessionMsg.innerHTML = '<span class="count">âœ§ ' + S.breaths + ' ' + t('breaths') + ' âœ§</span><br>' + t('return');
  sessionMsg.classList.add('show');
  
  setTimeout(() => {
    sessionMsg.classList.remove('show');
    wisdom.textContent = '';
    hint.style.display = '';
  }, 8000);
  
  sr.textContent = S.breaths + ' breaths complete.';
}

function toggle() {
  S.on ? stop() : start();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MENU & MODALS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function openMenu() {
  menu.classList.add('open');
  overlay.classList.add('show');
}

function closeMenu() {
  menu.classList.remove('open');
  overlay.classList.remove('show');
}

function closeAllModals() {
  $('supportModal').classList.remove('show');
  $('cryptoModal').classList.remove('show');
  $('langModal').classList.remove('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EVENT LISTENERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// Circle
circle.addEventListener('click', toggle);
circle.addEventListener('keydown', e => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    toggle();
  }
});

// Controls
$('soundBtn').addEventListener('click', () => {
  S.sound = !S.sound;
  $('soundBtn').classList.toggle('on', S.sound);
  savePrefs();
  haptic(40);
  
  if (S.sound && S.on) {
    initAudio();
    if (S.audio.state === 'suspended') S.audio.resume();
    startSound();
    showToast(t('headphones'));
  } else if (!S.sound) {
    stopSound();
  }
});

$('menuBtn').addEventListener('click', () => {
  openMenu();
  haptic(30);
});

$('menuClose').addEventListener('click', closeMenu);
overlay.addEventListener('click', () => {
  closeMenu();
  closeAllModals();
});

// Duration
document.querySelectorAll('[data-time]').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('[data-time]').forEach(e => e.classList.remove('selected'));
    el.classList.add('selected');
    S.duration = parseInt(el.dataset.time);
    savePrefs();
    haptic(30);
  });
});

// Voice
$('voiceToggle').addEventListener('click', () => {
  S.voice = !S.voice;
  $('voiceToggle').classList.toggle('on', S.voice);
  savePrefs();
  haptic(40);
});

// Language
$('langToggle').addEventListener('click', () => {
  $('langModal').classList.add('show');
  haptic(30);
});
$('langClose').addEventListener('click', () => $('langModal').classList.remove('show'));

document.querySelectorAll('[data-lang]').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('[data-lang]').forEach(e => e.classList.remove('selected'));
    el.classList.add('selected');
    S.lang = el.dataset.lang;
    savePrefs();
    updateUI();
    $('langModal').classList.remove('show');
    haptic(30);
  });
});

// Share
$('shareToggle').addEventListener('click', async () => {
  const data = {
    title: 'Innera Field',
    text: 'One breath. One field. One source. Free meditation for all beings.',
    url: 'https://innerafield.com'
  };
  
  if (navigator.share) {
    try {
      await navigator.share(data);
    } catch(e) {
      if (e.name !== 'AbortError') copyLink();
    }
  } else {
    copyLink();
  }
  closeMenu();
});

function copyLink() {
  navigator.clipboard.writeText('https://innerafield.com')
    .then(() => showToast(t('copied')))
    .catch(() => showToast('innerafield.com'));
}

// Install
window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  S.deferredPrompt = e;
  $('installToggle').style.display = '';
});

$('installToggle').addEventListener('click', async () => {
  if (S.deferredPrompt) {
    S.deferredPrompt.prompt();
    await S.deferredPrompt.userChoice;
    S.deferredPrompt = null;
    $('installToggle').style.display = 'none';
  }
  closeMenu();
});

// Support
$('supportBtn').addEventListener('click', () => {
  $('supportModal').classList.add('show');
  haptic(30);
});
$('supportClose').addEventListener('click', () => $('supportModal').classList.remove('show'));

$('btcBtn').addEventListener('click', () => showCryptoModal('btc'));
$('ethBtn').addEventListener('click', () => showCryptoModal('eth'));
$('cryptoClose').addEventListener('click', () => $('cryptoModal').classList.remove('show'));

function showCryptoModal(type) {
  const addr = CRYPTO[type];
  $('cryptoTitle').textContent = type === 'btc' ? 'BITCOIN' : 'ETHEREUM';
  $('cryptoAddress').textContent = addr;
  $('cryptoQR').src = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=' + encodeURIComponent(addr);
  $('supportModal').classList.remove('show');
  $('cryptoModal').classList.add('show');
}

$('cryptoAddress').addEventListener('click', function() {
  navigator.clipboard.writeText(this.textContent)
    .then(() => showToast(t('copied')));
});

// Keyboard
document.addEventListener('keydown', e => {
  if (e.key === ' ' && document.activeElement === document.body) {
    e.preventDefault();
    toggle();
  }
  if (e.key === 'Escape') {
    if ($('cryptoModal').classList.contains('show')) $('cryptoModal').classList.remove('show');
    else if ($('supportModal').classList.contains('show')) $('supportModal').classList.remove('show');
    else if ($('langModal').classList.contains('show')) $('langModal').classList.remove('show');
    else if (menu.classList.contains('open')) closeMenu();
    else if (S.on) stop();
  }
});

// Service worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').catch(() => {});
}

// Initialize
updateUI();

// Welcome tone â€” immediate on first interaction
let welcomed = false;
document.addEventListener('click', function welcome() {
  if (!welcomed && S.sound) {
    welcomed = true;
    playWelcomeTone();
  }
}, { once: true });

// Also try to play welcome tone shortly after load (if user has interacted before)
setTimeout(() => {
  if (!welcomed && S.sound) {
    try {
      playWelcomeTone();
      welcomed = true;
    } catch(e) {}
  }
}, 500);

})();
</script>
</body>
</html>
